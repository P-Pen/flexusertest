import{o as t,c as f,w as m,u as s,b as c,a as i,g as n,f as h,i as _,h as r,t as d,F as w,D as y,d as g,e as k}from"./app-BYx064nO.js";import{i as I,c as x}from"./app-DISTCiac.js";import{_ as S}from"./app-BAIc7wsg.js";import{_ as L}from"./app-57xpzLDR.js";import{T as N}from"./app-DR284fT9.js";import{_ as v}from"./app-CfHT7AaZ.js";import{_ as $,a as U}from"./app-BuHt2kYS.js";import{_ as C}from"./app-_N2IGwgj.js";import{D}from"./app-D0jdtzyy.js";import"./app-BXvxi6wb.js";import"./app-C9w-bzHc.js";import"./app-DyIe33QU.js";import"./app-5V9SnxW6.js";import"./app-DOaxShSm.js";import"./app-51hQc1Cd.js";import"./app-CqAVEB_b.js";import"./app-CK9Tk_hc.js";import"./app-Cqxz9tud.js";import"./app-DoRtcMJm.js";import"./app-aIb4ksxL.js";import"./app-DYkSpHuE.js";function V(){I(this),this.isUpdating=!1,this.success=this.$NotifyReloadSuccess("保存成功"),this.newUserPlanId=0;let p=0;this.userPlan!=null&&this.userPlan.id>0&&(this.newUserPlanId=this.userPlan.id.toString(),p=this.newUserPlanId),this.newUserPlan=null,this.newUserPlanDescription="",this.newUserPlanLimit="";let e="";this.update=function(){this.isUpdating=!this.isUpdating,this.newUserPlanId=p},this.changeUserPlan=function(){if(this.newUserPlan=null,this.newUserPlanDescription="",this.newUserPlanLimit="",this.newUserPlanId==0)return;let P=this;if(this.newUserPlan=this.userPlans.find(function(l){return l.id==P.newUserPlanId}),this.newUserPlan!=null){e=Math.random().toString();var o=e;this.$post(".data").params({serverId:this.serverId,userPlanId:this.newUserPlanId}).success(function(l){if(o!=e)return;let a=l.data,u=[];a.servers.max>0&&(a.servers.current>0?p==this.newUserPlanId?u.push("网站数限制："+a.servers.current+"/"+a.servers.max):u.push("网站数限制："+a.servers.current+"+1/"+a.servers.max):u.push("网站数限制：+1/"+a.servers.max),a.servers.isValid||(this.newUserPlanLimit="已绑定网站数超出当前套餐限制")),a.allServerNames.max>0&&(a.allServerNames.current>0?u.push("域名数限制："+a.allServerNames.current+"+"+a.serverNames.current+"/"+a.allServerNames.max):u.push("域名数限制：+"+a.serverNames.current+"/"+a.allServerNames.max),a.allServerNames.isValid||(this.newUserPlanLimit="已绑定域名数超出当前套餐限制")),a.serverNames.max>0&&(u.push("单网站域名数限制：+"+a.serverNames.current+"/"+a.serverNames.max),a.serverNames.isValid||(this.newUserPlanLimit="当前网站域名数超出当前套餐限制")),u.length>0&&(this.newUserPlanDescription=u.join("；")+"。")})}}}const b=["value"],T=i("td",{class:"title"},"当前绑定套餐",-1),z={key:0,class:"disabled"},B={key:1},F={key:0},M={key:3,class:"comment"},R=i("a",{href:"/plans"},[i("span",{class:"red"},"[已过期，请及时续费]")],-1),q=[R],E={key:0},j=i("td",null,"新套餐 *",-1),A=i("input",{type:"hidden",name:"isChanged",value:"1"},null,-1),G={key:0,class:"disabled"},H={key:1},J={key:0,class:"comment"},K=i("span",{class:"red"},"不使用套餐将会导致网站无法正常访问。",-1),O=[K],Q={key:1,class:"comment"},W={key:1},X=i("td",null,"所选套餐限制",-1),Y={key:0},Z={key:1},ee=i("span",{class:"disabled"},"没有限制",-1),se=[ee],te={key:2},ne={class:"red"},ie={key:0},ae={key:0},re=i("td",null,"套餐日流量限制",-1),le={class:"comment"},oe={key:1},de=i("td",null,"套餐月流量限制",-1),ue={class:"comment"},Ve={__name:"index",setup(p){const e=x(new V);return(P,o)=>(t(),f(S,{ctx:s(e)},{default:m(()=>[c(C,{onSuccess:s(e).success,action:"$"},{default:m(()=>[i("input",{type:"hidden",name:"serverId",value:s(e).serverId},null,8,b),c(D,null,{default:m(()=>[i("tbody",null,[i("tr",null,[T,i("td",null,[s(e).userPlan.id==0?(t(),n("span",z,[h("暂时还没有绑定套餐。 "),s(e).isUpdating?r("",!0):(t(),n("a",{key:0,href:"",onClick:o[0]||(o[0]=_(l=>s(e).update(),["prevent"]))},"[修改]")),s(e).isUpdating?(t(),n("a",{key:1,href:"",onClick:o[1]||(o[1]=_(l=>s(e).update(),["prevent"]))},"[取消修改]")):r("",!0)])):(t(),n("div",B,[h(d(s(e).userPlan.plan.name),1),s(e).userPlan.name.length>0?(t(),n("span",F,"-"+d(s(e).userPlan.name),1)):r("",!0),h(" （到期时间："+d(s(e).userPlan.dayTo)+"）  ",1),s(e).isUpdating?r("",!0):(t(),n("a",{key:1,href:"",onClick:o[2]||(o[2]=_(l=>s(e).update(),["prevent"]))},"[修改]")),s(e).isUpdating?(t(),n("a",{key:2,href:"",onClick:o[3]||(o[3]=_(l=>s(e).update(),["prevent"]))},"[取消修改]")):r("",!0),s(e).userPlan.isExpired?(t(),n("p",M,q)):r("",!0)]))])]),s(e).isUpdating?(t(),n("tr",E,[j,i("td",null,[A,s(e).userPlans.length==0?(t(),n("span",G,"当前还没有可以使用的套餐。")):(t(),n("div",H,[c($,{name:"userPlanId",filter:"",modelValue:s(e).newUserPlanId,"onUpdate:modelValue":o[4]||(o[4]=l=>s(e).newUserPlanId=l),onChange:s(e).changeUserPlan},{default:m(()=>[c(U,{value:"0"},{default:m(()=>[h("[不使用套餐]")]),_:1}),(t(!0),n(w,null,y(s(e).userPlans,l=>(t(),f(U,{value:l.id},{default:m(()=>[h(d(l.name)+"（"+d(l.dayTo)+"）",1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue","onChange"]),s(e).mustUsePlan&&s(e).newUserPlanId==0?(t(),n("p",J,O)):r("",!0),s(e).newUserPlanId>0&&s(e).newUserPlanId==s(e).userPlan.id?(t(),n("p",Q,"当前正在使用的套餐。")):r("",!0)]))])])):r("",!0),s(e).isUpdating&&s(e).newUserPlan!=null?(t(),n("tr",W,[X,i("td",null,[s(e).newUserPlan!=null&&s(e).newUserPlanDescription.length>0?(t(),n("div",Y,d(s(e).newUserPlanDescription),1)):(t(),n("div",Z,se)),s(e).newUserPlanLimit.length>0&&s(e).newUserPlanId!=s(e).userPlan.id?(t(),n("div",te,[i("span",ne,d(s(e).newUserPlanLimit),1)])):r("",!0)])])):r("",!0)]),!s(e).isUpdating&&s(e).hasTrafficLimit?(t(),n("tbody",ie,[s(e).userPlan.plan.trafficLimit.dailySize!=null&&s(e).userPlan.plan.trafficLimit.dailySize.count>0?(t(),n("tr",ae,[re,i("td",null,[c(v,{"v-value":s(e).userPlan.plan.trafficLimit.dailySize},null,8,["v-value"]),i("p",le,"当天流量："+d(s(e).trafficDailyFormat),1)])])):r("",!0),s(e).userPlan.plan.trafficLimit.monthlySize!=null&&s(e).userPlan.plan.trafficLimit.monthlySize.count>0?(t(),n("tr",oe,[de,i("td",null,[c(v,{"v-value":s(e).userPlan.plan.trafficLimit.monthlySize},null,8,["v-value"]),i("p",ue,"当月流量："+d(s(e).trafficMonthlyFormat),1)])])):r("",!0)])):r("",!0)]),_:1}),g(c(L,null,null,512),[[k,s(e).newUserPlanLimit.length==0&&s(e).newUserPlanId!=s(e).userPlan.id]]),s(e).newUserPlanLimit.length>0||s(e).newUserPlanId==s(e).userPlan.id?(t(),f(N,{key:0,disabled:"",type:"button"},{default:m(()=>[h("保存")]),_:1})):r("",!0)]),_:1},8,["onSuccess"])]),_:1},8,["ctx"]))}};export{Ve as default};
