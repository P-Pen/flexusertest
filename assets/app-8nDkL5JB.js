import{i as b,c as _}from"./app-DISTCiac.js";import{e as I}from"./app-DUeSaIYz.js";/* empty css            */import{C as B}from"./app-BXvxi6wb.js";import{W as R}from"./app-DQhYsbJs.js";import{C}from"./app-D2_aZ1I5.js";import{C as q}from"./app-CnNkgeR8.js";import{_ as v}from"./app-CZlmCTom.js";import{o as x,c as L,w as u,u as d,g as p,b as m,f,a as h,h as S}from"./app-BYx064nO.js";import"./app-C9w-bzHc.js";import"./app-DyIe33QU.js";import"./app-BXiLqtxA.js";import"./app-CqvvE0jO.js";import"./app-CK9Tk_hc.js";import"./app-CAeEyuA3.js";import"./app-DoRtcMJm.js";import"./app-DPMEyUYH.js";import"./app-CxqGeHsb.js";import"./app-Dj8c2KwC.js";import"./app-cRxw2ZDj.js";import"./app-DOaxShSm.js";import"./app-5V9SnxW6.js";import"./app-Ncl-Sitd.js";import"./app-DoTJvLi7.js";function k(){const{utils:a}=b(this);a.setEcharts(I),this.$delay(function(){this.reloadChart(),setInterval(()=>{this.$get("$").params({serverId:this.serverId,X_FROM_FRONT:"on"}).success(function(e){this.minutelyStats=e.data.minutelyStats,this.reloadChart()})},3e4)}),this.reloadChart=function(){const e=this;let l=[];for(let t=0;t<this.minutelyStats.length;t++)t%5==0&&l.push(this.minutelyStats[t]);this.minutelyStats=l,this.reloadRequestsChart("minutely-requests-chart","请求数统计",this.minutelyStats,function(t){if(t.seriesIndex==0)return e.minutelyStats[t.dataIndex].day+" "+e.minutelyStats[t.dataIndex].minute+"<br/>请求数："+a.formatNumber(e.minutelyStats[t.dataIndex].countRequests);if(t.seriesIndex==1){let o=0;return e.minutelyStats[t.dataIndex].countRequests>0&&(o=Math.round(e.minutelyStats[t.dataIndex].countCachedRequests*1e4/e.minutelyStats[t.dataIndex].countRequests)/100),e.minutelyStats[t.dataIndex].day+" "+e.minutelyStats[t.dataIndex].minute+"<br/>缓存请求数："+a.formatNumber(e.minutelyStats[t.dataIndex].countCachedRequests)+"<br/>缓存命中率："+o+"%"}return""}),this.reloadTrafficChart("minutely-traffic-chart","流量统计",this.minutelyStats,function(t){if(t.seriesIndex==0)return e.minutelyStats[t.dataIndex].day+" "+e.minutelyStats[t.dataIndex].minute+"<br/>流量: "+a.formatBytes(e.minutelyStats[t.dataIndex].bytes);if(t.seriesIndex==1){let o=0;return e.minutelyStats[t.dataIndex].bytes>0&&(o=Math.round(e.minutelyStats[t.dataIndex].cachedBytes*1e4/e.minutelyStats[t.dataIndex].bytes)/100),e.minutelyStats[t.dataIndex].day+" "+e.minutelyStats[t.dataIndex].minute+"<br/>缓存流量: "+a.formatBytes(e.minutelyStats[t.dataIndex].cachedBytes)+"<br/>缓存命中率："+o+"%"}return""})},this.reloadRequestsChart=function(e,l,t,o){let c=document.getElementById(e);if(c==null)return;let i=a.countAxis(t,function(n){return Math.max(n.countRequests,n.countCachedRequests)});const y=t.$any(function(n,s){return s.countCachedRequests>0});a.initChart(c,void 0,n=>{let s={xAxis:{data:t.map(function(r){return r.minute}),axisLabel:{color:a.chartLabelColor}},yAxis:{axisLabel:{formatter:function(r){return r+i.unit},color:a.chartLabelColor}},tooltip:{show:!0,trigger:"item",formatter:o},grid:{left:50,top:40,right:20,bottom:20},series:[{name:"请求数",type:"line",data:t.map(function(r){return r.countRequests/i.divider}),itemStyle:{color:a.DefaultChartColor},areaStyle:{color:a.DefaultChartColor},smooth:!0},{name:"缓存请求数",type:"line",data:t.map(function(r){return y?r.countCachedRequests/i.divider:null}),itemStyle:{color:a.CacheChartColor},areaStyle:{color:a.CacheChartColor},smooth:!0}],legend:{data:["请求数","缓存请求数"],textStyle:{color:a.chartLabelColor()}},animation:!0};n.setOption(s),n.resize()})},this.reloadTrafficChart=function(e,l,t,o){let c=document.getElementById(e);if(c==null)return;let i=a.bytesAxis(t,function(n){return Math.max(n.bytes,n.cachedBytes)});const y=t.$any(function(n,s){return s.cachedBytes>0});a.initChart(c,void 0,n=>{let s={xAxis:{data:t.map(function(r){return r.minute}),axisLabel:{color:a.chartLabelColor}},yAxis:{axisLabel:{formatter:function(r){return r+i.unit},color:a.chartLabelColor}},tooltip:{show:!0,trigger:"item",formatter:o},grid:{left:50,top:40,right:20,bottom:20},series:[{name:"流量",type:"line",data:t.map(function(r){return r.bytes/i.divider}),itemStyle:{color:a.DefaultChartColor},areaStyle:{color:a.DefaultChartColor},smooth:!0},{name:"缓存流量",type:"line",data:t.map(function(r){return y?r.cachedBytes/i.divider:null}),itemStyle:{color:a.CacheChartColor},areaStyle:{color:a.CacheChartColor},smooth:!0}],legend:{data:["流量","缓存流量"],textStyle:{color:a.chartLabelColor()}},animation:!0};n.setOption(s),n.resize()})}}const w={key:0},N=["href"],A={key:1},D=h("span",{class:"text-base gray"},"（即时）",-1),M=h("div",{class:"chart-box",id:"minutely-requests-chart"},null,-1),O=h("span",{class:"text-base gray"},"（即时）",-1),$=h("div",{class:"chart-box",id:"minutely-traffic-chart"},null,-1),it={__name:"index",setup(a){const e=_(new k);return(l,t)=>(x(),L(B,{ctx:d(e),"has-tab":!0},{default:u(()=>[d(e).statIsOn?S("",!0):(x(),p("div",w,[m(R,null,{default:u(()=>[f(" 要想查看统计数据，需要先开启统计功能，"),h("a",{href:"/servers/server/settings/stat?serverId="+d(e).serverId},"[点击这里]",8,N),f("修改配置。 ")]),_:1})])),d(e).statIsOn?(x(),p("div",A,[m(v,{ctx:d(e),"active-tab":"minutely"},null,8,["ctx"]),m(q,null,{default:u(()=>[m(C,{cols:"1"},{header:u(()=>[f("请求数统计"),D]),default:u(()=>[M]),_:1}),m(C,{cols:"1"},{header:u(()=>[f("流量统计"),O]),default:u(()=>[$]),_:1})]),_:1})])):S("",!0)]),_:1},8,["ctx"]))}};export{it as default};
