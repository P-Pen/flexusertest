import{r as v,J as S,o,g as u,b as s,w as r,a as l,u as e,bb as P,f as a,F as R,D as L,c as O,t as w,i as B,h as d,L as le,ae as ne,d as W,e as j}from"./app-BYx064nO.js";import{P as oe}from"./app-BnDFQ2zy.js";import{i as se,u as ae,c as ie}from"./app-DISTCiac.js";import{_ as ue}from"./app-57xpzLDR.js";import{_ as N}from"./app-C5GVF480.js";import{a as D,_ as F}from"./app-BuHt2kYS.js";import{_ as re}from"./app-_N2IGwgj.js";import{_ as M}from"./app-DfipPP5d.js";import{C as b}from"./app-IrmNFWm4.js";import{_ as z}from"./app-BrIVTM_6.js";import{_ as H}from"./app--BlRpVz_.js";import{_ as q}from"./app-CryyhHYs.js";import{T as Z,a as Y}from"./app-DRGtcCVV.js";import{D as K}from"./app-D0jdtzyy.js";import{T as ee}from"./app-DR284fT9.js";import{T as Q}from"./app-DNadG4GC.js";import{P as te}from"./app-TBcc1obG.js";import"./app-CHxME8Sw.js";import{_ as de}from"./app-1SA4suwN.js";import"./app-GoR2fTOd.js";import"./app-DYkSpHuE.js";import"./app-51hQc1Cd.js";import"./app-CqAVEB_b.js";import"./app-CK9Tk_hc.js";import"./app-Cqxz9tud.js";import"./app-DoRtcMJm.js";import"./app-aIb4ksxL.js";import"./app-DyIe33QU.js";import"./app-tUtHmy3n.js";import"./app-DPMEyUYH.js";function ce(){if(se(this),this.success=this.$NotifyPopup,this.isUpdating=window.parent.UPDATING_RULE!=null,this.rule={id:0,param:"",paramFilters:[],checkpointPrefix:"",checkpointParam:"",value:"",isCaseInsensitive:!1,operator:"match",checkpointOptions:null,description:"",isOn:!0},window.parent.UPDATING_RULE!=null){this.rule=window.parent.UPDATING_RULE;let c=this.rule.param.substring(this.rule.param.indexOf("${")+2,this.rule.param.indexOf("}")),h=c.indexOf(".");h>0?(this.rule.checkpointPrefix=c.substring(0,h),this.rule.checkpointParam=c.substring(h+1)):this.rule.checkpointPrefix=c,this.$delay(function(){if(this.loadCheckpoint(),this.rule.checkpointOptions!=null&&this.checkpoint!=null&&this.checkpoint.options!=null){let _=this;this.checkpoint.options.forEach(function(m){typeof _.rule.checkpointOptions[m.code]<"u"&&(m.value=_.rule.checkpointOptions[m.code])})}})}this.checkpoint=null,this.loadCheckpoint=function(){if(this.rule.checkpointPrefix.length==0){this.checkpoint=null;return}let c=this;this.checkpoint=this.checkpoints.$find(function(h,_){return _.prefix==c.rule.checkpointPrefix})},this.changeCheckpoint=function(){if(this.rule.checkpointPrefix.length==0){this.checkpoint=null;return}let c=this;if(this.checkpoint=this.checkpoints.$find(function(h,_){return _.prefix==c.rule.checkpointPrefix}),this.checkpoint!=null)switch(this.checkpoint.dataType){case"bool":this.rule.operator="eq";break;case"number":this.rule.operator="eq";break;default:this.rule.operator="match"}},this.changeOperator=function(){let c=this;this.operator=this.operators.$find(function(h,_){return _.code==c.rule.operator}),this.operator!=null&&(this.isUpdating||(this.rule.isCaseInsensitive=this.operator.case=="yes"))},this.changeOperator(),this.changeCaseInsensitive=function(){(this.rule.operator=="match"||this.rule.operator=="not match")&&this.regexpTestIsOn&&this.changeRegexpTestBody()},this.changeRuleValue=function(){this.rule.operator=="match"||this.rule.operator=="not match"?this.regexpTestIsOn&&this.changeRegexpTestBody():(this.regexpTestIsOn=!1,this.regexpTestResult={isOk:!1,message:""})},this.convertValueLine=function(){let c=this.rule.value;if(c!=null&&c.length>0){let h=c.split(/\n/),_=[];h.forEach(function(m){m=m.trim(),m.length>0&&_.push(m)}),this.rule.value=_.join("|")}},this.regexpTestIsOn=!1,this.regexpTestBody="",this.regexpTestResult={isOk:!1,message:""},this.changeRegexpTestIsOn=function(){this.regexpTestIsOn=!this.regexpTestIsOn,this.regexpTestIsOn&&this.$delay(function(){this.$refs.regexpTestBody.focus()})},this.changeRegexpTestBody=function(){this.$post(".testRegexp").params({regexp:this.rule.value,body:this.regexpTestBody,isCaseInsensitive:this.rule.isCaseInsensitive}).success(function(c){this.regexpTestResult=c.data.result})},this.selectISPName=function(c){if(c==null)return;let h=c.name;this.$refs.ispComboBox.clear(),this.rule.value.length==0?this.rule.value=h:this.rule.value+="|"+h},this.selectGeoCountryName=function(c){if(c==null)return;let h=c.name;this.$refs.countryComboBox.clear(),this.rule.value.length==0?this.rule.value=h:this.rule.value+="|"+h},this.selectGeoProvinceName=function(c){if(c==null)return;let h=c.name;this.$refs.provinceComboBox.clear(),this.rule.value.length==0?this.rule.value=h:this.rule.value+="|"+h},this.selectGeoCityName=function(c){if(c==null)return;let h=c.name;this.$refs.cityComboBox.clear(),this.rule.value.length==0?this.rule.value=h:this.rule.value+="|"+h}}const pe=l("td",{class:"title"},"通用Header列表",-1),me={class:"!font-normal"},he=l("p",{class:"comment"},"需要检查的Header列表。",-1),fe=l("td",null,"Header值超出长度",-1),_e={class:"!font-normal"},ve=l("span",null,"字节",-1),ye=l("p",{class:"comment"},"超出此长度认为匹配成功，0表示不限制。",-1),ge={__name:"HTTPCondGeneralHeaderLength",props:["v-checkpoint"],setup(c){let h=["Cache-Control","Connection","Date","Pragma","Trailer","Transfer-Encoding","Upgrade","Via","Warning"];const _=c,{headers:m,length:g}=function(){let t=null,V=null;if(window.UPDATING_RULE!=null){let i=window.UPDATING_RULE.checkpointOptions;i.headers!=null&&Array.$isArray(i.headers)&&(t=i.headers),i.length!=null&&(V=i.length)}return t==null&&(t=h),V==null&&(V=128),setTimeout(function(){$()},100),{headers:v(t),length:v(V)}}(),$=function(){_.vCheckpoint.options=[{code:"headers",value:m.value},{code:"length",value:g.value}]};return S(g,function(t){let V=parseInt(t);isNaN(V)&&(V=0),V<0&&(V=0),g.value=V,$()}),(t,V)=>(o(),u("div",null,[s(K,null,{default:r(()=>[l("tbody",null,[l("tr",null,[pe,l("td",me,[s(q,{values:e(m),placeholder:"Header",onChange:$},null,8,["values"]),he])]),l("tr",null,[fe,l("td",_e,[s(Z,null,{default:r(()=>[s(N,{type:"text",name:"",style:{width:"5em"},modelValue:e(g),"onUpdate:modelValue":V[0]||(V[0]=i=>P(g)?g.value=i:null),maxlength:"6"},null,8,["modelValue"]),s(Y,null,{default:r(()=>[ve]),_:1})]),_:1}),ye])])])]),_:1})]))}},ke=l("input",{type:"hidden",name:"operator",value:"eq"},null,-1),xe=["value"],$e=l("td",{class:"title"},"来源域名允许为空",-1),Ve={class:"!font-normal"},Ce=l("p",{class:"comment"},"允许不带来源的访问。",-1),Te=l("td",null,"来源域名允许一致",-1),be={class:"!font-normal"},we=l("p",{class:"comment"},"允许来源域名和当前访问的域名一致，相当于在站内访问。",-1),Ie=l("td",null,"允许的来源域名",-1),Ue={class:"!font-normal"},Oe={class:"comment"},Ne=l("td",null,"禁止的来源域名",-1),De={class:"!font-normal"},Pe={class:"comment"},Re=l("td",null,"同时检查Origin",-1),Ee={class:"!font-normal"},Be=l("p",{class:"comment"},"如果请求没有指定Referer Header，则尝试检查Origin Header，多用于跨站调用。",-1),Le={__name:"HTTPFirewallCheckpointRefererBlock",props:["v-checkpoint"],setup(c){const h=c,{allowDomains:_,allowSameDomain:m,allowEmpty:g,denyDomains:$,checkOrigin:t,options:V,value:i}=function(){let p=!0,y=!0,x=[],E=[],A=!0,f={};return window.UPDATING_RULE!=null&&(f=window.UPDATING_RULE.checkpointOptions),f==null&&(f={}),typeof f.allowEmpty=="boolean"&&(p=f.allowEmpty),typeof f.allowSameDomain=="boolean"&&(y=f.allowSameDomain),f.allowDomains!=null&&typeof f.allowDomains=="object"&&(x=f.allowDomains),f.denyDomains!=null&&typeof f.denyDomains=="object"&&(E=f.denyDomains),typeof f.checkOrigin=="boolean"&&(A=f.checkOrigin),setTimeout(function(){I()},100),{allowEmpty:v(p),allowSameDomain:v(y),allowDomains:v(x),denyDomains:v(E),checkOrigin:v(A),options:v({}),value:v(0)}}();S(g,function(){I()}),S(m,function(){I()}),S(t,function(){I()});const n=function(p){_.value=p,I()},k=function(p){$.value=p,I()},I=function(){h.vCheckpoint.options=[{code:"allowEmpty",value:g.value},{code:"allowSameDomain",value:m.value},{code:"allowDomains",value:_.value},{code:"denyDomains",value:$.value},{code:"checkOrigin",value:t.value}]};return(p,y)=>(o(),u("div",null,[ke,l("input",{type:"hidden",name:"value",value:e(i)},null,8,xe),s(K,null,{default:r(()=>[l("tbody",null,[l("tr",null,[$e,l("td",Ve,[s(H,{modelValue:e(g),"onUpdate:modelValue":y[0]||(y[0]=x=>P(g)?g.value=x:null)},null,8,["modelValue"]),Ce])]),l("tr",null,[Te,l("td",be,[s(H,{modelValue:e(m),"onUpdate:modelValue":y[1]||(y[1]=x=>P(m)?m.value=x:null)},null,8,["modelValue"]),we])]),l("tr",null,[Ie,l("td",Ue,[s(q,{values:e(_),onChange:n},null,8,["values"]),l("p",Oe,[a("允许的来源域名列表，比如 "),s(b,null,{default:r(()=>[a("example.com")]),_:1}),a(" （顶级域名)、 "),s(b,null,{default:r(()=>[a("*.example.com")]),_:1}),a(" （example.com的所有二级域名）。单个星号 "),s(b,null,{default:r(()=>[a("*")]),_:1}),a(" 表示允许所有域名。 ")])])]),l("tr",null,[Ne,l("td",De,[s(q,{values:e($),onChange:k},null,8,["values"]),l("p",Pe,[a("禁止的来源域名列表，比如 "),s(b,null,{default:r(()=>[a("example.org")]),_:1}),a(" （顶级域名）、 "),s(b,null,{default:r(()=>[a("*.example.org")]),_:1}),a(" （example.org的所有二级域名）；除了这些禁止的来源域名外，其他域名都会被允许，除非限定了允许的来源域名。 ")])])]),l("tr",null,[Re,l("td",Ee,[s(H,{modelValue:e(t),"onUpdate:modelValue":y[2]||(y[2]=x=>P(t)?t.value=x:null)},null,8,["modelValue"]),Be])])])]),_:1})]))}},Se=["value"],Ae={class:"label-group"},Fe=["onClick"],He=l("i",{class:"icon remove small"},null,-1),Ge=[He],Me={key:0,style:{"margin-top":"1em"}},ze={class:"ui fields inline"},Ke={class:"ui field"},Je={key:0,class:"ui field"},We={key:1,class:"ui field"},je={key:2,class:"ui field"},qe={class:"ui field"},Ye=l("i",{class:"icon remove small"},null,-1),Qe=[Ye],Xe={key:0,class:"comment"},Ze={key:1,style:{"margin-top":"1em"}},et={__name:"MetricKeysConfigBox",props:["v-keys"],emits:["change"],setup(c,{emit:h}){const _=ae(),m=c,g=v(),$=h,{keys:t,isAdding:V,key:i,subKey:n,keyDescription:k,keyDefs:I}=function(){let C=m.vKeys;return C==null&&(C=[]),{keys:v(C),isAdding:v(!1),key:v(""),subKey:v(""),keyDescription:v(""),keyDefs:v(window.METRIC_HTTP_KEYS)}}(),p=function(){i.value="",n.value="",k.value="",V.value=!1},y=function(){if(i.value.length!=0){if(i.value.indexOf(".NAME")>0){if(n.value.length==0){_.warn("请输入参数值");return}i.value=i.value.replace(".NAME","."+n.value)}t.value.push(i.value),p()}},x=function(){V.value=!0,setTimeout(function(){g.value!=null&&g.value.focus()},100)},E=function(C){t.value.$remove(C)},A=function(){if(i.value.length==0)return;let C=I.value.$find(function(T,U){return U.code==i.value});C!=null&&(k.value=C.description)},f=function(C){let T="",U=I.value.$find(function(X,G){return G.code==C?!0:C.startsWith("${arg.")&&G.code.startsWith("${arg.")?(T=J("arg.",C),!0):C.startsWith("${header.")&&G.code.startsWith("${header.")?(T=J("header.",C),!0):C.startsWith("${cookie.")&&G.code.startsWith("${cookie.")?(T=J("cookie.",C),!0):!1});return U!=null?T.length>0?U.name+": "+T:U.name:C},J=function(C,T){C="${"+C;let U=T.indexOf(C);return U>=0?(T=T.substring(U+C.length),T=T.substring(0,T.length-1),T):""};return S(t.value,function(){$("change",t.value)}),(C,T)=>(o(),u("div",null,[l("input",{type:"hidden",name:"keysJSON",value:JSON.stringify(e(t))},null,8,Se),l("div",null,[l("div",Ae,[(o(!0),u(R,null,L(e(t),(U,X)=>(o(),O(Q,{outlined:""},{default:r(()=>[a(w(f(U))+"   ",1),l("a",{href:"",title:"删除",onClick:B(G=>E(X),["prevent"])},Ge,8,Fe)]),_:2},1024))),256))])]),e(V)?(o(),u("div",Me,[l("div",ze,[l("div",Ke,[s(F,{modelValue:e(i),"onUpdate:modelValue":T[0]||(T[0]=U=>P(i)?i.value=U:null),onChange:A},{default:r(()=>[s(D,{value:""},{default:r(()=>[a("[选择对象]")]),_:1}),(o(!0),u(R,null,L(e(I),U=>(o(),O(D,{value:U.code},{default:r(()=>[a(w(U.name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"])]),e(i)=="${arg.NAME}"?(o(),u("div",Je,[s(N,{type:"text",modelValue:e(n),"onUpdate:modelValue":T[1]||(T[1]=U=>P(n)?n.value=U:null),placeholder:"参数名",size:"15"},null,8,["modelValue"])])):d("",!0),e(i)=="${header.NAME}"?(o(),u("div",We,[s(N,{type:"text",modelValue:e(n),"onUpdate:modelValue":T[2]||(T[2]=U=>P(n)?n.value=U:null),placeholder:"Header名",size:"15"},null,8,["modelValue"])])):d("",!0),e(i)=="${cookie.NAME}"?(o(),u("div",je,[s(N,{type:"text",modelValue:e(n),"onUpdate:modelValue":T[3]||(T[3]=U=>P(n)?n.value=U:null),placeholder:"Cookie名",size:"15"},null,8,["modelValue"])])):d("",!0),l("div",qe,[s(ee,{type:"button",secondary:"",size:"small",onClick:B(y,["prevent"])},{default:r(()=>[a("确定")]),_:1}),a("  "),l("a",{href:"",onClick:B(p,["prevent"])},Qe)])]),e(k).length>0?(o(),u("p",Xe,w(e(k)),1)):d("",!0)])):d("",!0),e(V)?d("",!0):(o(),u("div",Ze,[s(te,{size:"small",onClick:B(x,["prevent"])})]))]))}},tt=l("input",{type:"hidden",name:"operator",value:"gt"},null,-1),lt=["value"],nt=l("td",{class:"title"},"统计对象组合 *",-1),ot={class:"!font-normal"},st=l("td",null,"统计周期 *",-1),at={class:"!font-normal"},it=l("span",null,"每",-1),ut=l("span",null,"秒",-1),rt=l("td",null,"阈值 *",-1),dt={class:"!font-normal"},ct={class:"comment"},pt={key:0,class:"red"},mt=l("td",null,"检查请求来源指纹",-1),ht={class:"!font-normal"},ft=l("p",{class:"comment"},"在接收到HTTPS请求时尝试检查请求来源的指纹，用来检测代理服务和爬虫攻击；如果你在网站前面放置了别的反向代理服务，请取消此选项。",-1),_t=l("td",null,"忽略常用文件",-1),vt={class:"!font-normal"},yt=l("p",{class:"comment"},"忽略js、css、jpg等常在网页里被引用的文件名，即对这些文件的访问不加入计数，可以减少误判几率。但如果单独访问这些文件，比如在浏览器里直接打开，也会加入计数。",-1),gt={__name:"HTTPFirewallCheckpointCC",props:["v-checkpoint"],setup(c){const h=c,{keys:_,period:m,threshold:g,ignoreCommonFiles:$,enableFingerprint:t,options:V,value:i}=function(){let p=[],y=60,x=1e3,E=!0,A=!0,f={};return window.UPDATING_RULE!=null&&(f=window.UPDATING_RULE.checkpointOptions),f==null&&(f={}),f.keys!=null&&(p=f.keys),p.length==0&&(p=["${remoteAddr}","${requestPath}"]),f.period!=null&&(y=f.period),f.threshold!=null&&(x=f.threshold),f.ignoreCommonFiles!=null&&typeof f.ignoreCommonFiles=="boolean"&&(E=f.ignoreCommonFiles),f.enableFingerprint!=null&&typeof f.enableFingerprint=="boolean"&&(A=f.enableFingerprint),setTimeout(function(){k()},100),{keys:v(p),period:v(y),threshold:v(x),ignoreCommonFiles:v(E),enableFingerprint:v(A),options:v({}),value:v(x)}}(),n=function(p){_.value=p,k()},k=function(){let p=parseInt(m.value.toString());(isNaN(p)||p<=0)&&(p=60);let y=parseInt(g.value.toString());(isNaN(y)||y<=0)&&(y=1e3),i.value=y;let x=$.value;typeof x!="boolean"&&(x=!1);let E=t.value;typeof E!="boolean"&&(E=!0),h.vCheckpoint.options=[{code:"keys",value:_.value},{code:"period",value:p},{code:"threshold",value:y},{code:"ignoreCommonFiles",value:x},{code:"enableFingerprint",value:E}]},I=function(){let p=parseInt(g.value.toString());return(isNaN(p)||p<=0)&&(p=1e3),p>0&&p<5};return S(m,function(){k()}),S(g,function(){k()}),S($,function(){k()}),S(t,function(){k()}),(p,y)=>(o(),u("div",null,[tt,l("input",{type:"hidden",name:"value",value:e(i)},null,8,lt),s(K,null,{default:r(()=>[l("tbody",null,[l("tr",null,[nt,l("td",ot,[s(et,{"v-keys":e(_),onChange:n},null,8,["v-keys"])])]),l("tr",null,[st,l("td",at,[s(Z,null,{default:r(()=>[s(Y,null,{default:r(()=>[it]),_:1}),s(N,{type:"text",modelValue:e(m),"onUpdate:modelValue":y[0]||(y[0]=x=>P(m)?m.value=x:null),style:{width:"6em"},maxlength:"8"},null,8,["modelValue"]),s(Y,null,{default:r(()=>[ut]),_:1})]),_:1})])]),l("tr",null,[rt,l("td",dt,[s(N,{type:"text",modelValue:e(g),"onUpdate:modelValue":y[1]||(y[1]=x=>P(g)?g.value=x:null),style:{width:"6em"},maxlength:"8"},null,8,["modelValue"]),l("p",ct,[a(" 当统计对象在统计周期内请求次数达到此阈值时即认为满足CC条件。 "),I()?(o(),u("span",pt,"对于网站类应用来说，当前阈值（"+w(e(g))+"）设置的太低，有可能会影响用户正常访问。",1)):d("",!0)])])]),l("tr",null,[mt,l("td",ht,[s(H,{modelValue:e(t),"onUpdate:modelValue":y[2]||(y[2]=x=>P(t)?t.value=x:null)},null,8,["modelValue"]),ft])]),l("tr",null,[_t,l("td",vt,[s(H,{modelValue:e($),"onUpdate:modelValue":y[3]||(y[3]=x=>P($)?$.value=x:null)},null,8,["modelValue"]),yt])])])]),_:1})]))}},kt=["value"],xt={key:0,class:"label-group"},$t=["onClick"],Vt=l("i",{class:"icon remove"},null,-1),Ct=[Vt],Tt={key:1},bt={class:"ui fields inline"},wt={class:"ui field"},It={class:"ui field"},Ut=l("i",{class:"icon remove"},null,-1),Ot=[Ut],Nt={key:2},Dt=l("p",{class:"comment"},"可以对参数值进行特定的编解码处理；如果添加了多个编解码，则按顺序依次执行。",-1),Pt={__name:"HTTPFirewallParamFiltersBox",props:["v-filters"],setup(c){const h=c,{filters:_,isAdding:m,options:g,addingCode:$}=function(){let k=h.vFilters;return k==null&&(k=[]),{filters:v(k),isAdding:v(!1),options:v([{name:"MD5",code:"md5"},{name:"URLEncode",code:"urlEncode"},{name:"URLDecode",code:"urlDecode"},{name:"BASE64Encode",code:"base64Encode"},{name:"BASE64Decode",code:"base64Decode"},{name:"UNICODE编码",code:"unicodeEncode"},{name:"UNICODE解码",code:"unicodeDecode"},{name:"HTML实体编码",code:"htmlEscape"},{name:"HTML实体解码",code:"htmlUnescape"},{name:"计算长度",code:"length"},{name:"十六进制->十进制",code:"hex2dec"},{name:"十进制->十六进制",code:"dec2hex"},{name:"SHA1",code:"sha1"},{name:"SHA256",code:"sha256"},{name:"转换为小写",code:"lowerCase"},{name:"转换为大写",code:"upperCase"}]),addingCode:v("")}}(),t=function(){m.value=!0,$.value=""},V=function(){$.value.length!=0&&(_.value.push(g.value.$find(function(k,I){return I.code==$.value})),m.value=!1)},i=function(){m.value=!1},n=function(k){_.value.$remove(k)};return(k,I)=>(o(),u("div",null,[l("input",{type:"hidden",name:"paramFiltersJSON",value:JSON.stringify(e(_))},null,8,kt),e(_).length>0?(o(),u("div",xt,[(o(!0),u(R,null,L(e(_),(p,y)=>(o(),O(Q,{outlined:""},{default:r(()=>[a(w(p.name)+" ",1),l("a",{href:"",title:"删除",onClick:B(x=>n(y),["prevent"])},Ct,8,$t)]),_:2},1024))),256)),s(le)])):d("",!0),e(m)?(o(),u("div",Tt,[l("div",bt,[l("div",wt,[s(F,{modelValue:e($),"onUpdate:modelValue":I[0]||(I[0]=p=>P($)?$.value=p:null)},{default:r(()=>[s(D,{value:""},{default:r(()=>[a("[请选择]")]),_:1}),(o(!0),u(R,null,L(e(g),p=>(o(),O(D,{value:p.code},{default:r(()=>[a(w(p.name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"])]),l("div",It,[s(ee,{secondary:"",size:"small",type:"button",onClick:I[1]||(I[1]=B(p=>V(),["prevent"]))},{default:r(()=>[a("确定")]),_:1}),a("   "),l("a",{href:"",onClick:I[2]||(I[2]=B(p=>i(),["prevent"])),title:"取消"},Ot)])])])):d("",!0),e(m)?d("",!0):(o(),u("div",Nt,[s(te,{type:"button",onClick:B(t,["prevent"])})])),Dt]))}},Rt={key:0},Et={key:1},Bt=["value"],Lt=["value"],St=l("td",{class:"title"},"参数 *",-1),At=l("optgroup",{label:"特殊参数"},null,-1),Ft=l("optgroup",{label:"通用参数"},null,-1),Ht={key:0,class:"comment"},Gt={style:{"font-style":"normal"}},Mt={key:0},zt=l("td",null,"参数名",-1),Kt={key:0},Jt=l("tr",null,[l("td",{colspan:"2"},"配置选项")],-1),Wt={colspan:"2",class:"options-table-box"},jt={key:1},qt={key:0,class:"ui fields inline"},Yt={class:"ui field"},Qt={class:"ui field"},Xt={key:1,class:"ui fields inline"},Zt={class:"ui field"},el={class:"ui field"},tl={key:2,class:"comment"},ll=l("td",null,"操作符 *",-1),nl=["innerHTML"],ol={key:0},sl={key:1},al={key:2},il={key:3},ul={key:4},rl={key:5},dl={key:6},cl={key:7},pl={key:8},ml={key:9},hl={key:10},fl={key:0},_l={class:"comment"},vl={key:1},yl={class:"comment"},gl={key:2},kl={key:3},xl={class:"comment"},$l={key:4},Vl={class:"comment"},Cl={key:5},Tl={class:"comment"},bl={key:6},wl={class:"comment"},Il={key:7},Ul={class:"comment"},Ol={key:8},Nl={class:"comment"},Dl={key:9},Pl={key:0,class:"comment"},Rl={key:1,class:"comment"},El={key:10,class:"comment"},Bl={class:"red"},Ll={style:{"margin-top":"1em"}},Sl={key:0},Al={key:1},Fl={key:2},Hl={key:3},Gl={key:0},Ml=l("td",null,"正则表达式测试",-1),zl={key:1},Kl={class:"comment"},Jl={key:0,class:"green"},Wl={key:1,class:"red"},jl={key:1},ql=l("td",null,"不区分大小写",-1),Yl=l("p",{class:"comment"},"开启后忽略英文字母大小写。",-1),Ql={colspan:"2"},Xl={key:2},Zl=l("td",null,"编解码",-1),en=l("td",null,"备注",-1),Dn={__name:"createRulePopup",setup(c){const h=v(),_=v(),m=v(),g=v(),$=v(),t=ie(new ce,{refs:{regexpTestBody:h,countryComboBox:_,provinceComboBox:m,cityComboBox:g,ispComboBox:$}});return(V,i)=>(o(),O(oe,null,{default:r(()=>[e(t).isUpdating?d("",!0):(o(),u("header",Rt,"添加规则")),e(t).isUpdating?(o(),u("header",Et,"修改规则")):d("",!0),s(re,{action:"$",onSuccess:e(t).success},{default:r(()=>[l("input",{type:"hidden",name:"ruleId",value:e(t).rule.id},null,8,Bt),e(t).checkpoint!=null&&e(t).checkpoint.options!=null?(o(),u("input",{key:0,type:"hidden",name:"optionsJSON",value:JSON.stringify(e(t).checkpoint.options)},null,8,Lt)):d("",!0),s(K,null,{default:r(()=>[l("tbody",null,[l("tr",null,[St,l("td",null,[s(F,{name:"prefix",onChange:i[0]||(i[0]=n=>e(t).changeCheckpoint()),modelValue:e(t).rule.checkpointPrefix,"onUpdate:modelValue":i[1]||(i[1]=n=>e(t).rule.checkpointPrefix=n),scrollHeight:"30rem",filter:""},{default:r(()=>[s(D,{value:""},{default:r(()=>[a("[选择参数]")]),_:1}),At,(o(!0),u(R,null,L(e(t).checkpoints,n=>(o(),u(R,null,[n.isComposed?(o(),O(D,{key:0,value:n.prefix},{default:r(()=>[a(w(n.name)+"（"+w(n.prefix)+"）",1)]),_:2},1032,["value"])):d("",!0)],64))),256)),Ft,(o(!0),u(R,null,L(e(t).checkpoints,n=>(o(),u(R,null,[n.isComposed?d("",!0):(o(),O(D,{key:0,value:n.prefix},{default:r(()=>[a(w(n.name)+"（"+w(n.prefix)+"）",1)]),_:2},1032,["value"]))],64))),256))]),_:1},8,["modelValue"]),e(t).checkpoint!=null?(o(),u("p",Ht,[s(Q,{outlined:""},{default:r(()=>[a("${"),l("em",Gt,w(e(t).checkpoint.prefix),1),a("} ")]),_:1}),l("span",null,"  "+w(e(t).checkpoint.description),1)])):d("",!0)])]),e(t).checkpoint!=null&&e(t).checkpoint.hasParams?(o(),u("tr",Mt,[zt,l("td",null,[e(t).checkpoint.params!=null?(o(),O(F,{key:0,name:"param",modelValue:e(t).rule.checkpointParam,"onUpdate:modelValue":i[2]||(i[2]=n=>e(t).rule.checkpointParam=n)},{default:r(()=>[(o(!0),u(R,null,L(e(t).checkpoint.params,n=>(o(),O(D,{value:n.value},{default:r(()=>[a(w(n.name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"])):d("",!0),e(t).checkpoint.params==null?(o(),O(N,{key:1,type:"text",name:"param",maxlength:"100",class:"w-full",modelValue:e(t).rule.checkpointParam,"onUpdate:modelValue":i[3]||(i[3]=n=>e(t).rule.checkpointParam=n)},null,8,["modelValue"])):d("",!0)])])):d("",!0)]),e(t).checkpoint!=null&&e(t).checkpoint.isComposed?(o(),u("tbody",Kt,[Jt,l("tr",null,[l("td",Wt,[e(t).checkpoint.prefix=="requestGeneralHeaderLength"||e(t).checkpoint.prefix=="responseGeneralHeaderLength"?(o(),O(ge,{key:0,"v-checkpoint":e(t).checkpoint},null,8,["v-checkpoint"])):d("",!0),e(t).checkpoint.prefix=="refererBlock"?(o(),O(Le,{key:1,"v-checkpoint":e(t).checkpoint},null,8,["v-checkpoint"])):d("",!0),e(t).checkpoint.prefix=="cc"?(o(),O(gt,{key:2,"v-checkpoint":e(t).checkpoint},null,8,["v-checkpoint"])):d("",!0)])])])):d("",!0),e(t).checkpoint!=null&&!e(t).checkpoint.isComposed&&e(t).checkpoint.options!=null&&e(t).checkpoint.options.length>0?(o(),u("tbody",jt,[(o(!0),u(R,null,L(e(t).checkpoint.options,n=>(o(),u("tr",null,[l("td",null,w(n.name),1),l("td",null,[n.type=="field"?(o(),u("div",qt,[l("div",Yt,[s(N,{type:"text",name:"",placeholder:n.placeholder,maxlength:n.maxLength>0?n.maxLength:1024,size:n.size,modelValue:n.value,"onUpdate:modelValue":k=>n.value=k},null,8,["placeholder","maxlength","size","modelValue","onUpdate:modelValue"])]),l("div",Qt,w(n.rightLabel),1)])):d("",!0),n.type=="options"?(o(),u("div",Xt,[l("div",Zt,[s(F,{style:ne("width:"+n.size+"em"),name:"",modelValue:n.value,"onUpdate:modelValue":k=>n.value=k},{default:r(()=>[(o(!0),u(R,null,L(n.options,k=>(o(),O(D,{value:k.value},{default:r(()=>[a(w(k.name),1)]),_:2},1032,["value"]))),256))]),_:2},1032,["style","modelValue","onUpdate:modelValue"])]),l("div",el,w(n.rightLabel),1)])):d("",!0),n.comment!=null&&n.comment.length>0?(o(),u("p",tl,w(n.comment),1)):d("",!0)])]))),256))])):d("",!0),W(l("tbody",null,[l("tr",null,[ll,l("td",null,[s(F,{name:"operator",modelValue:e(t).rule.operator,"onUpdate:modelValue":i[4]||(i[4]=n=>e(t).rule.operator=n),onChange:i[5]||(i[5]=n=>e(t).changeOperator()),filter:""},{default:r(()=>[(o(!0),u(R,null,L(e(t).operators,n=>(o(),O(D,{value:n.code},{default:r(()=>[a(w(n.name)+"（"+w(n.code)+"）",1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"]),e(t).operator!=null?(o(),u("p",{key:0,class:"comment",innerHTML:e(t).operator.description},null,8,nl)):d("",!0)])]),W(l("tr",null,[l("td",null,[e(t).operator!=null&&e(t).operator.dataType=="regexp"?(o(),u("span",ol,"匹配正则表达式")):e(t).operator!=null&&e(t).operator.dataType=="wildcard"?(o(),u("span",sl,"匹配单个通配符")):e(t).operator!=null&&e(t).operator.dataType=="number"?(o(),u("span",al,"对比数字")):e(t).operator!=null&&e(t).operator.dataType=="string"?(o(),u("span",il,"对比单个字符串")):e(t).operator!=null&&e(t).operator.dataType=="strings"?(o(),u("span",ul,"对比一组字符串")):e(t).operator!=null&&e(t).operator.dataType=="string|number"?(o(),u("span",rl,"对比单个字符串或数字")):e(t).operator!=null&&e(t).operator.dataType=="version"?(o(),u("span",dl,"对比单个版本号")):e(t).operator!=null&&e(t).operator.dataType=="versionRange"?(o(),u("span",cl,"对比版本号范围")):e(t).operator!=null&&e(t).operator.dataType=="ip"?(o(),u("span",pl,"对比单个IP")):e(t).operator!=null&&e(t).operator.dataType=="ips"?(o(),u("span",ml,"一组对比IP")):(o(),u("span",hl,"对比值"))]),l("td",null,[e(t).rule.operator=="contains binary"?(o(),u("div",fl,[s(M,{rows:"3",maxlength:"4096",name:"value",modelValue:e(t).rule.value,"onUpdate:modelValue":i[6]||(i[6]=n=>e(t).rule.value=n),class:"w-full"},null,8,["modelValue"]),l("p",_l,[a("将二进制进行Base64Encode后放在这里，比如 "),s(b,null,{default:r(()=>[a("Hello")]),_:1}),a(" 对应 "),s(b,null,{default:r(()=>[a("SGVsbG8=")]),_:1}),a(" 。 ")])])):e(t).rule.operator=="not contains binary"?(o(),u("div",vl,[s(M,{rows:"3",maxlength:"4096",name:"value",modelValue:e(t).rule.value,"onUpdate:modelValue":i[7]||(i[7]=n=>e(t).rule.value=n),class:"w-full"},null,8,["modelValue"]),l("p",yl,[a("将二进制进行Base64Encode后放在这里，比如 "),s(b,null,{default:r(()=>[a("Hello")]),_:1}),a(" 对应 "),s(b,null,{default:r(()=>[a("SGVsbG8=")]),_:1}),a(" 。 ")])])):e(t).checkpoint!=null&&e(t).checkpoint.dataType=="bool"?(o(),u("div",gl,[s(F,{name:"value",modelValue:e(t).rule.value,"onUpdate:modelValue":i[8]||(i[8]=n=>e(t).rule.value=n),onChange:e(t).changeRuleValue},{default:r(()=>[s(D,{value:""},{default:r(()=>[a("[请选择]")]),_:1}),s(D,{value:"1"},{default:r(()=>[a("是(1)")]),_:1}),s(D,{value:"0"},{default:r(()=>[a("否(0)")]),_:1})]),_:1},8,["modelValue","onChange"])])):e(t).operator!=null&&e(t).operator.dataType=="wildcard"?(o(),u("div",kl,[s(M,{rows:"3",maxlength:"4096",name:"value",modelValue:e(t).rule.value,"onUpdate:modelValue":i[9]||(i[9]=n=>e(t).rule.value=n),onInput:e(t).changeRuleValue,class:"w-full"},null,8,["modelValue","onInput"]),l("p",xl,[a("输入包含通配符的字符串，比如 "),s(b,null,{default:r(()=>[a("Chrome/*")]),_:1}),a(" 、 "),s(b,null,{default:r(()=>[a("192.168.*.*")]),_:1}),a(" 。 ")])])):e(t).operator!=null&&e(t).operator.dataType=="number"?(o(),u("div",$l,[s(N,{type:"number",name:"value",modelValue:e(t).rule.value,"onUpdate:modelValue":i[10]||(i[10]=n=>e(t).rule.value=n),onInput:e(t).changeRuleValue,style:{width:"10em"},maxlength:"30",placeholder:"对比数字",step:"any"},null,8,["modelValue","onInput"]),l("p",Vl,[a("输入和参数对比的数字，比如 "),s(b,null,{default:r(()=>[a("123")]),_:1}),a(" 、 "),s(b,null,{default:r(()=>[a("123.456")]),_:1}),a(" 。 ")])])):e(t).operator!=null&&e(t).operator.dataType=="string|number"?(o(),u("div",Cl,[s(N,{type:"text",name:"value",modelValue:e(t).rule.value,"onUpdate:modelValue":i[11]||(i[11]=n=>e(t).rule.value=n),onInput:e(t).changeRuleValue,style:{width:"16em"},maxlength:"30",placeholder:"对比字符串或数字"},null,8,["modelValue","onInput"]),l("p",Tl,[a("输入和参数对比的字符串或数字，比如 "),s(b,null,{default:r(()=>[a("123")]),_:1}),a(" 、 "),s(b,null,{default:r(()=>[a("abc")]),_:1}),a(" 。 ")])])):e(t).operator!=null&&e(t).operator.dataType=="version"?(o(),u("div",bl,[s(N,{type:"text",name:"value",modelValue:e(t).rule.value,"onUpdate:modelValue":i[12]||(i[12]=n=>e(t).rule.value=n),onInput:e(t).changeRuleValue,style:{width:"10em"},maxlength:"100",class:"w-full",placeholder:"对比版本号"},null,8,["modelValue","onInput"]),l("p",wl,[a("输入和参数对比的版本号，比如 "),s(b,null,{default:r(()=>[a("1.2.7")]),_:1}),a(" 。 ")])])):e(t).operator!=null&&e(t).operator.dataType=="versionRange"?(o(),u("div",Il,[s(N,{type:"text",name:"value",modelValue:e(t).rule.value,"onUpdate:modelValue":i[13]||(i[13]=n=>e(t).rule.value=n),onInput:e(t).changeRuleValue,style:{width:"10em"},maxlength:"100",class:"w-full",placeholder:"版本号范围"},null,8,["modelValue","onInput"]),l("p",Ul,[a("输入和参数对比的版本号范围，比如 "),s(b,null,{default:r(()=>[a("1.2.7,1.3.7")]),_:1}),a(" 。 ")])])):e(t).operator!=null&&e(t).operator.dataType=="ip"?(o(),u("div",Ol,[s(N,{type:"text",name:"value",modelValue:e(t).rule.value,"onUpdate:modelValue":i[14]||(i[14]=n=>e(t).rule.value=n),onInput:e(t).changeRuleValue,style:{width:"16em"},maxlength:"100",class:"w-full",placeholder:"对比IP"},null,8,["modelValue","onInput"]),l("p",Nl,[a("输入和参数对比的IP，比如 "),s(b,null,{default:r(()=>[a("192.168.2.100")]),_:1}),a(" 。 ")])])):(o(),u("div",Dl,[s(M,{rows:"3",maxlength:"4096",name:"value",modelValue:e(t).rule.value,"onUpdate:modelValue":i[15]||(i[15]=n=>e(t).rule.value=n),onInput:e(t).changeRuleValue,class:"w-full"},null,8,["modelValue","onInput"]),e(t).operator!=null&&e(t).operator.dataType=="strings"?(o(),u("p",Pl,"每行一个数据。")):d("",!0),e(t).operator!=null&&e(t).operator.dataType=="regexp"?(o(),u("p",Rl,[a("正则表达式中对于要匹配的内容中的特殊字符需要转义处理（即在字符前面加入反斜杠\\），比如 "),s(b,null,{default:r(()=>[a(".?*+()[]{}^$\\")]),_:1}),a(" 等符号要变成 "),s(b,null,{default:r(()=>[a("\\.\\?\\*\\+\\(\\)\\[\\]\\{\\}\\^\\$\\\\")]),_:1}),a(" 。 ")])):d("",!0)])),e(t).operator!=null&&e(t).operator.dataType=="regexp"&&e(t).rule.value.match(/\n/)?(o(),u("p",El,[l("span",Bl,[a("警告：发现你填写的正则表达式中包含了换行符，如果你的意图是每行都表示不同的选项，那么请使用竖杠（"),s(b,null,{default:r(()=>[a("|")]),_:1}),a("）符号代替换行符，比如把"),s(b,null,{default:r(()=>[a("a换行b换行c换行")]),_:1}),a("改成"),s(b,null,{default:r(()=>[a("a|b|c")]),_:1}),a("，"),l("a",{href:"",onClick:i[16]||(i[16]=B((...n)=>e(t).convertValueLine&&e(t).convertValueLine(...n),["prevent"]))},"[帮我转换]"),a("。")])])):d("",!0),l("div",Ll,[e(t).checkpoint!=null&&e(t).checkpoint.prefix=="geoCountryName"?(o(),u("div",Sl,[s(z,{title:"已添加",width:"14em","data-url":"/ui/countryOptions","data-key":"countries",placeholder:"点这里选择国家/地区",onChange:e(t).selectGeoCountryName,ref_key:"countryComboBox",ref:_,key:"combo-box-country"},null,8,["onChange"])])):d("",!0),e(t).checkpoint!=null&&e(t).checkpoint.prefix=="geoProvinceName"?(o(),u("div",Al,[s(z,{title:"已添加","data-url":"/ui/provinceOptions","data-key":"provinces",placeholder:"点这里选择省份名称",onChange:e(t).selectGeoProvinceName,ref_key:"provinceComboBox",ref:m,key:"combo-box-province"},null,8,["onChange"])])):d("",!0),e(t).checkpoint!=null&&e(t).checkpoint.prefix=="geoCityName"?(o(),u("div",Fl,[s(z,{title:"已添加","data-url":"/ui/cityOptions","data-key":"cities",placeholder:"点这里选择城市名称",onChange:e(t).selectGeoCityName,ref_key:"cityComboBox",ref:g,key:"combo-box-city"},null,8,["onChange"])])):d("",!0),e(t).checkpoint!=null&&e(t).checkpoint.prefix=="ispName"?(o(),u("div",Hl,[s(z,{title:"已添加","data-url":"/ui/providerOptions","data-key":"providers",placeholder:"点这里选择ISP名称",onChange:e(t).selectISPName,ref_key:"ispComboBox",ref:$,key:"combo-box-isp"},null,8,["onChange"])])):d("",!0)])])],512),[[j,e(t).operator!=null&&e(t).operator.dataType!="none"]]),e(t).operator!=null&&e(t).operator.dataType=="regexp"?(o(),u("tr",Gl,[Ml,l("td",null,[e(t).regexpTestIsOn?d("",!0):(o(),u("a",{key:0,href:"",onClick:i[17]||(i[17]=B((...n)=>e(t).changeRegexpTestIsOn&&e(t).changeRegexpTestIsOn(...n),["prevent"]))},"[输入测试字符串]")),e(t).regexpTestIsOn?(o(),u("div",zl,[s(M,{placeholder:"输入要测试的内容",rows:"3",modelValue:e(t).regexpTestBody,"onUpdate:modelValue":i[18]||(i[18]=n=>e(t).regexpTestBody=n),ref_key:"regexpTestBody",ref:h,onInput:e(t).changeRegexpTestBody,class:"w-full"},null,8,["modelValue","onInput"]),l("p",Kl,[e(t).regexpTestResult.isOk?(o(),u("span",Jl,w(e(t).regexpTestResult.message),1)):d("",!0),e(t).regexpTestResult.isOk?d("",!0):(o(),u("span",Wl,w(e(t).regexpTestResult.message),1)),a("   "),l("a",{href:"",onClick:i[19]||(i[19]=B((...n)=>e(t).changeRegexpTestIsOn&&e(t).changeRegexpTestIsOn(...n),["prevent"]))},"[结束测试]")])])):d("",!0)])])):d("",!0),(e(t).checkpoint==null||e(t).checkpoint.dataType!="bool")&&e(t).operator!=null&&e(t).operator.case!="none"?(o(),u("tr",jl,[ql,l("td",null,[s(H,{name:"case",value:"1",modelValue:e(t).rule.isCaseInsensitive,"onUpdate:modelValue":i[20]||(i[20]=n=>e(t).rule.isCaseInsensitive=n),onChange:e(t).changeCaseInsensitive},null,8,["modelValue","onChange"]),Yl])])):d("",!0),l("tr",null,[l("td",Ql,[s(de)])]),e(t).moreOptionsVisible&&e(t).checkpoint!=null&&!e(t).checkpoint.isComposed?(o(),u("tr",Xl,[Zl,l("td",null,[s(Pt,{"v-filters":e(t).rule.paramFilters},null,8,["v-filters"])])])):d("",!0),W(l("tr",null,[en,l("td",null,[s(N,{type:"text",name:"description",modelValue:e(t).rule.description,"onUpdate:modelValue":i[21]||(i[21]=n=>e(t).rule.description=n),class:"w-full"},null,8,["modelValue"])])],512),[[j,e(t).moreOptionsVisible]])],512),[[j,e(t).checkpoint!=null&&!e(t).checkpoint.isComposed]])]),_:1}),s(ue)]),_:1},8,["onSuccess"])]),_:1}))}};export{Dn as default};
