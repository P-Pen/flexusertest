import{P as X}from"./app-BnDFQ2zy.js";import{i as Y,c as Z}from"./app-DISTCiac.js";import{_ as ee}from"./app-_N2IGwgj.js";import{_ as ne}from"./app-57xpzLDR.js";import{r as $,o as f,g as h,F as te,D as le,b as s,w as v,f as i,t as N,u as n,h as k,J as x,a as e,d,e as c,bc as g,ak as oe,bb as O,i as M,c as P,E as q}from"./app-BYx064nO.js";import{_ as R}from"./app--BlRpVz_.js";import{_ as U}from"./app-CryyhHYs.js";import{a as b,_ as se}from"./app-BuHt2kYS.js";import{_ as ae}from"./app-C5GVF480.js";import{_ as ie}from"./app-1SA4suwN.js";import{_ as A}from"./app-CaWL-qGV.js";import{C as w}from"./app-IrmNFWm4.js";import{_ as D}from"./app-CM0k0GHT.js";import"./app-CHxME8Sw.js";import{_ as ue}from"./app-Bx5jiAm1.js";import{_ as re}from"./app-CxVImP9a.js";import{_ as de,a as ce,b as me,c as pe,d as fe,e as _e,f as ve,g as he,h as Ce,i as ge,j as Re,k as ke,l as ye,m as $e,n as be}from"./app-CQ7Bmnfp.js";import{D as Ve}from"./app-D0jdtzyy.js";import"./app-GoR2fTOd.js";import"./app-DR284fT9.js";import"./app-tUtHmy3n.js";import"./app-CK9Tk_hc.js";import"./app-DNadG4GC.js";import"./app-DPMEyUYH.js";import"./app-TBcc1obG.js";import"./app-51hQc1Cd.js";import"./app-CqAVEB_b.js";import"./app-Cqxz9tud.js";import"./app-DoRtcMJm.js";import"./app-aIb4ksxL.js";import"./app-DYkSpHuE.js";import"./app-DyIe33QU.js";function we(){Y(this),this.success=this.$NotifyPopup,this.cacheRef=null,window.parent.UPDATING_CACHE_REF!=null&&(this.cacheRef=window.parent.UPDATING_CACHE_REF,this.isReverse=this.cacheRef.isReverse)}const Ie={key:0},xe={__name:"RequestVariablesDescriber",setup(I,{expose:_}){const{vars:y}=function(){return{vars:$([])}}(),l=function(r){y.value=[],r.replace(/\${.+?}/g,function(p){let m=u(p);if(m==null)return p;y.value.push(m)})},u=function(r){let p=null;return window.REQUEST_VARIABLES.forEach(function(m){m.code==r&&(p=m)}),p};return _({update:l}),(r,p)=>(f(),h("span",null,[(f(!0),h(te,null,le(n(y),(m,C)=>(f(),h("span",null,[s(w,{title:m.description},{default:v(()=>[i(N(m.code),1)]),_:2},1032,["title"]),i(" - "+N(m.name),1),C<n(y).length-1?(f(),h("span",Ie,"；")):k("",!0)]))),256))]))}},Pe={class:"ui table definition"},Se=e("td",{class:"title"},"启用",-1),Te={class:"comment"},Ee=e("td",null,"覆盖源站设置",-1),Oe={class:"comment"},Ue=e("td",null,"自动计算时间",-1),Ne=e("p",{class:"comment"},"根据已设置的缓存有效期进行计算。",-1),qe=e("td",null,"强制缓存时间",-1),ze=e("p",{class:"comment"},"从客户端访问的时间开始要缓存的时长。",-1),Me={__name:"HTTPExpiresTimeConfigBox",props:["v-expires-time"],emits:["change"],setup(I,{emit:_}){const y=I,l=_,{expiresTime:u}=function(){let p=y.vExpiresTime;return p==null&&(p={isPrior:!1,isOn:!1,overwrite:!0,autoCalculate:!0,duration:{count:-1,unit:"hour"}}),{expiresTime:$(p)}}(),r=function(){l("change",u.value)};return x(()=>u.value.isPrior,function(){r()}),x(()=>u.value.isOn,function(){r()}),x(()=>u.value.overwrite,function(){r()}),x(()=>u.value.autoCalculate,function(){r()}),(p,m)=>(f(),h("div",null,[e("table",Pe,[s(ue,{"v-config":n(u)},null,8,["v-config"]),d(e("tbody",null,[e("tr",null,[Se,e("td",null,[s(R,{modelValue:n(u).isOn,"onUpdate:modelValue":m[0]||(m[0]=C=>n(u).isOn=C)},null,8,["modelValue"]),e("p",Te,[i("启用后，将会在响应的Header中添加 "),s(w,null,{default:v(()=>[i("Expires")]),_:1}),i(" 字段，浏览器据此会将内容缓存在客户端；同时，在管理后台执行清理缓存时，也将无法清理客户端已有的缓存。 ")])])]),d(e("tr",null,[Ee,e("td",null,[s(R,{modelValue:n(u).overwrite,"onUpdate:modelValue":m[1]||(m[1]=C=>n(u).overwrite=C)},null,8,["modelValue"]),e("p",Oe,[i("选中后，会覆盖源站Header中已有的 "),s(w,null,{default:v(()=>[i("Expires")]),_:1}),i(" 字段。 ")])])],512),[[c,n(u).isPrior&&n(u).isOn]]),d(e("tr",null,[Ue,e("td",null,[s(R,{modelValue:n(u).autoCalculate,"onUpdate:modelValue":m[2]||(m[2]=C=>n(u).autoCalculate=C)},null,8,["modelValue"]),Ne])],512),[[c,n(u).isPrior&&n(u).isOn]]),d(e("tr",null,[qe,e("td",null,[s(D,{"v-value":n(u).duration,onChange:r},null,8,["v-value"]),ze])],512),[[c,n(u).isPrior&&n(u).isOn&&!n(u).autoCalculate]])],512),[[c,n(u).isPrior]])])]))}},Ae={key:0},De=e("td",{class:"title"},"缓存对象 *",-1),Le={class:"comment !mt-4"},Be={key:1},Fe={key:1,class:"ui table definition"},He={key:2},Ke=e("td",null,"不区分大小写",-1),Qe=e("p",{class:"comment"},"选中后表示对比时忽略参数值的大小写。",-1),Ge={key:3},Je=e("td",{class:"title"},"匹配条件分组 *",-1),je={class:"comment !mt-4"},We=e("td",null,"缓存有效期 *",-1),Xe=e("td",null,"忽略URI参数",-1),Ye=e("p",{class:"comment"},"选中后，表示缓存Key中不包含URI参数（即问号（?））后面的内容。",-1),Ze={colspan:"2"},en=e("td",null,"缓存Key *",-1),nn={class:"comment"},tn=e("td",null,"请求方法限制",-1),ln=e("p",{class:"comment"},"允许请求的缓存方法，默认支持所有的请求方法。",-1),on=e("td",null,[i("客户端过期时间"),e("em",null,"（Expires）")],-1),sn=e("td",null,"可缓存的最大内容尺寸",-1),an=e("p",{class:"comment"},"内容尺寸如果高于此值则不缓存。",-1),un=e("td",null,"可缓存的最小内容尺寸",-1),rn=e("p",{class:"comment"},"内容尺寸如果低于此值则不缓存。",-1),dn=e("td",null,"支持缓存分片内容",-1),cn={class:"comment"},mn=e("td",null,"强制返回分片内容",-1),pn={class:"comment"},fn=e("td",null,"强制Range回源",-1),_n=e("p",{class:"comment"},"选中后，表示把所有包含Range报头的请求都转发到源站，而不是尝试从缓存中读取。",-1),vn=e("td",null,"状态码列表",-1),hn=e("p",{class:"comment"},"允许缓存的HTTP状态码列表。",-1),Cn=e("td",null,[i("跳过的"),e("br"),i("Cache-Control值")],-1),gn=e("p",{class:"comment"},"当响应的Cache-Control为这些值时不缓存响应内容，而且不区分大小写。",-1),Rn=e("td",null,"跳过Set-Cookie",-1),kn=e("p",{class:"comment"},"选中后，当响应的报头中有Set-Cookie时不缓存响应内容，防止动态内容被缓存。",-1),yn=e("td",null,[i("支持请求"),e("br"),i("no-cache刷新")],-1),$n=e("p",{class:"comment"},"选中后，当请求的报头中含有Pragma: no-cache或Cache-Control: no-cache时，会跳过缓存直接读取源内容，一般仅用于调试。",-1),bn=e("td",null,[i("允许"),e("br"),i("If-None-Match回源")],-1),Vn=e("p",{class:"comment"},"特殊情况下才需要开启，可能会降低缓存命中率。",-1),wn=e("td",null,[i("允许"),e("br"),i("If-Modified-Since回源")],-1),In=e("p",{class:"comment"},"特殊情况下才需要开启，可能会降低缓存命中率。",-1),xn=e("td",null,"允许异步读取源站",-1),Pn=e("p",{class:"comment"},"试验功能。允许客户端中断连接后，仍然继续尝试从源站读取内容并缓存。",-1),Sn=e("td",null,"支持分段内容",-1),Tn=e("p",{class:"comment"},"选中后，Gzip等压缩后的Chunked内容可以直接缓存，无需检查内容长度。",-1),En={colspan:"2"},On=["value"],Un={__name:"HTTPCacheRefBox",props:["v-cache-ref","v-is-reverse"],setup(I){const _=I,y=$();window.REQUEST_COND_COMPONENTS.forEach(t=>{switch(t.component){case"http-cond-url-extension":t.component=g(be);break;case"http-cond-url-eq-index":t.component=g($e);break;case"http-cond-url-all":t.component=g(ye);break;case"http-cond-url-prefix":t.component=g(ke);break;case"http-cond-url-eq":t.component=g(Re);break;case"http-cond-url-regexp":t.component=g(ge);break;case"http-cond-url-wildcard-match":t.component=g(Ce);break;case"http-cond-user-agent-regexp":t.component=g(he);break;case"http-cond-params":t.component=g(ve);break;case"http-cond-url-not-extension":t.component=g(_e);break;case"http-cond-url-not-prefix":t.component=g(fe);break;case"http-cond-url-not-eq":t.component=g(pe);break;case"http-cond-url-not-regexp":t.component=g(me);break;case"http-cond-user-agent-not-regexp":t.component=g(ce);break;case"http-cond-mime-type":t.component=g(de);break}});const{cacheRef:l,keyIgnoreArgs:u,moreOptionsVisible:r,condCategory:p,condType:m,condComponent:C,condIsCaseInsensitive:S,components:L}=function(){let t=_.vCacheRef;t==null&&(t={isOn:!0,cachePolicyId:0,key:"${scheme}://${host}${requestPath}${isArgs}${args}",life:{count:1,unit:"day"},status:[200],maxSize:{count:128,unit:"mb"},minSize:{count:0,unit:"kb"},skipCacheControlValues:["private","no-cache","no-store"],skipSetCookie:!0,enableRequestCachePragma:!1,conds:null,simpleCond:null,allowChunkedEncoding:!0,allowPartialContent:!0,forcePartialContent:!1,enableIfNoneMatch:!1,enableIfModifiedSince:!1,enableReadingOriginAsync:!1,isReverse:_.vIsReverse,methods:[],expiresTime:{isPrior:!1,isOn:!1,overwrite:!0,autoCalculate:!0,duration:{count:-1,unit:"hour"}}}),t.key==null&&(t.key=""),t.methods==null&&(t.methods=[]),t.life==null&&(t.life={count:2,unit:"hour"}),t.maxSize==null&&(t.maxSize={count:32,unit:"mb"}),t.minSize==null&&(t.minSize={count:0,unit:"kb"});let o="url-extension",a=window.REQUEST_COND_COMPONENTS.$find(function(V,E){return E.type=="url-extension"});return{cacheRef:$(t),keyIgnoreArgs:$(typeof t.key=="string"&&t.key.indexOf("${args}")<0),moreOptionsVisible:$(!1),condCategory:$("simple"),condType:$(o),condComponent:$(a),condIsCaseInsensitive:$(t.simpleCond!=null?t.simpleCond.isCaseInsensitive:!0),components:$(window.REQUEST_COND_COMPONENTS)}}(),B=function(t){r.value=t},F=function(t){l.value.life=t},H=function(t){l.value.maxSize=t},K=function(t){l.value.minSize=t},Q=function(t){l.value.conds=t,l.value.simpleCond=null},G=function(t){let o=[];t.forEach(function(a){let V=parseInt(a);isNaN(V)||V<100||V>999||o.push(V)}),l.value.status=o},J=function(t){l.value.methods=t.map(function(o){return o.toUpperCase()})},j=function(t){y.value.update(t)},W=function(t){l.value.expiresTime=t},T=function(t){p.value=t;let o=window.parent.document.querySelector("*[role='dialog']");if(o!=null)switch(p.value){case"simple":o.style.width="45em";break;case"complex":let a=window.innerWidth;a>1024&&(a=1024),o.style.width=a+"px",l.value.conds!=null&&(l.value.conds.isOn=!0);break}},z=function(t,o){!o&&l.value.simpleCond!=null&&(l.value.simpleCond.value=null);let a=L.value.$find(function(V,E){return E.type==t});a!=null&&(C.value=a)};return x(u,function(t){if(typeof l.value.key=="string"){if(t){l.value.key=l.value.key.replace("${isArgs}${args}","");return}l.value.key.indexOf("${isArgs}")<0&&(l.value.key=l.value.key+"${isArgs}"),l.value.key.indexOf("${args}")<0&&(l.value.key=l.value.key+"${args}")}}),oe(()=>{y.value.update(l.value.key),l.value.simpleCond!=null?(m.value=l.value.simpleCond.type,z(l.value.simpleCond.type,!0),p.value="simple"):l.value.conds!=null&&l.value.conds.groups!=null&&(p.value="complex"),T(p.value)}),(t,o)=>(f(),h("tbody",null,[n(p)=="simple"?(f(),h("tr",Ae,[De,e("td",null,[s(se,{name:"condType",modelValue:n(m),"onUpdate:modelValue":o[0]||(o[0]=a=>O(m)?m.value=a:null),onChange:o[1]||(o[1]=a=>z(n(m),!1))},{default:v(()=>[s(b,{value:"url-extension"},{default:v(()=>[i("文件扩展名")]),_:1}),s(b,{value:"url-eq-index"},{default:v(()=>[i("首页")]),_:1}),s(b,{value:"url-all"},{default:v(()=>[i("全站")]),_:1}),s(b,{value:"url-prefix"},{default:v(()=>[i("URL目录前缀")]),_:1}),s(b,{value:"url-eq"},{default:v(()=>[i("URL完整路径")]),_:1}),s(b,{value:"url-wildcard-match"},{default:v(()=>[i("URL通配符")]),_:1}),s(b,{value:"url-regexp"},{default:v(()=>[i("URL正则匹配")]),_:1}),s(b,{value:"params"},{default:v(()=>[i("参数匹配")]),_:1})]),_:1},8,["modelValue"]),e("p",Le,[e("a",{href:"",onClick:o[2]||(o[2]=M(a=>T("complex"),["prevent"]))},"切换到复杂条件 »")])])])):k("",!0),n(p)=="simple"?(f(),h("tr",Be,[e("td",null,N(n(C).paramsTitle)+" *",1),e("td",null,[n(C).type!="params"?(f(),P(q(n(C).component),{key:0,"v-cond":n(l).simpleCond},null,8,["v-cond"])):k("",!0),n(C).type=="params"?(f(),h("table",Fe,[(f(),P(q(n(C).component),{"v-cond":n(l).simpleCond},null,8,["v-cond"]))])):k("",!0)])])):k("",!0),n(p)=="simple"&&n(C).caseInsensitive?(f(),h("tr",He,[Ke,e("td",null,[s(R,{name:"condIsCaseInsensitive",value:"1",modelValue:n(S),"onUpdate:modelValue":o[3]||(o[3]=a=>O(S)?S.value=a:null)},null,8,["modelValue"]),Qe])])):k("",!0),n(p)=="complex"?(f(),h("tr",Ge,[Je,e("td",null,[s(re,{"v-conds":n(l).conds,onChange:Q},null,8,["v-conds"]),e("p",je,[e("a",{href:"",onClick:o[4]||(o[4]=M(a=>T("simple"),["prevent"]))},"« 切换到简单条件")])])])):k("",!0),d(e("tr",null,[We,e("td",null,[s(D,{"v-value":n(l).life,onChange:F,"v-min-unit":"minute",maxlength:"4"},null,8,["v-value"])])],512),[[c,!t.vIsReverse]]),d(e("tr",null,[Xe,e("td",null,[s(R,{modelValue:n(u),"onUpdate:modelValue":o[5]||(o[5]=a=>O(u)?u.value=a:null)},null,8,["modelValue"]),Ye])],512),[[c,!t.vIsReverse]]),d(e("tr",null,[e("td",Ze,[s(ie,{onChange:B})])],512),[[c,!t.vIsReverse]]),d(e("tr",null,[en,e("td",null,[s(ae,{type:"text",modelValue:n(l).key,"onUpdate:modelValue":o[6]||(o[6]=a=>n(l).key=a),onInput:o[7]||(o[7]=a=>j(n(l).key)),class:"w-full"},null,8,["modelValue"]),e("p",nn,[i("用来区分不同缓存内容的唯一Key。 "),s(xe,{ref_key:"variablesDescriberRef",ref:y},null,512),i(" 。 ")])])],512),[[c,n(r)&&!t.vIsReverse]]),d(e("tr",null,[tn,e("td",null,[s(U,{size:"5",maxlength:"10",values:n(l).methods,onChange:J},null,8,["values"]),ln])],512),[[c,n(r)&&!t.vIsReverse]]),d(e("tr",null,[on,e("td",null,[s(Me,{"v-expires-time":n(l).expiresTime,onChange:W},null,8,["v-expires-time"])])],512),[[c,n(r)&&!t.vIsReverse]]),d(e("tr",null,[sn,e("td",null,[s(A,{"v-value":n(l).maxSize,onChange:H},null,8,["v-value"]),an])],512),[[c,n(r)&&!t.vIsReverse]]),d(e("tr",null,[un,e("td",null,[s(A,{"v-value":n(l).minSize,onChange:K},null,8,["v-value"]),rn])],512),[[c,n(r)&&!t.vIsReverse]]),d(e("tr",null,[dn,e("td",null,[s(R,{name:"allowPartialContent",value:"1",modelValue:n(l).allowPartialContent,"onUpdate:modelValue":o[8]||(o[8]=a=>n(l).allowPartialContent=a)},null,8,["modelValue"]),e("p",cn,[i("选中后，支持缓存源站返回的某个分片的内容，该内容通过 "),s(w,null,{default:v(()=>[i("206 Partial Content")]),_:1}),i(" 状态码返回。 ")])])],512),[[c,n(r)&&!t.vIsReverse]]),d(e("tr",null,[mn,e("td",null,[s(R,{name:"forcePartialContent",value:"1",modelValue:n(l).forcePartialContent,"onUpdate:modelValue":o[9]||(o[9]=a=>n(l).forcePartialContent=a)},null,8,["modelValue"]),e("p",pn,[i("选中后，表示无论客户端是否发送 "),s(w,null,{default:v(()=>[i("Range")]),_:1}),i(" 报头，都会优先尝试返回已缓存的分片内容；如果你的应用有不支持分片内容的客户端（比如有些下载软件不支持 "),s(w,null,{default:v(()=>[i("206 Partial Content")]),_:1}),i(" ），请务必关闭此功能。 ")])])],512),[[c,n(r)&&!t.vIsReverse&&n(l).allowPartialContent&&!n(l).alwaysForwardRangeReques]]),d(e("tr",null,[fn,e("td",null,[s(R,{modelValue:n(l).alwaysForwardRangeRequest,"onUpdate:modelValue":o[10]||(o[10]=a=>n(l).alwaysForwardRangeRequest=a)},null,8,["modelValue"]),_n])],512),[[c,n(r)&&!t.vIsReverse]]),d(e("tr",null,[vn,e("td",null,[s(U,{name:"statusList",size:"3",maxlength:"3",values:n(l).status,onChange:G},null,8,["values"]),hn])],512),[[c,n(r)&&!t.vIsReverse]]),d(e("tr",null,[Cn,e("td",null,[s(U,{name:"skipResponseCacheControlValues",size:"10",maxlength:"100",values:n(l).skipCacheControlValues},null,8,["values"]),gn])],512),[[c,n(r)&&!t.vIsReverse]]),d(e("tr",null,[Rn,e("td",null,[s(R,{value:"1",modelValue:n(l).skipSetCookie,"onUpdate:modelValue":o[11]||(o[11]=a=>n(l).skipSetCookie=a)},null,8,["modelValue"]),kn])],512),[[c,n(r)&&!t.vIsReverse]]),d(e("tr",null,[yn,e("td",null,[s(R,{name:"enableRequestCachePragma",value:"1",modelValue:n(l).enableRequestCachePragma,"onUpdate:modelValue":o[12]||(o[12]=a=>n(l).enableRequestCachePragma=a)},null,8,["modelValue"]),$n])],512),[[c,n(r)&&!t.vIsReverse]]),d(e("tr",null,[bn,e("td",null,[s(R,{modelValue:n(l).enableIfNoneMatch,"onUpdate:modelValue":o[13]||(o[13]=a=>n(l).enableIfNoneMatch=a)},null,8,["modelValue"]),Vn])],512),[[c,n(r)&&!t.vIsReverse]]),d(e("tr",null,[wn,e("td",null,[s(R,{modelValue:n(l).enableIfModifiedSince,"onUpdate:modelValue":o[14]||(o[14]=a=>n(l).enableIfModifiedSince=a)},null,8,["modelValue"]),In])],512),[[c,n(r)&&!t.vIsReverse]]),d(e("tr",null,[xn,e("td",null,[s(R,{modelValue:n(l).enableReadingOriginAsync,"onUpdate:modelValue":o[15]||(o[15]=a=>n(l).enableReadingOriginAsync=a)},null,8,["modelValue"]),Pn])],512),[[c,n(r)&&!t.vIsReverse]]),d(e("tr",null,[Sn,e("td",null,[s(R,{name:"allowChunkedEncoding",value:"1",modelValue:n(l).allowChunkedEncoding,"onUpdate:modelValue":o[16]||(o[16]=a=>n(l).allowChunkedEncoding=a)},null,8,["modelValue"]),Tn])],512),[[c,n(r)&&!t.vIsReverse]]),d(e("tr",null,[e("td",En,[e("input",{type:"hidden",name:"cacheRefJSON",value:JSON.stringify(n(l))},null,8,On)])],512),[[c,!1]])]))}},Nn={key:0},qn={key:1},zn={key:2},Mn={key:3},An={key:0,class:"comment"},Ct={__name:"createPopup",setup(I){const _=Z(new we);return(y,l)=>(f(),P(X,null,{default:v(()=>[!n(_).isReverse&&n(_).cacheRef==null?(f(),h("header",Nn,"添加缓存条件")):k("",!0),!n(_).isReverse&&n(_).cacheRef!=null?(f(),h("header",qn,"修改缓存条件")):k("",!0),n(_).isReverse&&n(_).cacheRef==null?(f(),h("header",zn,"添加不缓存条件")):k("",!0),n(_).isReverse&&n(_).cacheRef!=null?(f(),h("header",Mn,"修改不缓存条件")):k("",!0),s(ee,{action:"$",onSuccess:n(_).success},{default:v(()=>[s(Ve,null,{default:v(()=>[(f(),P(q(Un),{"v-cache-ref":n(_).cacheRef,"v-is-reverse":n(_).isReverse},null,8,["v-cache-ref","v-is-reverse"]))]),_:1}),n(_).isReverse?(f(),h("p",An,"如果请求满足当前添加的条件，则不缓存。")):k("",!0),s(ne,null,{default:v(()=>[i("确定")]),_:1})]),_:1},8,["onSuccess"])]),_:1}))}};export{Ct as default};
