import{aa as x,r as L,C as D,o as s,g as n,b as c,w as _,f as l,t as d,u as e,a as p,h as i,F as $,D as S,d as F,n as C,i as w,c as b}from"./app-BYx064nO.js";import{i as A,c as U}from"./app-DISTCiac.js";import{_ as N}from"./app-BAIc7wsg.js";import{_ as H}from"./app-BKsB9XX9.js";import{_ as O}from"./app-CmboutmR.js";import{_ as W}from"./app-x_fVWXrx.js";import{s as v,L as V}from"./app-Vf6It1y-.js";import{T as z}from"./app-DNadG4GC.js";import"./app-CHxME8Sw.js";import{C as B}from"./app-D2_aZ1I5.js";import{C as k}from"./app-DzOFJRH2.js";import{_ as G}from"./app-B-EzfWu7.js";import"./app-BXvxi6wb.js";import"./app-C9w-bzHc.js";import"./app-DyIe33QU.js";import"./app-5V9SnxW6.js";import"./app-DOaxShSm.js";import"./app-CxqGeHsb.js";import"./app-Dj8c2KwC.js";import"./app-cRxw2ZDj.js";import"./app-Ncl-Sitd.js";import"./app-DoTJvLi7.js";import"./app-BZMTWmMM.js";import"./app-51hQc1Cd.js";import"./app-CqAVEB_b.js";import"./app-CK9Tk_hc.js";import"./app-Cqxz9tud.js";import"./app-DoRtcMJm.js";import"./app-aIb4ksxL.js";import"./app-DYkSpHuE.js";import"./app-CiA1rHoH.js";import"./app-RbQF51V8.js";import"./app-tUtHmy3n.js";import"./app-DGM5HqRo.js";import"./app-DG0hMi2p.js";import"./app-CBq6-G9z.js";import"./app-DPMEyUYH.js";import"./app-BXiLqtxA.js";import"./app-CqvvE0jO.js";import"./app-CAeEyuA3.js";function j(){const{utils:h}=A(this);this.highlightedSetId=0,this.$delay(function(){let o=localStorage.getItem("goHTTPFirewallRuleSet");o!=null&&(this.highlightedSetId=o,localStorage.removeItem("goHTTPFirewallRuleSet"),document.querySelector("*[data-set-id='"+o+"']").scrollIntoView({behavior:"smooth"}))}),this.updateGroup=function(o){h.popup("/servers/components/waf/updateGroupPopup?groupId="+o,{callback:function(){h.success("保存成功",function(){h.reload()})}})},this.createSet=function(o){let f=this;h.popup("/servers/components/waf/createSetPopup?firewallPolicyId="+this.firewallPolicyId+"&groupId="+o+"&type="+this.type,{width:"50em",height:"40em",callback:function(t){h.success("保存成功",function(){f.goSetId(t.data.setId)})}})},this.updateSet=function(o){let f=this;h.popup("/servers/components/waf/updateSetPopup?firewallPolicyId="+this.firewallPolicyId+"&groupId="+this.group.id+"&type="+this.type+"&setId="+o,{width:"50em",height:"40em",callback:function(){h.success("保存成功",function(){f.goSetId(o)})}})},this.updateSetOn=function(o,f){let t=this;this.$post("/servers/components/waf/updateSetOn").params({setId:o,isOn:f?1:0}).success(function(){t.goSetId(o)})},this.deleteSet=function(o){let f=this;h.confirm("确定要删除此规则集吗？",function(){f.$post("/servers/components/waf/deleteSet").params({groupId:this.group.id,setId:o}).refresh()})},this.showSetCode=function(o){h.popup("/servers/components/waf/setCodePopup?setId="+o,{height:h.POPUP_HEIGHT_LG})},this.goSetId=function(o){localStorage.setItem("goHTTPFirewallRuleSet",o),h.reload()},this.sortTable=function(o){this.$post("/servers/components/waf/sortSets").params({groupId:that.group.id,setIds:o}).success(function(){h.successToast("排序保存成功")})}}const K=["title"],M={class:"small grey"},q={key:0},X={key:1},J={key:0},Q={key:1},Y={key:2},Z={key:1,class:"hover"},ee={key:2,class:"disabled",style:{"font-weight":"normal"},title:"空字符串"},te={key:3,class:"grey small"},oe={__name:"HTTPFirewallRuleLabel",props:["v-rule"],setup(h){const o=x("$utils"),f=h,{rule:t}=function(){return{rule:L(f.vRule)}}(),r=function(a){o.popupTip('规则校验错误，请修正：<span class="red">'+o.encodeHTML(a)+"</span>")},y=function(a){let u="";return a!=null&&window.WAF_RULE_CHECKPOINTS.forEach(function(m){(a=="${"+m.prefix+"}"||a.startsWith("${"+m.prefix+"."))&&(u=m.name)}),u},R=function(a){let u="",m="";return a!=null&&window.WAF_RULE_CHECKPOINTS.forEach(function(g){(a=="${"+g.prefix+"}"||a.startsWith("${"+g.prefix+"."))&&(u=g.name,m=g.description)}),u+": "+m},T=function(a){let u=a;return typeof window.WAF_RULE_OPERATORS!=null&&window.WAF_RULE_OPERATORS.forEach(function(m){m.code==a&&(u=m.name)}),u},I=function(a){let u=a,m="";return typeof window.WAF_RULE_OPERATORS!=null&&window.WAF_RULE_OPERATORS.forEach(function(g){g.code==a&&(u=g.name,m=g.description)}),u+": "+m.replace("${docURL}",o.CURRENT_CTX.teaDocURL)},E=function(a){let u="none";return typeof window.WAF_RULE_OPERATORS!=null&&window.WAF_RULE_OPERATORS.forEach(function(m){m.code==a&&(u=m.dataType)}),u},P=function(a){return typeof a=="string"&&a.length==0};return(a,u)=>{const m=D("tooltip");return s(),n("div",null,[c(z,{outlined:"",size:"small"},{default:_(()=>[l(d(e(t).name)+" ",1),p("span",{title:R(e(t).param),class:"hover"},[l(d(y(e(t).param))+" ",1),p("span",M,d(e(t).param),1)],8,K),l("  "),e(t).param=="${cc}"?(s(),n("span",q,d(e(t).checkpointOptions.period)+"秒内请求数 ",1)):i("",!0),e(t).param=="${refererBlock}"?(s(),n("span",X,[e(t).checkpointOptions.allowDomains!=null&&e(t).checkpointOptions.allowDomains.length>0?(s(),n("span",J,"允许"+d(e(t).checkpointOptions.allowDomains),1)):i("",!0),e(t).checkpointOptions.denyDomains!=null&&e(t).checkpointOptions.denyDomains.length>0?(s(),n("span",Q,"禁止"+d(e(t).checkpointOptions.denyDomains),1)):i("",!0)])):(s(),n("span",Y,[e(t).paramFilters!=null&&e(t).paramFilters.length>0?(s(!0),n($,{key:0},S(e(t).paramFilters,g=>(s(),n("span",null," | "+d(g.code),1))),256)):i("",!0),F((s(),n("span",{class:C(["hover",{dash:!e(t).isComposed&&e(t).isCaseInsensitive}])},[l("<"+d(T(e(t).operator))+">",1)],2)),[[m,{value:I(e(t).operator)+(!e(t).isComposed&&e(t).isCaseInsensitive?"<br/>[大小写不敏感] ":""),escape:!1}]]),l("  "),P(e(t).value)?E(e(t).operator)!="none"?(s(),n("span",ee,"[空]")):i("",!0):(s(),n("span",Z,d(e(t).value),1))])),e(t).description!=null&&e(t).description.length>0?(s(),n("span",te,"（"+d(e(t).description)+"）",1)):i("",!0),e(t).err!=null&&e(t).err.length>0?(s(),n("a",{key:4,href:"",onClick:u[0]||(u[0]=w(g=>r(e(t).err),["prevent"])),style:{color:"#db2828",opacity:"1","border-bottom":"1px #db2828 dashed","margin-left":"0.5em"}},"规则错误")):i("",!0)]),_:1})])}}},se={style:{"margin-bottom":"0.3em"}},ne={key:0},re={key:0,class:"grey small"},ie={key:1,class:"grey small"},ae={key:0},le={key:1},pe={key:2},ce={key:2,class:"grey small"},de={key:0,class:"red"},ue={key:1,class:"green"},me={key:2,class:"grey"},_e={__name:"HTTPFirewallActionsView",props:["v-actions"],setup(h){return(o,f)=>(s(),n("div",null,[(s(!0),n($,null,S(o.vActions,t=>(s(),n("div",se,[p("span",{class:C({red:t.category=="block",orange:t.category=="verify",green:t.category=="allow"})},[l(d(t.name)+" ("+d(t.code.toUpperCase())+") ",1),t.options!=null?(s(),n("div",ne,[t.code.toLowerCase()=="page"?(s(),n("span",re,"["+d(t.options.status)+"]",1)):i("",!0),t.code.toLowerCase()=="allow"&&t.options!=null&&t.options.scope!=null&&t.options.scope.length>0?(s(),n("span",ie,[t.options.scope=="group"?(s(),n("span",ae,"[分组]")):i("",!0),t.options.scope=="server"?(s(),n("span",le,"[网站]")):i("",!0),t.options.scope=="global"?(s(),n("span",pe,"[网站和策略]")):i("",!0)])):i("",!0),t.code.toLowerCase()=="record_ip"?(s(),n("span",ce,[t.options.type=="black"?(s(),n("span",de,"黑名单")):i("",!0),t.options.type=="white"?(s(),n("span",ue,"白名单")):i("",!0),t.options.type=="grey"?(s(),n("span",me,"灰名单")):i("",!0)])):i("",!0)])):i("",!0)],2)]))),256))]))}},he={class:"mb-4"},fe={key:0,class:"disabled"},ge={key:1},ye={class:"group-header"},we={key:1},ve=["data-set-id"],ke=["name"],$e=["onClick"],Se=p("i",{class:"pi pi-expand small"},null,-1),Ce={style:{"margin-top":"0.5em"}},be={style:{"margin-top":"0.4em","margin-bottom":"0.4em"}},Oe={key:0,class:"ui disabled"},Re={class:"flex items-center gap-2 justify-center whitespace-nowrap"},Te={key:0},Ie={key:0},Ee={key:1},Pe={class:"small grey"},xe={key:1,class:"disabled"},Le=["onClick"],De=["onClick"],Fe=["onClick"],Ae=p("span",{class:"red"},"启用",-1),Ue=[Ae],Ne=["onClick"],He=["onClick"],We={key:0,class:"comment flex items-center"},Ve=p("i",{class:"icon bars"},null,-1),Tt={__name:"group",setup(h){const o=U(new j);return(f,t)=>(s(),b(N,{ctx:e(o)},{default:_(()=>[c(H,{ctx:e(o),"active-tab":e(o).type},null,8,["ctx","active-tab"]),p("h5",he,[l(d(e(o).group.name),1),p("a",{href:"",onClick:t[0]||(t[0]=w(r=>e(o).updateGroup(e(o).group.id),["prevent"]))},"[修改]")]),c(B,null,{default:_(()=>[c(k,null,{name:_(()=>[l("名称")]),value:_(()=>[l(d(e(o).group.name),1)]),_:1}),c(k,null,{name:_(()=>[l("描述")]),value:_(()=>[e(o).group.description.length==0?(s(),n("span",fe,"暂时还没有描述。")):i("",!0),e(o).group.description.length>0?(s(),n("span",ge,d(e(o).group.description),1)):i("",!0)]),_:1}),c(k,null,{name:_(()=>[l("启用状态")]),value:_(()=>[c(O,{"v-is-on":e(o).group.isOn},null,8,["v-is-on"])]),_:1})]),_:1}),p("h5",ye,[l("规则集"),p("a",{href:"",onClick:t[1]||(t[1]=w(r=>e(o).createSet(e(o).group.id),["prevent"]))},"[添加规则集]")]),e(o).sets==null||e(o).sets.length==0?(s(),b(G,{key:0},{default:_(()=>[l("暂时还没有规则。")]),_:1})):i("",!0),e(o).sets!=null&&e(o).sets.length>0?(s(),n("div",we,[c(V,{items:e(o).sets,onSort:e(o).sortTable},{default:_(()=>[c(e(v),{rowReorder:"",headerStyle:"width: 3em",frozen:""}),c(e(v),{header:"规则集名称",class:"name-column",frozen:""},{body:_(({data:r})=>[p("a",{"data-set-id":r.id},null,8,ve),p("a",{name:"set"+r.id},null,8,ke),p("a",{href:"",onClick:w(y=>e(o).updateSet(r.id),["prevent"])},[p("span",{class:C({disabled:!r.isOn})},d(r.name),3),l("  "),Se],8,$e),p("p",Ce,[c(O,{"v-is-on":r.isOn},null,8,["v-is-on"])])]),_:1}),c(e(v),{header:"规则",style:{"min-width":"24em"}},{body:_(({data:r})=>[(s(!0),n($,null,S(r.rules,y=>(s(),n("div",be,[c(oe,{"v-rule":y},null,8,["v-rule"])]))),256)),r.rules.length==0?(s(),n("span",Oe,"暂时还没有规则")):i("",!0)]),_:1}),c(e(v),{class:"fixed-value-column text-center"},{header:_(()=>[p("div",Re,[l(" 规则关系 "),c(W,{content:"规则关系指的是<strong>单个规则集</strong>中的各个规则之间的关系，如果是“和(AND)”表示所有规则都必须满足条件，如果是“或(OR)”表示任一规则满足条件即可。<br/><br/>多个规则集之间没有任何关系，满足任一个规则集即停止向下匹配。"})])]),body:_(({data:r})=>[r.rules!=null&&r.rules.length>1?(s(),n("span",Te,[r.connector.toUpperCase()=="OR"?(s(),n("span",Ie,"或")):(s(),n("span",Ee,"和")),p("span",Pe,"("+d(r.connector.toUpperCase())+")",1)])):(s(),n("span",xe,"-"))]),_:1}),c(e(v),{header:"动作",class:"whitespace-nowrap"},{body:_(({data:r})=>[c(_e,{"v-actions":r.actions},null,8,["v-actions"])]),_:1}),c(e(v),{header:"操作",headerClass:"four op",frozen:"","align-frozen":"right"},{body:_(({data:r})=>[p("a",{href:"",onClick:w(y=>e(o).updateSet(r.id),["prevent"])},"修改",8,Le),l("   "),r.isOn?(s(),n("a",{key:0,href:"",onClick:w(y=>e(o).updateSetOn(r.id,!1),["prevent"])},"停用",8,De)):i("",!0),r.isOn?i("",!0):(s(),n("a",{key:1,href:"",onClick:w(y=>e(o).updateSetOn(r.id,!0),["prevent"])},Ue,8,Fe)),l("   "),p("a",{href:"",onClick:w(y=>e(o).showSetCode(r.id),["prevent"])},"代码",8,Ne),l("   "),p("a",{href:"",onClick:w(y=>e(o).deleteSet(r.id),["prevent"])},"删除",8,He)]),_:1})]),_:1},8,["items","onSort"]),e(o).group.sets!=null&&e(o).group.sets.length>1?(s(),n("p",We,[l("所有规则匹配顺序为从上到下，可以拖动左侧的"),Ve,l("排序。 ")])):i("",!0)])):i("",!0)]),_:1},8,["ctx"]))}};export{Tt as default};
