import{aa as D,r as E,o as n,g as h,j as z,n as U,c as g,w as a,a as m,f as l,u as t,t as y,h as f,b as r,L as j,i as $,F,D as P}from"./app-BYx064nO.js";import{P as B}from"./app-BnDFQ2zy.js";import{i as A,u as O,c as X}from"./app-DISTCiac.js";import{_ as G}from"./app-C5GVF480.js";import{T as L}from"./app-DR284fT9.js";import{_ as N}from"./app--BlRpVz_.js";import{_ as R}from"./app-DOex4tCl.js";import{_ as M}from"./app-266_x6q1.js";import{T}from"./app-DNadG4GC.js";import{s as v,L as K}from"./app-Vf6It1y-.js";import{_ as W}from"./app-B-EzfWu7.js";import"./app-GoR2fTOd.js";import"./app-DYkSpHuE.js";import"./app-tUtHmy3n.js";import"./app-CK9Tk_hc.js";import"./app-BZMTWmMM.js";import"./app-51hQc1Cd.js";import"./app-CqAVEB_b.js";import"./app-Cqxz9tud.js";import"./app-DoRtcMJm.js";import"./app-aIb4ksxL.js";import"./app-DyIe33QU.js";import"./app-CiA1rHoH.js";import"./app-DPMEyUYH.js";import"./app-DOaxShSm.js";import"./app-RbQF51V8.js";import"./app-DGM5HqRo.js";import"./app-DG0hMi2p.js";import"./app-CBq6-G9z.js";import"./app-BXiLqtxA.js";import"./app-CqvvE0jO.js";import"./app-CAeEyuA3.js";function q(){A(this),this.selectCert=function(i){this.$NotifyPopup({code:200,data:{cert:i,certRef:{isOn:!0,certId:i.id}}})},this.encodeURL=function(i){return window.encodeURIComponent(i)},this.countChecked=0,this.certs.forEach(function(i){i.isChecked=!1}),this.changeAll=function(i){let e=this;if(this.certs.forEach(function(u){u.isChecked=i}),i){let u=0;this.certs.forEach(function(c,s){c.isChecked&&!e.certInfos[s].isSelected&&u++}),this.countChecked=u}else this.countChecked=0},this.changeCertChecked=function(){let i=0;this.certs.forEach(function(e){e.isChecked&&i++}),this.countChecked=i},this.confirmChecked=function(){let i=[],e=[];this.certs.forEach(function(u){u.isChecked&&(i.push(u),e.push({isOn:!0,certId:u.id}))}),this.$NotifyPopup({code:200,data:{certs:i,certRefs:e}})}}const H={__name:"GetForm",props:["data","action","method"],emits:["error","done"],setup(i,{expose:e,emit:u}){const c=i,s=D("$Tea"),o=D("$popupState",null),p=O(),S=u,x=E(),V=C=>{if(!o)return;let _=c.action;(typeof _!="string"||_.length===0)&&(o?_=o.action.path:_=window.location.pathname);let b=c.data;if(b===void 0&&o&&(b={},new FormData(x.value).forEach((k,w)=>{b[w]=k})),typeof b=="object"){const d=s.serialize(b);d.length>0&&(_.indexOf("?")>0?_+="&"+d:_+="?"+d)}if(!o){window.location.href=_,C.preventDefault();return}if(C!=null&&C.preventDefault(),typeof c.method=="string"&&c.method.length>0&&c.method.toLowerCase()!="get"){console.error("'GetForm' says: invalid method: '"+c.method+"'");return}s.action(_).header("X-From-Front","1").error(d=>{console.error(d.message),S("error",d)}).done(()=>{S("done")}).timeout(30).success(d=>{if(o.url=_,d.data!=null&&typeof d.data=="object"){let k=window.X_VIEW_CTX;o&&(k=o.ctx);for(const w in d.data)k[w]=d.data[w]}}).alert((d,k,w)=>{typeof d=="string"&&d.length>0&&(w?p.success(d,()=>{typeof k=="function"?k():(c.refresh||c.refresh==="")&&s.reload()}):p.warn(d,()=>{typeof k=="function"?k():(c.refresh||c.refresh==="")&&s.reload()}))}).get()};return e({submit(C){V(C)}}),(C,_)=>(n(),h("form",{method:"get",class:"mb-4",onSubmit:V,ref_key:"formRef",ref:x},[z(C.$slots,"default")],544))}},J=["href"],I={__name:"ViewLink",props:{href:String,active:Boolean},setup(i){const e=D("$Tea"),u=D("$popupState",null),c=i,s=o=>{if(u==null)return;let p="";typeof c.href=="string"&&(p=c.href),!/^(http|https):\/\//i.test(p)&&(o.preventDefault(),e.reloadViewData(p))};return(o,p)=>(n(),h("a",{href:i.href,onClick:s,class:U({active:i.active})},[z(o.$slots,"default")],10,J))}},Q={key:0,class:"text-base gray"},Y={key:0,class:"not-italic"},Z=["value"],ee=["value"],te=["value"],se={class:"ui fields inline"},oe={class:"ui field"},ne={class:"ui field"},ae={key:0},ie={class:"flex gap-4 items-center"},re={class:"small"},ce=m("span",{class:"disabled item"},"|",-1),le={class:"small"},de={key:1,class:"mt-4"},he={key:0},ue={key:3,class:"mt-4"},fe=["onClick"],me={key:1},pe={key:2,class:"mt-1"},_e={class:"grey small"},ye={key:3,class:"mt-1"},ke={class:"label-group"},ge=["onClick"],Ce={key:1},et={__name:"selectPopup",setup(i){const e=X(new q);return(u,c)=>(n(),g(B,null,{default:a(()=>[m("header",null,[l("选择证书 "),t(e).searchingDomains.length>0?(n(),h("span",Q,[l("（当前网站域名："+y(t(e).searchingDomains[0]),1),t(e).searchingDomains.length>1?(n(),h("var",Y,"等"+y(t(e).searchingDomains.length)+"个域名",1)):f("",!0),l("）")])):f("",!0)]),r(H,{action:"/servers/certs/selectPopup"},{default:a(()=>[m("input",{type:"hidden",name:"selectedCertIds",value:t(e).selectedCertIds},null,8,Z),m("input",{type:"hidden",name:"searchingType",value:t(e).searchingType},null,8,ee),m("input",{type:"hidden",name:"searchingDomains",value:t(e).searchingDomains.join(",")},null,8,te),m("div",se,[m("div",oe,[r(G,{name:"keyword",modelValue:t(e).keyword,"onUpdate:modelValue":c[0]||(c[0]=s=>t(e).keyword=s),placeholder:"域名、说明文字等",size:"30"},null,8,["modelValue"])]),m("div",ne,[r(L,{secondary:"",type:"submit"},{default:a(()=>[l("搜索")]),_:1}),l("   "),t(e).keyword.length>0?(n(),g(I,{key:0,href:"/servers/certs/selectPopup?selectedCertIds="+t(e).selectedCertIds+"&searchingType="+t(e).searchingType+"&searchingDomains="+t(e).encodeURL(t(e).searchingDomains.join(","))},{default:a(()=>[l("[清除条件]")]),_:1},8,["href"])):f("",!0)])])]),_:1}),t(e).searchingDomains.length>0?(n(),h("div",ae,[r(j),m("div",ie,[r(I,{active:t(e).searchingType=="all",href:t(e).baseURL+"&searchingType=all"},{default:a(()=>[l("所有证书 "),m("span",re,"("+y(t(e).totalAll)+")",1)]),_:1},8,["active","href"]),ce,r(I,{active:t(e).searchingType=="match",href:t(e).baseURL+"&searchingType=match"},{default:a(()=>[l("域名匹配证书 "),m("span",le," ("+y(t(e).totalMatch)+")",1)]),_:1},8,["active","href"])])])):f("",!0),t(e).countChecked>0?(n(),h("div",de,[r(L,{secondary:"",outlined:"",type:"button",onClick:$(t(e).confirmChecked,["prevent"])},{default:a(()=>[l("使用选中的"+y(t(e).countChecked)+"个证书",1)]),_:1},8,["onClick"])])):f("",!0),t(e).certs.length==0?(n(),g(W,{key:2},{default:a(()=>[l("暂时还没有"),t(e).searchingType=="match"?(n(),h("span",he,"跟所添加域名匹配的")):f("",!0),l("相关证书。 ")]),_:1})):f("",!0),t(e).certs.length>0?(n(),h("div",ue,[r(K,{items:t(e).certs,dataKey:"id"},{default:a(()=>[r(t(v),{style:{width:"1em"},frozen:""},{header:a(()=>[r(N,{onChange:t(e).changeAll},null,8,["onChange"])]),body:a(({data:s,index:o})=>[t(e).certInfos[o].isSelected?f("",!0):(n(),g(N,{key:0,modelValue:s.isChecked,"onUpdate:modelValue":p=>s.isChecked=p,onChange:t(e).changeCertChecked},null,8,["modelValue","onUpdate:modelValue","onChange"]))]),_:1}),r(t(v),{header:"证书说明",class:"title-column",frozen:""},{body:a(({data:s,index:o})=>[t(e).certInfos[o].isSelected?f("",!0):(n(),h("a",{key:0,href:"",onClick:$(p=>t(e).selectCert(s),["prevent"])},[(n(),g(R,{key:t(e).keyword,"v-word":t(e).keyword},{default:a(()=>[l(y(s.name),1)]),_:2},1032,["v-word"]))],8,fe)),t(e).certInfos[o].isSelected?(n(),h("span",me,y(s.name),1)):f("",!0),s.commonNames!=null&&s.commonNames.length>0?(n(),h("div",pe,[m("span",_e,y(s.commonNames[s.commonNames.length-1]),1)])):f("",!0),s.isCA?(n(),h("div",ye,[r(T,{size:"tiny",class:"olive"},{default:a(()=>[l("CA")]),_:1})])):f("",!0)]),_:1}),r(t(v),{header:"域名",class:"domain-column"},{body:a(({data:s})=>[m("div",ke,[(n(!0),h(F,null,P(s.dnsNames,o=>(n(),h("div",null,[r(T,{outlined:""},{default:a(()=>[(n(),g(R,{key:t(e).keyword,"v-word":t(e).keyword},{default:a(()=>[l(y(o),1)]),_:2},1032,["v-word"]))]),_:2},1024)]))),256))])]),_:1}),r(t(v),{header:"过期日期",class:"date-column"},{body:a(({data:s,index:o})=>[l(y(t(e).certInfos[o].endDay),1)]),_:1}),r(t(v),{header:"引用网站",class:"value-column"},{body:a(({data:s,index:o})=>[l(y(t(e).certInfos[o].countServers),1)]),_:1}),r(t(v),{header:"状态",class:"status-column"},{body:a(({data:s,index:o})=>[t(e).certInfos[o].isExpired?(n(),g(T,{key:0,outlined:"",size:"small",class:"red"},{default:a(()=>[l("已过期")]),_:1})):(n(),g(T,{key:1,outlined:"",size:"small",class:"green"},{default:a(()=>[l("有效中")]),_:1}))]),_:1}),r(t(v),{header:"操作",class:"one op",frozen:"","align-frozen":"right"},{body:a(({data:s,index:o})=>[t(e).certInfos[o].isSelected?(n(),h("span",Ce,"已选")):(n(),h("a",{key:0,href:"",onClick:$(p=>t(e).selectCert(s),["prevent"])},"选择",8,ge))]),_:1})]),_:1},8,["items"]),r(M,{data:t(e).page},null,8,["data"])])):f("",!0)]),_:1}))}};export{et as default};
