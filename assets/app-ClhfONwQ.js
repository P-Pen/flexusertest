import{_ as I,o as n,g as m,a,j as D,c as p,h as _,L as $,b as r,u as e,w as l,i as b,d as S,e as V,F as g,f as u,D as x,t as o,n as T}from"./app-BYx064nO.js";import{i as L,c as R}from"./app-DISTCiac.js";import{e as M}from"./app-DUeSaIYz.js";import{_ as N,a as F}from"./app-BuHt2kYS.js";import{T as q}from"./app-DR284fT9.js";import{T as C}from"./app-2Kq8vdz-.js";import{_ as E}from"./app-BrIVTM_6.js";import{_ as U}from"./app-diI1Q6nu.js";import{M as v}from"./app-BSSZTTM7.js";import{L as j}from"./app-Vf6It1y-.js";import{_ as w}from"./app-CfEaOsVA.js";import{_ as A}from"./app-BoQP8Z_5.js";import"./app-51hQc1Cd.js";import"./app-CqAVEB_b.js";import"./app-CK9Tk_hc.js";import"./app-Cqxz9tud.js";import"./app-DoRtcMJm.js";import"./app-aIb4ksxL.js";import"./app-DYkSpHuE.js";import"./app-DyIe33QU.js";import"./app-kBNY2ZLt.js";import"./app-cRxw2ZDj.js";import"./app-DOaxShSm.js";import"./app-BTsdkGUZ.js";import"./app-C5GVF480.js";import"./app-DNadG4GC.js";import"./app-DPMEyUYH.js";/* empty css            */import"./app-BZMTWmMM.js";import"./app-CiA1rHoH.js";import"./app-RbQF51V8.js";import"./app-tUtHmy3n.js";import"./app-DGM5HqRo.js";import"./app-DG0hMi2p.js";import"./app-CBq6-G9z.js";import"./app-BXiLqtxA.js";import"./app-CqvvE0jO.js";import"./app-CAeEyuA3.js";function H(){const{utils:d}=L(this);d.setEcharts(M),this.servers=[],this.result=null,this.isLoading=!1,this.regionId=0,this.serverId=0,this.$delay(function(){this.$post(".serverOptions").params({}).success(function(t){this.servers=t.data.servers}),this.search()}),this.changeDayFrom=function(){this.search()},this.changeDayTo=function(){this.search()},this.changeServer=function(t){t!=null&&(this.serverId=t.value,this.search())},this.changeRegion=function(){this.search()},this.search=function(){this.isLoading=!0,this.result=null,this.$post("$").params({serverId:this.serverId,regionId:this.regionId,dayFrom:this.dayFrom,dayTo:this.dayTo}).success(function(t){let h=d.splitFormat(d.formatBytes(t.data.totalTrafficBytes)),c=d.splitFormat(d.formatBits(t.data.maxBandwidthBits)),s=d.splitFormat(d.formatBits(t.data.bandwidth95thBits));this.result={bandwidthStats:t.data.bandwidthStats,reversedBandwidthStats:t.data.bandwidthStats.$copy().reverse(),maxBandwidthBitsFormat:c,maxBandwidthTime:t.data.maxBandwidthTime,bandwidth95thBitsFormat:s,totalTrafficBytesFormat:h,totalTrafficRequests:d.formatCount(t.data.totalTrafficRequests)},this.reloadChart(t.data.bandwidthStats,t.data.bandwidth95thBits)}).done(function(){this.isLoading=!1})},this.tab="chart",this.selectTab=function(t){this.tab=t},this.reloadChart=function(t,h){let c=document.getElementById("bandwidth-chart");if(c==null||c.offsetHeight<=0){this.$delay(function(){this.reloadChart(t,h)},100);return}let s=d.bitsAxis(t,function(i){return i.bits});d.renderLineChart({id:"bandwidth-chart",values:t,axis:s,x:function(i){return i.day.substring(0,4)+"-"+i.day.substring(4,6)+"-"+i.day.substring(6)+" "+i.time.substring(0,2)+":"+i.time.substring(2)},xColor:function(i){return new Date().format("Y-m-d H:i")<i?"#cccccc":"default"},value:function(i){return typeof i.isNull=="boolean"&&i.isNull?null:i.bits/s.divider},tooltip:function(i,y){if(i.componentType=="markLine")return i.name;let B=i.dataIndex,f=y[B];return f.day.substring(0,4)+"-"+f.day.substring(4,6)+"-"+f.day.substring(6)+" "+f.time.substring(0,2)+":"+f.time.substring(2)+"<br/>带宽："+d.formatBits(y[B].bits)},left:30,right:40,cache:!1,markLine:{precision:4,data:[{name:this.percentile+"th",yAxis:h/s.divider}],symbol:"none",lineStyle:{color:d.chartColor("red")}}})},this.selectDay=function(t,h){this.dayFrom=t,this.dayTo=h,this.search()}}const z={class:"mt-1 flex flex-wrap gap-4 items-center"},G={__name:"FirstMenu",props:["hideDivider"],setup(d){return(t,h)=>(n(),m("div",null,[a("div",z,[D(t.$slots,"default",{},void 0,!0)]),d.hideDivider!==!0?(n(),p($,{key:0})):_("",!0)]))}},k=I(G,[["__scopeId","data-v-61d84c09"]]),O={class:"ui fields inline"},P={class:"ui field"},Y={class:"ui field"},J={class:"ui field"},K={key:0,class:"disabled"},Q={key:1},W={key:0,class:"ui field"},X={class:"ui field"},Z={class:"ui column"},tt=a("h5",null,"带宽峰值",-1),et={class:"value"},st=a("br",null,null,-1),at={key:0,class:"small grey"},it={key:1,class:"small grey"},ot={class:"ui column"},nt=a("h5",null,"95th带宽",-1),rt={class:"value"},lt={class:"ui column"},dt=a("h5",null,"总流量",-1),ct={class:"value"},ut={class:"ui column"},mt=a("h5",null,"总请求数",-1),ht={class:"value"},_t={key:2},ft={class:"flex justify-between"},pt=a("i",{class:"icon chart area small"},null,-1),yt=a("i",{class:"icon table small"},null,-1),bt=a("span",{class:"item disabled"},"|",-1),vt=a("i",{class:"icon download small"},null,-1),gt={key:0,class:"table-box scroll-box"},Tt={key:0,class:"comment !mt-0 !mb-4"},wt={class:"chart-box",id:"bandwidth-chart"},re={__name:"index",setup(d){const t=R(new H);return(h,c)=>(n(),m(g,null,[a("form",null,[a("div",O,[a("div",P,[r(C,{name:"dayFrom",placeholder:"开始日期",modelValue:e(t).dayFrom,"onUpdate:modelValue":c[0]||(c[0]=s=>e(t).dayFrom=s),onChange:e(t).changeDayFrom},null,8,["modelValue","onChange"])]),a("div",Y,[r(C,{name:"dayTo",placeholder:"结束日期",modelValue:e(t).dayTo,"onUpdate:modelValue":c[1]||(c[1]=s=>e(t).dayTo=s),onChange:e(t).changeDayTo},null,8,["modelValue","onChange"])]),a("div",J,[e(t).servers.length==0?(n(),m("span",K,"暂无网站")):(n(),m("div",Q,[r(E,{"v-items":e(t).servers,name:"serverId",onChange:e(t).changeServer,placeholder:"全部网站服务（"+(e(t).servers.length-1)+"）"},null,8,["v-items","onChange","placeholder"])]))]),e(t).serverId==0&&e(t).regions.length>0?(n(),m("div",W,[r(N,{name:"regionId",modelValue:e(t).regionId,"onUpdate:modelValue":c[2]||(c[2]=s=>e(t).regionId=s),onChange:e(t).changeRegion},{default:l(()=>[r(F,{value:"0"},{default:l(()=>[u("所有区域")]),_:1}),(n(!0),m(g,null,x(e(t).regions,s=>(n(),p(F,{value:s.id},{default:l(()=>[u(o(s.name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue","onChange"])])):_("",!0),a("div",X,[r(q,{type:"button",onClick:b(e(t).search,["prevent"])},{default:l(()=>[u("查询")]),_:1},8,["onClick"])])])]),e(t).isLoading?(n(),p(A,{key:0,class:"mt-4"},{default:l(()=>[u("加载中...")]),_:1})):_("",!0),e(t).result!=null?(n(),p(U,{key:1},{default:l(()=>[a("div",Z,[tt,a("div",et,[a("span",null,o(e(t).result.maxBandwidthBitsFormat[0]),1),u(" "+o(e(t).result.maxBandwidthBitsFormat[1])+" ",1),st,e(t).result.maxBandwidthTime.length>0?(n(),m("span",at,o(e(t).result.maxBandwidthTime)+":00",1)):(n(),m("span",it," "))])]),a("div",ot,[nt,a("div",rt,[a("span",null,o(e(t).result.bandwidth95thBitsFormat[0]),1),u(" "+o(e(t).result.bandwidth95thBitsFormat[1]),1)])]),a("div",lt,[dt,a("div",ct,[a("span",null,o(e(t).result.totalTrafficBytesFormat[0]),1),u(" "+o(e(t).result.totalTrafficBytesFormat[1]),1)])]),a("div",ut,[mt,a("div",ht,[a("span",null,o(e(t).result.totalTrafficRequests),1),u("次")])])]),_:1})):_("",!0),e(t).result!=null?(n(),m("div",_t,[a("div",ft,[r(k,{"hide-divider":!0},{default:l(()=>[r(v,{class:T({active:e(t).tab=="chart"}),onClick:c[3]||(c[3]=b(s=>e(t).selectTab("chart"),["prevent"]))},{default:l(()=>[u("图表  "),pt]),_:1},8,["class"]),r(v,{class:T({active:e(t).tab=="table"}),onClick:c[4]||(c[4]=b(s=>e(t).selectTab("table"),["prevent"]))},{default:l(()=>[u("表格  "),yt]),_:1},8,["class"]),bt,r(v,{href:".download?dayFrom="+e(t).dayFrom+"&dayTo="+e(t).dayTo+"&serverId="+e(t).serverId,target:"_blank"},{default:l(()=>[u("下载  "),vt]),_:1},8,["href"])]),_:1}),r(k,{"hide-divider":!0},{default:l(()=>[(n(!0),m(g,null,x(e(t).dayRanges,(s,i)=>(n(),p(v,{class:T({active:e(t).dayFrom==s.dayFrom&&e(t).dayTo==s.dayTo,right:i==0}),onClick:b(y=>e(t).selectDay(s.dayFrom,s.dayTo),["prevent"])},{default:l(()=>[u(o(s.name),1)]),_:2},1032,["class","onClick"]))),256))]),_:1})]),r($),e(t).result!=null&&e(t).tab=="table"?(n(),m("div",gt,[e(t).result.bandwidthStats.length>500?(n(),m("p",Tt,"为了防止浏览器占用太多内存，这里只显示500行数据。")):_("",!0),r(j,{items:e(t).result.bandwidthStats.slice(0,500)},{default:l(()=>[r(w,{header:"时间"},{body:l(({data:s})=>[u(o(s.day.substring(0,4))+"-"+o(s.day.substring(4,6))+"-"+o(s.day.substring(6))+" "+o(s.time.substring(0,2))+":"+o(s.time.substring(2)),1)]),_:1}),r(w,{header:"带宽（Mbps）"},{body:l(({data:s})=>[u(o(s.mbps),1)]),_:1}),r(w,{header:"带宽（Gbps）"},{body:l(({data:s})=>[u(o(s.gbps),1)]),_:1})]),_:1},8,["items"])])):_("",!0),S(a("div",wt,null,512),[[V,e(t).result!=null&&e(t).tab=="chart"]])])):_("",!0)],64))}};export{re as default};
