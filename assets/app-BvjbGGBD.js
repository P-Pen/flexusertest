import{r as L,o as s,g as i,u as e,f as l,h as m,d as h,e as y,a as n,F as S,D as N,c as f,w as u,t as V,i as g,b as o,L as O}from"./app-BYx064nO.js";import{i as M,u as B,c as D}from"./app-DISTCiac.js";import{_ as H}from"./app-BAIc7wsg.js";import{W as k}from"./app-DQhYsbJs.js";import{_ as W}from"./app-_N2IGwgj.js";import{T as x}from"./app-DR284fT9.js";import{T as A}from"./app-DNadG4GC.js";import{_ as J}from"./app-1SA4suwN.js";import{_ as T}from"./app-Bg2kbTeB.js";import{_ as U}from"./app-x_fVWXrx.js";import{_ as z}from"./app-DfipPP5d.js";import{_ as j}from"./app-57xpzLDR.js";import{_ as E}from"./app-BKsB9XX9.js";import{_ as q}from"./app-C7gR9zYq.js";import{D as G}from"./app-D0jdtzyy.js";import"./app-BXvxi6wb.js";import"./app-C9w-bzHc.js";import"./app-DyIe33QU.js";import"./app-5V9SnxW6.js";import"./app-DOaxShSm.js";import"./app-BXiLqtxA.js";import"./app-CqvvE0jO.js";import"./app-CK9Tk_hc.js";import"./app-CAeEyuA3.js";import"./app-DoRtcMJm.js";import"./app-DPMEyUYH.js";import"./app-BuHt2kYS.js";import"./app-51hQc1Cd.js";import"./app-CqAVEB_b.js";import"./app-Cqxz9tud.js";import"./app-aIb4ksxL.js";import"./app-DYkSpHuE.js";import"./app-C5GVF480.js";import"./app-TBcc1obG.js";import"./app-CxqGeHsb.js";import"./app-Dj8c2KwC.js";import"./app-cRxw2ZDj.js";import"./app-Ncl-Sitd.js";import"./app-DoTJvLi7.js";function K(){const{utils:p,Tea:t}=M(this);this.success=function(){p.success("保存成功",function(){p.reload()})},this.changeAllowedProvinces=function(_){this.allowedProvinces=_.provinces}}const Q={key:0,class:"disabled"},X={key:0},Y={key:1},Z={class:"label-group"},ee=["name","value"],te=["onClick"],ne=n("i",{class:"icon remove"},null,-1),oe=[ne],b={__name:"HTTPFirewallProvinceSelector",props:["v-type","v-provinces"],emits:["change"],setup(p,{emit:t}){const _=B(),r=p,d=t,{listType:P,provinces:a}=function(){let c=r.vProvinces;return c==null&&(c=[]),{listType:L(r.vType),provinces:L(c)}}(),R=function(){let c=a.value.map(function(v){return v.id});_.popup("/servers/server/settings/waf/ipadmin/selectProvincesPopup?type="+P.value+"&selectedProvinceIds="+c.join(","),{width:"50em",height:"35em",callback:function(v){a.value=v.data.selectedProvinces,w()}})},I=function(c){a.value.$remove(c),w()},C=function(){a.value=[],w()},w=function(){d("change",{provinces:a.value})};return(c,v)=>(s(),i("div",null,[e(a).length==0?(s(),i("span",Q,[l("暂时没有选择"),e(P)=="allow"?(s(),i("span",X,"允许")):(s(),i("span",Y,"封禁")),l("的省份。")])):m("",!0),h(n("div",Z,[(s(!0),i(S,null,N(e(a),($,F)=>(s(),f(A,{outlined:""},{default:u(()=>[n("input",{type:"hidden",name:e(P)+"ProvinceIds",value:$.id},null,8,ee),l(" "+V($.name)+" ",1),n("a",{href:"",onClick:g(ye=>I(F),["prevent"]),title:"删除"},oe,8,te)]),_:2},1024))),256))],512),[[y,e(a).length>0]]),o(O),o(x,{type:"button",secondary:"",size:"small",onClick:g(R,["prevent"])},{default:u(()=>[l("修改")]),_:1}),l("   "),h(o(x,{type:"button",secondary:"",size:"small",onClick:g(C,["prevent"])},{default:u(()=>[l("清空")]),_:1},512),[[y,e(a).length>0]])]))}},se={key:0},le={key:1},ie=["href"],re={key:0},ae={key:1},ce=["value"],ue=["value"],de=["value"],me=n("td",{class:"title"},"仅允许的省份",-1),pe=n("td",{class:"title"},"仅封禁的省份",-1),_e={key:0,class:"comment"},ve={colspan:"2"},fe=n("td",null,"提示内容",-1),he=n("p",{class:"comment"},"当客户端所在省份被封禁时提示页面的HTML内容；不填则表示使用默认的提示内容；支持请求变量。",-1),st={__name:"provinces",setup(p){const t=D(new K);return(_,r)=>(s(),f(H,{ctx:e(t)},{default:u(()=>[o(E,{ctx:e(t),"active-tab":"province"},null,8,["ctx"]),e(t).featureIsOn?m("",!0):(s(),i("div",se,[o(q)])),e(t).featureIsOn?(s(),i("div",le,[e(t).wafIsOn?m("",!0):(s(),f(k,{key:0,"disable-spacing":""},{default:u(()=>[l("当前WAF未启用，设置将在"),n("a",{href:"/servers/server/settings/waf?serverId="+e(t).serverId},"[启用Web防火墙]",8,ie),l("后生效。 ")]),_:1})),e(t).clusterFirewallPolicy!=null&&e(t).clusterFirewallPolicy.mode!="defend"?(s(),f(k,{key:1},{default:u(()=>[l("当前网站所在集群的WAF策略模式为 "),e(t).clusterFirewallPolicy.modeInfo!=null?(s(),i("span",re,[n("strong",null,V(e(t).clusterFirewallPolicy.modeInfo.name),1)])):(s(),i("span",ae,"非防御模式")),l("，当前设置将不会生效。 ")]),_:1})):m("",!0),o(W,{action:"$",onSuccess:e(t).success},{default:u(()=>[n("input",{type:"hidden",name:"firewallPolicyId",value:e(t).firewallPolicyId},null,8,ce),n("input",{type:"hidden",name:"exceptURLPatternsJSON",value:JSON.stringify(e(t).exceptURLPatterns)},null,8,ue),n("input",{type:"hidden",name:"onlyURLPatternsJSON",value:JSON.stringify(e(t).onlyURLPatterns)},null,8,de),o(G,null,{default:u(()=>[n("tbody",null,[n("tr",null,[me,n("td",null,[o(b,{"v-provinces":e(t).allowedProvinces,"v-type":"allow",onChange:e(t).changeAllowedProvinces},null,8,["v-provinces","onChange"])])]),n("tr",null,[pe,n("td",null,[e(t).allowedProvinces.length>0?(s(),i("p",_e,'由于你已设置"仅允许的省份"，所以不需要再设置封禁省份。')):m("",!0),h(o(b,{"v-provinces":e(t).deniedProvinces,"v-type":"deny"},null,8,["v-provinces"]),[[y,e(t).allowedProvinces.length==0]])])]),n("tr",null,[n("td",ve,[o(J)])])]),h(n("tbody",null,[n("tr",null,[n("td",null,[l("例外URL  "),o(U,{content:"对这些URL将不做任何限制。"})]),n("td",null,[o(T,{modelValue:e(t).exceptURLPatterns,"onUpdate:modelValue":r[0]||(r[0]=d=>e(t).exceptURLPatterns=d)},null,8,["modelValue"])])]),n("tr",null,[n("td",null,[l("限制URL  "),o(U,{content:"只对这些URL做限制。"})]),n("td",null,[o(T,{modelValue:e(t).onlyURLPatterns,"onUpdate:modelValue":r[1]||(r[1]=d=>e(t).onlyURLPatterns=d)},null,8,["modelValue"])])]),n("tr",null,[fe,n("td",null,[o(z,{modelValue:e(t).provinceHTML,"onUpdate:modelValue":r[2]||(r[2]=d=>e(t).provinceHTML=d),name:"provinceHTML",rows:"3",class:"w-full"},null,8,["modelValue"]),he])])],512),[[y,e(t).moreOptionsVisible]])]),_:1}),o(j)]),_:1},8,["onSuccess"])])):m("",!0)]),_:1},8,["ctx"]))}};export{st as default};
