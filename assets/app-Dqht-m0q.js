import{o as i,c as h,w as a,j as w,r as F,g as s,a as n,b as c,u as t,F as C,L as R,h as o,t as p,d as k,e as v,i as _,f as l}from"./app-BYx064nO.js";import{i as V,c as S}from"./app-DISTCiac.js";import{_ as B}from"./app-_N2IGwgj.js";import{_ as b}from"./app-C5GVF480.js";import{T as m}from"./app-DR284fT9.js";import{_ as U}from"./app-57xpzLDR.js";import{T as y}from"./app-BXiLqtxA.js";import{D as L}from"./app-D0jdtzyy.js";import{_ as $}from"./app-5V9SnxW6.js";import{C as I}from"./app-D2_aZ1I5.js";import{C as P}from"./app-DzOFJRH2.js";import"./app-DYkSpHuE.js";import"./app-CqvvE0jO.js";import"./app-CK9Tk_hc.js";import"./app-CAeEyuA3.js";import"./app-DoRtcMJm.js";import"./app-DPMEyUYH.js";import"./app-DOaxShSm.js";function Q(){const{utils:u}=V(this);this.backPreviewURL="",this.frontPreviewURL="",this.isSubmitting=!1,this.realName="",this.number="",this.identity!=null&&(this.realName=this.identity.realName,this.number=this.identity.number),this.canEdit=this.identity==null||this.identity.status=="none"||this.identity.status=="rejected",this.selectFile=function(r){document.getElementById(r).click()},this.changeBackFile=function(r){let e=r.target.files;e.length>0&&(this.backPreviewURL=URL.createObjectURL(e[0]))},this.changeFrontFile=function(r){let e=r.target.files;e.length>0&&(this.frontPreviewURL=URL.createObjectURL(e[0]))},this.beforeSubmit=function(){this.isSubmitting=!0},this.doneSubmit=function(){this.isSubmitting=!1},this.success=function(){u.success("保存成功",function(){u.reload()})},this.submit=function(){if(this.identity==null){u.fail("请先保存后再提交审核");return}this.$post(".submit").params({identityId:this.identity.id}).success(function(){u.success("提交成功",function(){u.reload()})})},this.cancel=function(){if(this.identity==null){u.fail("请先保存后再提交审核");return}u.confirm("确定要取消提交审核吗？",function(){this.$post(".cancel").params({identityId:this.identity.id}).success(function(){u.success("取消成功",function(){u.reload()})})})},this.faceQrcode="",this.generatingQrcode=!1,this.generateFaceQrcode=function(){this.faceQrcode="",this.generatingQrcode=!0,this.$post(".face.prepare").params({identityId:this.identity.id,returnURL:window.location.toString()}).success(function(r){this.faceQrcode=r.data.qrcode,setTimeout(()=>{this.$refs.facePrimaryButtonRef.$el.scrollIntoView({behavior:"smooth"})},100)}).done(function(){this.generatingQrcode=!1})},this.cancelFace=function(){this.faceQrcode=""},this.verifyFace=function(){this.$post(".face.validate").params({identityId:this.identity.id}).success(function(r){r.data.isOk?u.success("恭喜你，已完成实名认证",function(){window.location.reload()}):u.success("你尚未完成实名认证")})}}const g={__name:"PrimaryButton",setup(u){return(r,e)=>(i(),h(m,null,{default:a(()=>[w(r.$slots,"default")]),_:3}))}},x=["value"],M=n("td",{class:"title"},"真实姓名 *",-1),N={key:0},j={key:1},E=n("td",null,"身份证号 *",-1),T={key:0},D={key:1},O=n("td",null,[l("身份证 - 照片面 *"),n("em",null,"不超过8MiB")],-1),A={class:"idcard-bg"},q=["src"],z=["src"],G=n("i",{class:"icon plus"},null,-1),H=n("td",null,[l("身份证 - 国徽面 *"),n("em",null,"不超过8MiB")],-1),J={class:"idcard-bg"},K=["src"],W=["src"],X=n("i",{class:"icon plus"},null,-1),Y=n("td",null,"已绑定手机号",-1),Z={key:0},ee={key:1},te={key:0,class:"red"},ie=n("a",{href:"/settings/mobile-verify"},"去绑定 »",-1),ne={key:1,class:"comment"},se=n("a",{href:"/settings/mobile-verify"},"去绑定 »",-1),oe={key:1},le={key:0},ae={key:0},ce={key:0},re={key:0},de={class:"-mt-4"},ue=["src"],fe={class:"mt-4"},me={key:0},_e={class:"mt-4 flex gap-8"},he={key:1,class:"mt-4"},ye={key:1},pe={key:1},ge={key:0},ke={class:"mt-4"},ve={key:1},be={class:"mt-4"},we={key:2},Fe={class:"mt-4"},Ce={key:3},Re={key:2},ze={__name:"individual",setup(u){const r=F(),e=S(new Q,{refs:{facePrimaryButtonRef:r}});return(Ve,d)=>(i(),s(C,null,[n("div",null,[c($,{class:"!pt-0",items:[{label:"实名认证",url:"/settings/identity"},{label:"个人实名认证"}]}),c(R,{class:"!mt-0"})]),c(B,{action:".uploadIndividual",timeout:"600",onBefore:t(e).beforeSubmit,onDone:t(e).doneSubmit,onSuccess:t(e).success},{default:a(()=>[t(e).identity!=null?(i(),s("input",{key:0,type:"hidden",name:"identityId",value:t(e).identity.id},null,8,x)):o("",!0),c(L,null,{default:a(()=>[n("tbody",null,[n("tr",null,[M,n("td",null,[t(e).canEdit?(i(),s("div",N,[c(b,{name:"realName",placeholder:"真实姓名",maxlength:"100",style:{width:"10em"},autofocus:"",modelValue:t(e).realName,"onUpdate:modelValue":d[0]||(d[0]=f=>t(e).realName=f)},null,8,["modelValue"])])):(i(),s("div",j,p(t(e).identity.realName),1))])]),n("tr",null,[E,n("td",null,[t(e).canEdit?(i(),s("div",T,[c(b,{name:"number",placeholder:"身份证号",maxlength:"18",style:{width:"13em"},modelValue:t(e).number,"onUpdate:modelValue":d[1]||(d[1]=f=>t(e).number=f)},null,8,["modelValue"])])):(i(),s("div",D,p(t(e).identity.number),1))])]),k(n("tr",null,[O,n("td",null,[n("input",{type:"file",name:"backFile",id:"back-file",accept:"image/jpeg, image/png",onChange:d[2]||(d[2]=(...f)=>t(e).changeBackFile&&t(e).changeBackFile(...f))},null,32),n("div",A,[t(e).identity!=null&&t(e).identity.backFileId>0&&t(e).backPreviewURL.length==0?(i(),s("img",{key:0,src:"/files/file?fileId="+t(e).identity.backFileId,alt:""},null,8,q)):o("",!0),t(e).backPreviewURL.length>0?(i(),s("img",{key:1,src:t(e).backPreviewURL,alt:""},null,8,z)):o("",!0),t(e).canEdit?(i(),h(m,{key:2,type:"button",secondary:"",onClick:d[3]||(d[3]=_(f=>t(e).selectFile("back-file"),["prevent"]))},{default:a(()=>[G]),_:1})):o("",!0)])])],512),[[v,!t(e).isFaceVerification]]),k(n("tr",null,[H,n("td",null,[n("input",{type:"file",name:"frontFile",id:"front-file",accept:"image/jpeg, image/png",onChange:d[4]||(d[4]=(...f)=>t(e).changeFrontFile&&t(e).changeFrontFile(...f))},null,32),n("div",J,[t(e).identity!=null&&t(e).identity.frontFileId>0&&t(e).frontPreviewURL.length==0?(i(),s("img",{key:0,src:"/files/file?fileId="+t(e).identity.frontFileId,alt:""},null,8,K)):o("",!0),t(e).frontPreviewURL.length>0?(i(),s("img",{key:1,src:t(e).frontPreviewURL,alt:""},null,8,W)):o("",!0),t(e).canEdit?(i(),h(m,{key:2,type:"button",secondary:"",onClick:d[5]||(d[5]=_(f=>t(e).selectFile("front-file"),["prevent"]))},{default:a(()=>[X]),_:1})):o("",!0)])])],512),[[v,!t(e).isFaceVerification]]),n("tr",null,[Y,n("td",null,[t(e).verifiedMobile.length>0?(i(),s("span",Z,p(t(e).verifiedMobile),1)):(i(),s("span",ee,[t(e).canVerifyStrongly?(i(),s("span",te,[l("你需要绑定手机号之后才能提交审核，"),ie])):(i(),s("span",ne,[l("尚未绑定手机号，"),se]))]))])])])]),_:1}),t(e).isSubmitting?o("",!0):(i(),s("div",oe,[n("div",null,[t(e).identity==null?(i(),h(U,{key:0},{default:a(()=>[l("保存")]),_:1})):o("",!0)]),t(e).identity!=null?(i(),s("div",le,[t(e).isFaceVerification?(i(),s("div",ae,[t(e).identity.status=="none"||t(e).identity.status=="rejected"?(i(),s("div",ce,[c(y,{warning:""},{default:a(()=>[l("已保存，等待人脸验证。如果信息有更改，请保存修改后再进行人脸验证。")]),_:1}),t(e).faceQrcode.length>0?(i(),s("div",re,[c(I,{cols:"1",class:"mt-4"},{header:a(()=>[l("人脸验证")]),default:a(()=>[c(P,null,{default:a(()=>[n("div",de,[n("img",{alt:"",src:"data:image/jpeg;charset=utf-8;base64,"+t(e).faceQrcode,style:{width:"18em"},class:"bg-white"},null,8,ue),n("p",fe,[l("请"),t(e).verificationMethod=="alipay"?(i(),s("span",me,"使用支付宝App")):o("",!0),l("扫描上面的二维码完成人脸验证。 ")])])]),_:1})]),_:1}),n("div",_e,[c(m,{onClick:_(t(e).verifyFace,["prevent"]),ref_key:"facePrimaryButtonRef",ref:r},{default:a(()=>[l("我已完成人脸验证")]),_:1},8,["onClick"]),c(m,{outlined:"",onClick:_(t(e).cancelFace,["prevent"])},{default:a(()=>[l("取消此次人脸验证")]),_:1},8,["onClick"])])])):o("",!0),t(e).faceQrcode.length==0?(i(),s("div",he,[c(m,{type:"submit",outlined:""},{default:a(()=>[l("保存修改")]),_:1}),l("     "),t(e).verificationMethod=="alipay"&&!t(e).generatingQrcode?(i(),h(g,{key:0,onClick:_(t(e).generateFaceQrcode,["prevent"])},{default:a(()=>[l("使用支付宝App人脸验证")]),_:1},8,["onClick"])):o("",!0),t(e).verificationMethod=="alipay"&&t(e).generatingQrcode?(i(),h(m,{key:1,secondary:""},{default:a(()=>[l("二维码生成中，请稍候...")]),_:1})):o("",!0)])):o("",!0)])):o("",!0),t(e).identity.status=="verified"?(i(),s("div",ye,[c(y,{success:""},{default:a(()=>[l("实名认证审核通过。")]),_:1})])):o("",!0)])):o("",!0),t(e).isFaceVerification?o("",!0):(i(),s("div",pe,[t(e).identity.status=="none"?(i(),s("div",ge,[c(y,{warning:""},{default:a(()=>[l("已上传，请提交审核。")]),_:1}),n("div",ke,[c(m,{type:"submit",outlined:""},{default:a(()=>[l("保存修改")]),_:1}),l("     "),!t(e).canVerifyStrongly||t(e).verifiedMobile.length>0?(i(),h(g,{key:0,onClick:_(t(e).submit,["prevent"])},{default:a(()=>[l("提交审核")]),_:1},8,["onClick"])):o("",!0)])])):o("",!0),t(e).identity.status=="submitted"?(i(),s("div",ve,[c(y,{warning:""},{default:a(()=>[l("管理员审核中，请耐心等待。")]),_:1}),n("div",be,[n("a",{href:"",class:"link",onClick:d[6]||(d[6]=_((...f)=>t(e).cancel&&t(e).cancel(...f),["prevent"]))},"取消审核")])])):o("",!0),t(e).identity.status=="rejected"?(i(),s("div",we,[c(y,{error:""},{default:a(()=>[l("审核不通过，原因："+p(t(e).identity.rejectReason)+"。",1)]),_:1}),n("div",Fe,[c(m,{type:"submit",outlined:""},{default:a(()=>[l("保存修改")]),_:1}),l("     "),!t(e).canVerifyStrongly||t(e).verifiedMobile.length>0?(i(),h(g,{key:0,onClick:_(t(e).submit,["prevent"])},{default:a(()=>[l("重新提交审核")]),_:1},8,["onClick"])):o("",!0)])])):o("",!0),t(e).identity.status=="verified"?(i(),s("div",Ce,[c(y,{success:""},{default:a(()=>[l("实名认证审核通过。")]),_:1})])):o("",!0)]))])):o("",!0)])),t(e).isSubmitting?(i(),s("div",Re," 正在提交，请稍候... ")):o("",!0)]),_:1},8,["onBefore","onDone","onSuccess"])],64))}};export{ze as default};
