import{aa as F,r as k,o as s,g as r,u as e,f as l,h as m,d as h,e as y,a as t,F as N,D as O,c as f,w as d,t as $,i as C,b as o,L as M}from"./app-BYx064nO.js";import{i as B,c as D}from"./app-DISTCiac.js";import{_ as H}from"./app-BKsB9XX9.js";import{W as x}from"./app-DQhYsbJs.js";import{_ as W}from"./app-_N2IGwgj.js";import{T as P}from"./app-DR284fT9.js";import{T as A}from"./app-DNadG4GC.js";import{_ as E}from"./app-1SA4suwN.js";import{_ as V}from"./app-x_fVWXrx.js";import{_ as U}from"./app-Bg2kbTeB.js";import{_ as J}from"./app-DfipPP5d.js";import{_ as j}from"./app--BlRpVz_.js";import{_ as z}from"./app-57xpzLDR.js";import{_ as q}from"./app-BAIc7wsg.js";import{_ as G}from"./app-C7gR9zYq.js";import{D as K}from"./app-D0jdtzyy.js";import"./app-CxqGeHsb.js";import"./app-Dj8c2KwC.js";import"./app-cRxw2ZDj.js";import"./app-DOaxShSm.js";import"./app-5V9SnxW6.js";import"./app-Ncl-Sitd.js";import"./app-DoTJvLi7.js";import"./app-BXiLqtxA.js";import"./app-CqvvE0jO.js";import"./app-CK9Tk_hc.js";import"./app-CAeEyuA3.js";import"./app-DoRtcMJm.js";import"./app-DPMEyUYH.js";import"./app-BuHt2kYS.js";import"./app-51hQc1Cd.js";import"./app-CqAVEB_b.js";import"./app-Cqxz9tud.js";import"./app-aIb4ksxL.js";import"./app-DYkSpHuE.js";import"./app-DyIe33QU.js";import"./app-C5GVF480.js";import"./app-TBcc1obG.js";import"./app-tUtHmy3n.js";import"./app-BXvxi6wb.js";import"./app-C9w-bzHc.js";function Q(){const{utils:p}=B(this);this.success=function(){p.success("保存成功",function(){p.reload()})},this.changeAllowedCountries=function(n){this.allowedCountries=n.countries}}const X={key:0,class:"disabled"},Y={key:0},Z={key:1},ee={class:"label-group"},te=["name","value"],ne=["onClick"],oe=t("i",{class:"icon remove"},null,-1),se=[oe],b={__name:"HTTPFirewallRegionSelector",props:["v-type","v-countries"],emits:["change"],setup(p,{emit:n}){const L=F("$utils"),i=p,a=n,{listType:v,countries:u}=function(){let c=i.vCountries;return c==null&&(c=[]),{listType:k(i.vType),countries:k(c)}}(),T=function(){let c=u.value.map(function(_){return _.id});L.popup("/servers/server/settings/waf/ipadmin/selectCountriesPopup?type="+v.value+"&selectedCountryIds="+c.join(","),{width:"52em",height:"30em",callback:function(_){u.value=_.data.selectedCountries,w()}})},R=function(c){u.value.$remove(c),w()},I=function(){u.value=[],w()},w=function(){a("change",{countries:u.value})};return(c,_)=>(s(),r("div",null,[e(u).length==0?(s(),r("span",X,[l("暂时没有选择"),e(v)=="allow"?(s(),r("span",Y,"允许")):(s(),r("span",Z,"封禁")),l("的区域。")])):m("",!0),h(t("div",ee,[(s(!0),r(N,null,O(e(u),(g,S)=>(s(),f(A,{outlined:""},{default:d(()=>[t("input",{type:"hidden",name:e(v)+"CountryIds",value:g.id},null,8,te),l(" ("+$(g.letter)+")"+$(g.name)+" ",1),t("a",{href:"",onClick:C(Ce=>R(S),["prevent"]),title:"删除"},se,8,ne)]),_:2},1024))),256))],512),[[y,e(u).length>0]]),o(M),o(P,{type:"button",secondary:"",size:"small",onClick:C(T,["prevent"])},{default:d(()=>[l("修改")]),_:1}),l("   "),h(o(P,{type:"button",secondary:"",size:"small",onClick:C(I,["prevent"])},{default:d(()=>[l("清空")]),_:1},512),[[y,e(u).length>0]])]))}},le={key:0},ie={key:1},re=["href"],ae={key:0},ue={key:1},ce=["value"],de=["value"],me=["value"],pe=t("td",{class:"title"},"仅允许的区域",-1),_e=t("td",{class:"title"},"仅封禁的区域",-1),fe={key:0,class:"comment"},he={colspan:"2"},ye=t("td",null,"提示内容",-1),ve=t("p",{class:"comment"},"当客户端所在区域被封禁时提示页面的HTML内容；不填则表示使用默认的提示内容；支持请求变量。",-1),we=t("td",null,"允许搜索引擎",-1),ge=t("p",{class:"comment"},"选中后，表示如果请求来自常见搜索引擎的IP，则不受区域限制。",-1),ut={__name:"countries",setup(p){const n=D(new Q);return(L,i)=>(s(),f(q,{ctx:e(n)},{default:d(()=>[o(H,{ctx:e(n),"active-tab":"country"},null,8,["ctx"]),e(n).featureIsOn?m("",!0):(s(),r("div",le,[o(G)])),e(n).featureIsOn?(s(),r("div",ie,[e(n).wafIsOn?m("",!0):(s(),f(x,{key:0,"disable-spacing":""},{default:d(()=>[l("当前WAF未启用，设置将在"),t("a",{href:"/servers/server/settings/waf?serverId="+e(n).serverId},"[启用Web防火墙]",8,re),l("后生效。 ")]),_:1})),e(n).clusterFirewallPolicy!=null&&e(n).clusterFirewallPolicy.mode!="defend"?(s(),f(x,{key:1},{default:d(()=>[l("当前网站所在集群的WAF策略模式为 "),e(n).clusterFirewallPolicy.modeInfo!=null?(s(),r("span",ae,[t("strong",null,$(e(n).clusterFirewallPolicy.modeInfo.name),1)])):(s(),r("span",ue,"非防御模式")),l("，当前设置将不会生效。 ")]),_:1})):m("",!0),o(W,{action:"$",onSuccess:e(n).success},{default:d(()=>[t("input",{type:"hidden",name:"firewallPolicyId",value:e(n).firewallPolicyId},null,8,ce),t("input",{type:"hidden",name:"exceptURLPatternsJSON",value:JSON.stringify(e(n).exceptURLPatterns)},null,8,de),t("input",{type:"hidden",name:"onlyURLPatternsJSON",value:JSON.stringify(e(n).onlyURLPatterns)},null,8,me),o(K,null,{default:d(()=>[t("tbody",null,[t("tr",null,[pe,t("td",null,[o(b,{"v-countries":e(n).allowedCountries,"v-type":"allow",onChange:e(n).changeAllowedCountries},null,8,["v-countries","onChange"])])]),t("tr",null,[_e,t("td",null,[e(n).allowedCountries.length>0?(s(),r("p",fe,'由于你已设置"仅允许的区域"，所以不需要再设置封禁区域。')):m("",!0),h(o(b,{"v-countries":e(n).deniedCountries,"v-type":"deny"},null,8,["v-countries"]),[[y,e(n).allowedCountries.length==0]])])]),t("tr",null,[t("td",he,[o(E)])])]),h(t("tbody",null,[t("tr",null,[t("td",null,[l("例外URL  "),o(V,{content:"对这些URL将不做任何限制。"})]),t("td",null,[o(U,{modelValue:e(n).exceptURLPatterns,"onUpdate:modelValue":i[0]||(i[0]=a=>e(n).exceptURLPatterns=a)},null,8,["modelValue"])])]),t("tr",null,[t("td",null,[l("限制URL  "),o(V,{content:"只对这些URL做限制。"})]),t("td",null,[o(U,{modelValue:e(n).onlyURLPatterns,"onUpdate:modelValue":i[1]||(i[1]=a=>e(n).onlyURLPatterns=a)},null,8,["modelValue"])])]),t("tr",null,[ye,t("td",null,[o(J,{modelValue:e(n).countryHTML,"onUpdate:modelValue":i[2]||(i[2]=a=>e(n).countryHTML=a),name:"countryHTML",rows:"3",class:"w-full"},null,8,["modelValue"]),ve])]),t("tr",null,[we,t("td",null,[o(j,{name:"allowSearchEngine",modelValue:e(n).allowSearchEngine,"onUpdate:modelValue":i[3]||(i[3]=a=>e(n).allowSearchEngine=a)},null,8,["modelValue"]),ge])])],512),[[y,e(n).moreOptionsVisible]])]),_:1}),o(z)]),_:1},8,["onSuccess"])])):m("",!0)]),_:1},8,["ctx"]))}};export{ut as default};
