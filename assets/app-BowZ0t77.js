import{i as H,c as N}from"./app-DISTCiac.js";import{_ as k}from"./app-BAIc7wsg.js";import{_ as q}from"./app-57xpzLDR.js";import{_ as A}from"./app-_N2IGwgj.js";import{r as p,J as C,o as d,g as m,a as l,u as a,b as n,w as u,c as I,h as w,d as f,e as v,F as h,D as b,f as o,t as P}from"./app-BYx064nO.js";import{_ as V}from"./app-C5GVF480.js";import{C as c}from"./app-IrmNFWm4.js";import{_ as F}from"./app--BlRpVz_.js";import{_ as O,a as S}from"./app-BuHt2kYS.js";import{_ as T}from"./app-Bx5jiAm1.js";import{D as X}from"./app-D0jdtzyy.js";import"./app-BXvxi6wb.js";import"./app-C9w-bzHc.js";import"./app-DyIe33QU.js";import"./app-5V9SnxW6.js";import"./app-DOaxShSm.js";import"./app-DR284fT9.js";import"./app-DYkSpHuE.js";import"./app-DNadG4GC.js";import"./app-DPMEyUYH.js";import"./app-tUtHmy3n.js";import"./app-CK9Tk_hc.js";import"./app-51hQc1Cd.js";import"./app-CqAVEB_b.js";import"./app-Cqxz9tud.js";import"./app-DoRtcMJm.js";import"./app-aIb4ksxL.js";function B(){H(this),this.success=this.$NotifyReloadSuccess("保存成功")}const D=["value"],L=l("td",{class:"title"},"启用访客IP设置",-1),U=l("p",{class:"comment"},"选中后，表示使用自定义的请求变量获取客户端IP。",-1),G=l("td",null,"获取IP方式 *",-1),J={key:0,class:"comment"},E=l("td",null,"请求报头 *",-1),j={class:"comment"},z=l("td",null,"读取IP变量值 *",-1),K={class:"comment"},M={__name:"HTTPRemoteAddrConfigBox",props:["v-remote-addr-config","v-is-location","v-is-group"],setup($){const s=$,_=p(),y=p(),{config:e,options:g}=function(){let t=s.vRemoteAddrConfig;if(t==null&&(t={isPrior:!1,isOn:!1,value:"${rawRemoteAddr}",type:"default",requestHeaderName:""}),t.type==null||t.type.length==0)switch(t.type="default",t.value){case"${rawRemoteAddr}":t.type="default";break;case"${remoteAddrValue}":t.type="default";break;case"${remoteAddr}":t.type="proxy";break;default:t.value!=null&&t.value.length>0&&(t.type="variable")}return(t.value==null||t.value.length==0)&&(t.value="${rawRemoteAddr}"),{config:p(t),options:p([{name:"直接获取",description:'用户直接访问边缘节点，即 "用户 --> 边缘节点" 模式，这时候系统会试图从直接的连接中读取到客户端IP地址。',value:"${rawRemoteAddr}",type:"default"},{name:"从上级代理中获取",description:'用户和边缘节点之间有别的代理服务转发，即 "用户 --> [第三方代理服务] --> 边缘节点"，这时候只能从上级代理中获取传递的IP地址；上级代理传递的请求报头中必须包含 X-Forwarded-For 或 X-Real-IP 信息。',value:"${remoteAddr}",type:"proxy"},{name:"从请求报头中读取",description:"从自定义请求报头读取客户端IP。",value:"",type:"requestHeader"},{name:"[自定义变量]",description:"通过自定义变量来获取客户端真实的IP地址。",value:"",type:"variable"}])}}(),x=function(){return(!s.vIsLocation&&!s.vIsGroup||e.value.isPrior)&&e.value.isOn},R=function(){switch(e.value.type){case"default":e.value.value="${rawRemoteAddr}";break;case"proxy":e.value.value="${remoteAddr}";break;case"requestHeader":e.value.value="",e.value.requestHeaderName!=null&&e.value.requestHeaderName.length>0&&(e.value.value="${header."+e.value.requestHeaderName+"}"),setTimeout(function(){_.value.focus()});break;case"variable":e.value.value="${rawRemoteAddr}",setTimeout(function(){y.value.focus()});break}};return C(()=>e.value.requestHeaderName,function(t){e.value.type=="requestHeader"&&(e.value.value="${header."+t.trim()+"}")}),(t,i)=>(d(),m("div",null,[l("input",{type:"hidden",name:"remoteAddrJSON",value:JSON.stringify(a(e))},null,8,D),n(X,null,{default:u(()=>[t.vIsLocation||t.vIsGroup?(d(),I(T,{key:0,"v-config":a(e)},null,8,["v-config"])):w("",!0),f(l("tbody",null,[l("tr",null,[L,l("td",null,[n(F,{value:"1",modelValue:a(e).isOn,"onUpdate:modelValue":i[0]||(i[0]=r=>a(e).isOn=r)},null,8,["modelValue"]),U])])],512),[[v,!t.vIsLocation&&!t.vIsGroup||a(e).isPrior]]),f(l("tbody",null,[l("tr",null,[G,l("td",null,[n(O,{modelValue:a(e).type,"onUpdate:modelValue":i[1]||(i[1]=r=>a(e).type=r),onChange:R},{default:u(()=>[(d(!0),m(h,null,b(a(g),r=>(d(),I(S,{value:r.type},{default:u(()=>[o(P(r.name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"]),(d(!0),m(h,null,b(a(g),r=>(d(),m(h,null,[r.type==a(e).type&&r.description.length>0?(d(),m("p",J,P(r.description),1)):w("",!0)],64))),256))])]),f(l("tr",null,[E,l("td",null,[n(V,{type:"text",name:"requestHeaderName",modelValue:a(e).requestHeaderName,"onUpdate:modelValue":i[2]||(i[2]=r=>a(e).requestHeaderName=r),maxlength:"100",ref_key:"requestHeaderInputRef",ref:_,class:"w-full"},null,8,["modelValue"]),l("p",j,[o("请输入包含有客户端IP的请求报头，需要注意大小写，常见的有 "),n(c,null,{default:u(()=>[o("X-Forwarded-For")]),_:1}),o(" 、 "),n(c,null,{default:u(()=>[o("X-Real-IP")]),_:1}),o(" 、 "),n(c,null,{default:u(()=>[o("X-Client-IP")]),_:1}),o(" 等。 ")])])],512),[[v,a(e).type=="requestHeader"]]),f(l("tr",null,[z,l("td",null,[n(V,{type:"text",name:"value",modelValue:a(e).value,"onUpdate:modelValue":i[3]||(i[3]=r=>a(e).value=r),maxlength:"100",ref_key:"variableInputRef",ref:y,class:"w-full"},null,8,["modelValue"]),l("p",K,[o("通过此变量获取用户的IP地址。具体可用的请求变量列表可参考官方网站文档；比如通过报头传递IP的情形，可以使用 "),n(c,null,{default:u(()=>[o("${header.你的自定义报头}")]),_:1}),o(" （类似于 "),n(c,null,{default:u(()=>[o("${header.X-Forwarded-For}")]),_:1}),o(" ，需要注意大小写规范）。 ")])])],512),[[v,a(e).type=="variable"]])],512),[[v,x()]])]),_:1})]))}},Q=["value"],Pe={__name:"index",setup($){const s=N(new B);return(_,y)=>(d(),I(k,{ctx:a(s)},{default:u(()=>[n(A,{action:"$",onSuccess:a(s).success},{default:u(()=>[l("input",{type:"hidden",name:"webId",value:a(s).webId},null,8,Q),n(M,{"v-remote-addr-config":a(s).remoteAddrConfig},null,8,["v-remote-addr-config"]),n(q,{class:"mt-4"})]),_:1},8,["onSuccess"])]),_:1},8,["ctx"]))}};export{Pe as default};
