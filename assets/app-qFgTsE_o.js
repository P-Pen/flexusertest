import{o as d,g as r,b as n,a as t,w as a,u as s,d as _,e as f,i as p,c as y,h as c,f as o,F as C,D as I,t as k}from"./app-BYx064nO.js";import{i as b,c as D}from"./app-DISTCiac.js";import{_ as U}from"./app-DyrRHWwB.js";import{T as P,_ as N,a as g}from"./app-D_QewxY9.js";import{_ as R}from"./app-e1i_B4SR.js";import{T as m}from"./app-DR284fT9.js";import{_ as V,a as T}from"./app-BuHt2kYS.js";import{C as x}from"./app-IrmNFWm4.js";import{_ as S}from"./app-C5GVF480.js";import{_ as $}from"./app-CbPWpFKs.js";import{_ as q}from"./app--BlRpVz_.js";import{D as w}from"./app-D0jdtzyy.js";import"./app-CxqGeHsb.js";import"./app-Dj8c2KwC.js";import"./app-cRxw2ZDj.js";import"./app-DOaxShSm.js";import"./app-5V9SnxW6.js";import"./app-Ncl-Sitd.js";import"./app-DoTJvLi7.js";import"./app-DGM5HqRo.js";import"./app-51hQc1Cd.js";import"./app-CqAVEB_b.js";import"./app-CK9Tk_hc.js";import"./app-Cqxz9tud.js";import"./app-DoRtcMJm.js";import"./app-aIb4ksxL.js";import"./app-DYkSpHuE.js";import"./app-DyIe33QU.js";import"./app-DNadG4GC.js";import"./app-DPMEyUYH.js";import"./app-DfipPP5d.js";import"./app-TBcc1obG.js";import"./app-tUtHmy3n.js";function B(){const{utils:v,Tea:e}=b(this);this.step="prepare",this.authType="http",this.doPrepare=function(){this.step="user"},this.userId=0,this.goPrepare=function(){this.step="prepare"},this.createUser=function(){let u=this;v.popup("/servers/certs/acme/users/createPopup",{callback:function(l){v.successToast("创建成功");let i=l.data.acmeUser,h=i.description;h.length>0&&(h="（"+h+"）"),u.userId=i.id,u.users.unshift({id:i.id,description:h,email:i.email})}})},this.doUser=function(){if(this.userId==0){v.warn("请选择一个申请证书的用户");return}this.step="dns"},this.dnsProviderId=0,this.dnsDomain="",this.autoRenew=!0,this.domains=[],this.taskId=0,this.isRequesting=!1,this.goUser=function(){this.step="user"},this.changeDomains=function(u){this.domains=u},this.doDNS=function(){this.isRequesting=!0;let u=this,l=!1;this.$post("$").params({authType:this.authType,acmeUserId:this.userId,dnsProviderId:this.dnsProviderId,dnsDomain:this.dnsDomain,domains:this.domains,autoRenew:this.autoRenew?1:0,taskId:this.taskId}).success(function(i){this.taskId=i.data.taskId,l=!0,this.isRequesting=!0,this.$post(".run").timeout(300).params({taskId:this.taskId}).success(function(h){u.certId=h.data.certId,u.step="finish"}).done(function(){u.isRequesting=!1})}).done(function(){l||(this.isRequesting=!1)})},this.certId=0,this.goDNS=function(){this.step="dns"},this.doFinish=function(){window.location="/servers/certs/acme"},this.viewCert=function(){v.popup("/servers/certs/certPopup?certId="+this.certId,{height:"28em",width:"48em"})}}const F={class:"mt-2"},H=t("td",{class:"title"},"认证方式 *",-1),E={key:0},L={class:"comment"},M={key:1},A=t("p",{class:"comment"},[o(' 我们在申请免费证书的过程中需要自动增加或修改相关域名的TXT记录，请先确保你已经在"域名解析" -- '),t("a",{href:"/dns/providers",target:"_blank"},'"DNS服务商"'),o(" 中已经添加了对应的DNS服务商账号。 ")],-1),X=[A],j={class:"button-group"},z=t("td",{class:"title"},"选择用户",-1),G={key:0},J={class:"ui fields inline"},K={class:"ui field"},O={class:"ui field"},Q={key:1},W=t("p",{class:"comment"},"选择一个作为申请证书的用户。",-1),Y={class:"button-group"},Z=t("td",{class:"title"},"选择DNS服务商 *",-1),tt={key:0},et=t("p",{class:"comment"},"用于自动创建域名解析记录。",-1),st=t("td",null,"顶级域名 *",-1),it=t("p",{class:"comment"},"用于在DNS服务商账号中操作解析记录的域名，比如 example.com，不要输入二级或别的多级域名。",-1),ot=t("td",{class:"title"},"证书域名列表 *",-1),nt={class:"comment"},at={key:0},lt={key:1},dt=t("td",null,"自动续期",-1),rt=t("p",{class:"comment"},"选中后，表示在免费证书临近到期之前尝试自动续期。",-1),ut={class:"button-group"},pt={class:"success-box"},ct=t("span",{class:"green"},"恭喜，证书申请成功！",-1),mt={class:"button-group"},Jt={__name:"create",setup(v){const e=D(new B);return(u,l)=>(d(),r(C,null,[n(U,{"active-tab":"create"}),t("form",null,[n(P,{modelValue:s(e).step,"onUpdate:modelValue":l[0]||(l[0]=i=>s(e).step=i)},{default:a(()=>[n(N,null,{default:a(()=>[n(g,{code:"prepare"},{default:a(()=>[o("选择申请方式")]),_:1}),n(g,{code:"user"},{default:a(()=>[o("选择ACME用户")]),_:1}),n(g,{code:"dns"},{default:a(()=>[o("填写域名信息")]),_:1}),n(g,{code:"finish"},{default:a(()=>[o("完成")]),_:1})]),_:1})]),_:1},8,["modelValue"]),t("div",F,[_(t("div",null,[n(w,null,{default:a(()=>[t("tbody",null,[t("tr",null,[H,t("td",null,[t("div",null,[n(R,{name:"authType",value:"http",modelValue:s(e).authType,"onUpdate:modelValue":l[1]||(l[1]=i=>s(e).authType=i)},{default:a(()=>[o("使用HTTP认证")]),_:1},8,["modelValue"]),o("   ")]),s(e).authType=="http"?(d(),r("div",E,[t("p",L,[o("使用HTTP认证的方式请求网址 "),n(x,null,{default:a(()=>[o("/.well-known/acme-challenge/令牌")]),_:1}),o(" 校验，该方式要求需要实现将域名解析到CDN上，之后系统会自动生成网址信息；这种方式不支持泛域名证书的申请。 ")])])):c("",!0),s(e).authType=="dns"?(d(),r("div",M,X)):c("",!0)])])])]),_:1}),t("div",j,[n(m,{type:"button",class:"primary",onClick:p(s(e).doPrepare,["prevent"])},{default:a(()=>[o("下一步")]),_:1},8,["onClick"])])],512),[[f,s(e).step=="prepare"]]),_(t("div",null,[n(w,null,{default:a(()=>[t("tbody",null,[t("tr",null,[z,t("td",null,[s(e).users.length>0?(d(),r("div",G,[t("div",J,[t("div",K,[n(V,{modelValue:s(e).userId,"onUpdate:modelValue":l[2]||(l[2]=i=>s(e).userId=i)},{default:a(()=>[n(T,{value:"0"},{default:a(()=>[o("[请选择]")]),_:1}),(d(!0),r(C,null,I(s(e).users,i=>(d(),y(T,{value:i.id},{default:a(()=>[o(k(i.email)+k(i.description),1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"])]),t("div",O,[t("a",{href:"",onClick:l[3]||(l[3]=p((...i)=>s(e).createUser&&s(e).createUser(...i),["prevent"]))},"[新创建]")])])])):(d(),r("div",Q,[t("a",{href:"",onClick:l[4]||(l[4]=p((...i)=>s(e).createUser&&s(e).createUser(...i),["prevent"]))},"暂时还没有用户，点此创建")])),W])])])]),_:1}),t("div",Y,[n(m,{type:"button",secondary:"",onClick:p(s(e).goPrepare,["prevent"])},{default:a(()=>[o("上一步")]),_:1},8,["onClick"]),n(m,{type:"button",class:"primary",onClick:p(s(e).doUser,["prevent"])},{default:a(()=>[o("下一步")]),_:1},8,["onClick"])])],512),[[f,s(e).step=="user"]]),_(t("div",null,[n(w,null,{default:a(()=>[t("tbody",null,[_(t("tr",null,[Z,t("td",null,[s(e).providers.length>0?(d(),r("div",tt,[n(V,{modelValue:s(e).dnsProviderId,"onUpdate:modelValue":l[5]||(l[5]=i=>s(e).dnsProviderId=i)},{default:a(()=>[n(T,{value:"0"},{default:a(()=>[o("[请选择]")]),_:1}),(d(!0),r(C,null,I(s(e).providers,i=>(d(),y(T,{value:i.id},{default:a(()=>[o(k(i.name)+"（"+k(i.typeName)+"）",1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"])])):c("",!0),et])],512),[[f,s(e).authType=="dns"]]),_(t("tr",null,[st,t("td",null,[n(S,{maxlength:"100",modelValue:s(e).dnsDomain,"onUpdate:modelValue":l[6]||(l[6]=i=>s(e).dnsDomain=i),class:"w-full"},null,8,["modelValue"]),it])],512),[[f,s(e).authType=="dns"]]),t("tr",null,[ot,t("td",null,[n($,{"v-support-wildcard":s(e).authType=="dns",onChange:s(e).changeDomains},null,8,["v-support-wildcard","onChange"]),t("p",nt,[o("需要申请的证书中包含的域名列表"),s(e).authType=="dns"?(d(),r("span",at,"，所有域名必须是同一个顶级域名")):c("",!0),s(e).authType=="http"?(d(),r("span",lt,"使用HTTP认证方式时，域名中不能含有通配符")):c("",!0),o("。 ")])])]),t("tr",null,[dt,t("td",null,[n(q,{modelValue:s(e).autoRenew,"onUpdate:modelValue":l[7]||(l[7]=i=>s(e).autoRenew=i)},null,8,["modelValue"]),rt])])])]),_:1}),t("div",ut,[n(m,{type:"button",onClick:p(s(e).goUser,["prevent"])},{default:a(()=>[o("上一步")]),_:1},8,["onClick"]),s(e).isRequesting?c("",!0):(d(),y(m,{key:0,type:"button",class:"primary",onClick:p(s(e).doDNS,["prevent"])},{default:a(()=>[o("下一步")]),_:1},8,["onClick"])),s(e).isRequesting?(d(),y(m,{key:1,type:"button",class:"primary",disabled:""},{default:a(()=>[o("提交中，要花费的时间较长，请耐心等待...")]),_:1})):c("",!0)])],512),[[f,s(e).step=="dns"]]),_(t("div",null,[t("div",pt,[t("p",null,[ct,o("你可以在证书列表里看到刚申请的证书，也可以 "),t("a",{href:"",onClick:l[8]||(l[8]=p((...i)=>s(e).viewCert&&s(e).viewCert(...i),["prevent"]))},"点击这里"),o(" 查看证书详情。")])]),t("div",mt,[n(m,{type:"button",class:"primary",onClick:p(s(e).doFinish,["prevent"])},{default:a(()=>[o("返回")]),_:1},8,["onClick"])])],512),[[f,s(e).step=="finish"]])])])],64))}};export{Jt as default};
