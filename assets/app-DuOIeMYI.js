import{r as T,o as n,g as o,a as _,j as C,u as s,i as h,b as r,c as k,w as i,h as m,F as b,f as d,t as g,D as w,n as v}from"./app-BYx064nO.js";import{i as $,c as R}from"./app-DISTCiac.js";import{_ as x}from"./app-DyrRHWwB.js";import{T as I}from"./app-BXiLqtxA.js";import{_ as y}from"./app-DU3b6xa5.js";import{T as N}from"./app-DNadG4GC.js";import{_ as z}from"./app-DfQH6JJo.js";import{_ as L}from"./app-266_x6q1.js";import{L as B,s as p}from"./app-Vf6It1y-.js";import{_ as E}from"./app-B-EzfWu7.js";import"./app-CxqGeHsb.js";import"./app-Dj8c2KwC.js";import"./app-cRxw2ZDj.js";import"./app-DOaxShSm.js";import"./app-5V9SnxW6.js";import"./app-Ncl-Sitd.js";import"./app-DoTJvLi7.js";import"./app-CqvvE0jO.js";import"./app-CK9Tk_hc.js";import"./app-CAeEyuA3.js";import"./app-DoRtcMJm.js";import"./app-DPMEyUYH.js";import"./app-BZMTWmMM.js";import"./app-51hQc1Cd.js";import"./app-CqAVEB_b.js";import"./app-Cqxz9tud.js";import"./app-aIb4ksxL.js";import"./app-DYkSpHuE.js";import"./app-DyIe33QU.js";import"./app-CiA1rHoH.js";import"./app-RbQF51V8.js";import"./app-tUtHmy3n.js";import"./app-DGM5HqRo.js";import"./app-DG0hMi2p.js";import"./app-CBq6-G9z.js";function P(){const{utils:a}=$(this);this.viewCert=function(t){a.popup("/servers/certs/certPopup?certId="+t,{width:"48em"})},this.updateTask=function(t){a.popup("/servers/certs/acme/updateTaskPopup?taskId="+t,{width:"45em",callback:function(){a.success("保存成功，如果证书域名发生了改变，请重新执行生成新证书",function(){a.reload()})}})},this.deleteTask=function(t){let f=this;a.confirm("确定要删除此任务吗？",function(){f.$post("/servers/certs/acme/deleteTask").params({taskId:t}).refresh()})},this.isRunning=!1,this.runningIndex=-1,this.runTask=function(t,f){let c=this;a.confirm("html:确定要立即执行此任务吗？<br/>将会重新发起证书申请。",function(){c.isRunning=!0,c.runningIndex=t,c.tasks[t].isRunning=!0,c.$post(".run").timeout(300).params({taskId:f.id}).success(function(e){a.success("任务执行成功",function(){a.reload()})}).done(function(){c.isRunning=!1,c.runningIndex=-1,c.tasks[t].isRunning=!1})})},this.showError=function(t){a.popupTip("任务执行失败："+t)}}const V=["href","title"],D={class:"red"},H={__name:"LinkRed",props:["href","title"],emits:["click.prevent"],setup(a,{emit:t}){const f=a,c=t,{vHref:e}=function(){let l=f.href;return l==null&&(l=""),{vHref:T(l)}}(),u=function(...l){c("click.prevent",...l),e.value.length>0&&(window.location=e.value)};return(l,ee)=>(n(),o("a",{href:s(e),title:a.title,style:{"border-bottom":"1px #db2828 dashed"},onClick:h(u,["prevent"])},[_("span",D,[C(l.$slots,"default")])],8,V))}},M={key:2},S={class:"label-group mt-1"},F={class:"label-group"},O={key:0},j={key:1,class:"disabled"},A={key:0},U={key:0,class:"green"},Y={key:1,class:"disabled"},q={key:0,class:"green"},G={key:1,class:"disabled"},J={key:0},K=["onClick"],Q={key:1,class:"disabled"},W=["onClick"],X=["onClick"],Z=["onClick"],De={__name:"index",setup(a){const t=R(new P);return(f,c)=>(n(),o(b,null,[r(x,{"active-tab":"task"}),s(t).tasks.length==0?(n(),k(E,{key:0,"disable-spacing":""},{default:i(()=>[d("暂时还没有证书申请任务。")]),_:1})):m("",!0),s(t).isRunning?(n(),k(I,{key:1,info:""},{default:i(()=>[d("有任务在执行中，可能需要的时间较长，请耐心等待...")]),_:1})):m("",!0),s(t).tasks.length>0?(n(),o("div",M,[r(B,{items:s(t).tasks,"row-class":e=>e.isRunning?"warning":""},{default:i(()=>[r(s(p),{header:"ACME用户",class:"email-column",frozen:""},{body:i(({data:e})=>[d(g(e.acmeUser.email)+" ",1),_("div",S,[e.authType=="dns"?(n(),k(y,{key:0,class:"olive"},{default:i(()=>[d("DNS")]),_:1})):m("",!0),e.authType=="http"?(n(),k(y,{key:1,class:"olive"},{default:i(()=>[d("HTTP")]),_:1})):m("",!0)])]),_:1}),r(s(p),{header:"证书域名",class:"domain-column",frozen:""},{body:i(({data:e})=>[_("div",F,[(n(!0),o(b,null,w(e.domains,u=>(n(),o("div",null,[r(N,{outlined:""},{default:i(()=>[d(g(u),1)]),_:2},1024)]))),256))])]),_:1}),r(s(p),{header:"到期时间",class:"datetime-column"},{body:i(({data:e})=>[e.cert!=null?(n(),o("div",O,g(e.cert.endTime),1)):(n(),o("span",j,"-"))]),_:1}),r(s(p),{header:"更新时间",class:"datetime-column"},{body:i(({data:e})=>[e.log!=null?(n(),o("div",A,[e.log.isOk?(n(),o("span",U,g(e.log.createdTime),1)):m("",!0),e.log.isOk?m("",!0):(n(),k(H,{key:1,title:"任务执行失败，点击查看详情",onClick:h(u=>s(t).showError(e.log.error),["prevent"])},{default:i(()=>[d(g(e.log.createdTime),1)]),_:2},1032,["onClick"]))])):(n(),o("span",Y,"尚未执行"))]),_:1}),r(s(p),{header:"自动续期",class:"bool-column"},{body:i(({data:e})=>[e.autoRenew?(n(),o("span",q,"Y")):(n(),o("span",G,"N"))]),_:1}),r(s(p),{header:"关联证书",class:"value-column"},{body:i(({data:e})=>[e.cert!=null?(n(),o("div",J,[_("a",{href:"",onClick:h(u=>s(t).viewCert(e.cert.id),["prevent"])},[r(z,{title:"查看关联证书"})],8,K)])):(n(),o("span",Q,"-"))]),_:1}),r(s(p),{header:"操作",class:"three op",frozen:"","align-frozen":"right"},{body:i(({data:e,index:u})=>[_("a",{href:"",onClick:h(l=>s(t).updateTask(e.id),["prevent"]),class:v({disabled:s(t).isRunning})},"修改",10,W),d("   "),_("a",{href:"",onClick:h(l=>s(t).runTask(u,e),["prevent"]),class:v({disabled:s(t).isRunning})},"执行",10,X),d("   "),_("a",{href:"",onClick:h(l=>s(t).deleteTask(e.id),["prevent"]),class:v({disabled:s(t).isRunning})},"删除",10,Z)]),_:1})]),_:1},8,["items","row-class"]),r(L,{data:s(t).page},null,8,["data"])])):m("",!0)],64))}};export{De as default};
