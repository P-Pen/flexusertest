import{aa as ye,r as v,J as be,ak as Ae,o as u,g as d,a as e,u as n,b as r,w as p,d as C,e as g,F as b,D as A,c as k,f as i,t as h,i as c,L as w,h as f,n as $,bb as F,a_ as G}from"./app-BYx064nO.js";import{_ as Y,a as Q}from"./app-BuHt2kYS.js";import{T as V}from"./app-DR284fT9.js";import{_ as T}from"./app--BlRpVz_.js";import{_ as W}from"./app-C5GVF480.js";import{_ as ke}from"./app-EcaQJ64L.js";import"./app-CHxME8Sw.js";import"./app-B5UbDc9M.js";import{T as H}from"./app-DNadG4GC.js";import{C as $e}from"./app-IrmNFWm4.js";import{S as Ve}from"./app-C0-Qcoum.js";import{P as Te}from"./app-TBcc1obG.js";import{T as Ie,a as Re}from"./app-DRGtcCVV.js";import{D as we}from"./app-D0jdtzyy.js";const Oe=e("h5",{class:"!mt-8 !mb-4"},"SSL/TLS相关配置",-1),De=["value"],Ee=e("td",{class:"title"},"启用HTTP/2",-1),He=e("td",{class:"title"},"启用HTTP/3",-1),Le=e("td",{class:"title"},"设置证书",-1),xe={key:0,class:"label-group"},Pe=["onClick"],Ue=e("i",{class:"pi pi-remove"},null,-1),Ne=[Ue],Me={key:1},Be={class:"red"},ze={key:0},Ke={key:1},Je={class:"flex flex-wrap items-center gap-2"},je=e("span",{class:"disabled"},"|",-1),qe={key:0,class:"disabled"},Fe=e("td",null,"TLS最低版本",-1),Ge=e("td",null,[i("加密算法套件"),e("em",null,"（CipherSuites）")],-1),Ye={class:"cipher-suites-box"},Qe=["value"],We=["innerHTML"],Xe=["onClick"],Ze=e("i",{class:"pi pi-remove"},null,-1),et=[Ze],tt=e("a",{href:"",title:"拖动改变顺序",class:"sort-handle"},[e("i",{class:"pi pi-bars"})],-1),lt={key:0},st={class:"cipher-all-suites-box"},nt={key:0},ot={key:0,class:"label-group mt-4"},it=["onClick"],at=["innerHTML"],ut={key:0,class:"comment"},rt={class:"comment"},dt={key:0},ct={key:1},pt=e("span",null,"max-age=",-1),vt={key:2},ft={key:3},mt={key:0},ht=e("td",{class:"color-border"},[i("HSTS有效时间"),e("em",null,"（max-age）")],-1),_t={class:"ui fields inline"},St={class:"ui field"},Ct={class:"ui field text-gray-400"},gt={class:"comment"},yt=e("td",{class:"color-border"},[i("HSTS包含子域名"),e("em",null,"（includeSubDomains）")],-1),bt=e("td",{class:"color-border"},[i("HSTS预加载"),e("em",null,"（preload）")],-1),At=e("td",{class:"color-border"},"HSTS生效的域名",-1),kt={colspan:"2"},$t={class:"names-box label-group"},Vt=["value"],Tt=["onClick"],It=e("i",{class:"pi pi-pencil"},null,-1),Rt=[It],wt=["onClick"],Ot=e("i",{class:"pi pi-remove"},null,-1),Dt=[Ot],Et={key:0,class:"ui fields inline mt-2"},Ht={class:"ui field"},Lt={class:"ui field"},xt=e("i",{class:"icon remove"},null,-1),Pt=[xt],Ut={class:"ui field mt-2"},Nt=e("p",{class:"comment"},"如果没有设置域名的话，则默认支持所有的域名。",-1),Mt=e("td",null,"OCSP Stapling",-1),Bt=e("p",{class:"comment"},"选中表示启用OCSP Stapling。",-1),zt=e("td",null,"客户端认证方式",-1),Kt=e("td",null,"客户端认证CA证书",-1),Jt={key:0,class:"label-group"},jt=e("i",{class:"pi pi-remove"},null,-1),qt=[jt],Ft=e("p",{class:"comment"},"用来校验客户端证书以增强安全性，通常不需要设置。",-1),Gt=e("div",{class:"ui margin"},null,-1),rl={__name:"SSLConfigBox",props:["v-ssl-policy","v-protocol","v-server-id","v-support-http3"],setup(X){const m=ye("$utils"),O=X,x=v(),z=v(),{policy:o,hsts:a,hstsOptionsVisible:S,hstsDomainAdding:L,hstsMaxAgeString:D,addingHstsDomain:_,hstsDomainEditingIndex:I,allVersions:Z,allCipherSuites:E,modernCipherSuites:ee,intermediateCipherSuites:te,allClientAuthTypes:le,cipherSuitesVisible:R,moreOptionsVisible:P}=function(){let t=O.vSslPolicy;t==null?t={id:0,isOn:!0,certRefs:[],certs:[],clientCARefs:[],clientCACerts:[],clientAuthType:0,minVersion:"TLS 1.1",hsts:null,cipherSuitesIsOn:!1,cipherSuites:[],http2Enabled:!0,http3Enabled:!1,ocspIsOn:!1}:(t.certRefs==null&&(t.certRefs=[]),t.certs==null&&(t.certs=[]),t.clientCARefs==null&&(t.clientCARefs=[]),t.clientCACerts==null&&(t.clientCACerts=[]),t.cipherSuites==null&&(t.cipherSuites=[]));let l=t.hsts,s="31536000";return l==null&&(l={isOn:!1,maxAge:31536e3,includeSubDomains:!1,preload:!1,domains:[]}),l.maxAge!=null&&(s=l.maxAge.toString()),{policy:v(t),hsts:v(l),hstsOptionsVisible:v(!1),hstsDomainAdding:v(!1),hstsMaxAgeString:v(s),addingHstsDomain:v(""),hstsDomainEditingIndex:v(-1),allVersions:v(window.SSL_ALL_VERSIONS),allCipherSuites:v(window.SSL_ALL_CIPHER_SUITES.$copy()),modernCipherSuites:v(window.SSL_MODERN_CIPHER_SUITES),intermediateCipherSuites:v(window.SSL_INTERMEDIATE_CIPHER_SUITES),allClientAuthTypes:v(window.SSL_ALL_CLIENT_AUTH_TYPES),cipherSuitesVisible:v(!1),moreOptionsVisible:v(!1)}}(),se=function(t){m.confirm("确定删除此证书吗？证书数据仍然保留，只是当前网站不再使用此证书。",function(){o.value.certRefs.$remove(t),o.value.certs.$remove(t)})},ne=function(){let t=[];o.value!=null&&o.value.certs.length>0&&o.value.certs.forEach(function(s){t.push(s.id.toString())});let l=O.vServerId;l==null&&(l=0),m.popup("/servers/certs/selectPopup?selectedCertIds="+t+"&serverId="+l,{width:"50em",height:"40em",callback:function(s){s.data.cert!=null&&s.data.certRef!=null&&(o.value.certRefs.push(s.data.certRef),o.value.certs.push(s.data.cert)),s.data.certs!=null&&s.data.certRefs!=null&&(o.value.certRefs.$pushAll(s.data.certRefs),o.value.certs.$pushAll(s.data.certs))}})},oe=function(){let t=O.vServerId;typeof t!="number"&&typeof t!="string"&&(t=0),m.popup("/servers/certs/uploadPopup?serverId="+t,{callback:function(l){m.success("上传成功",function(){o.value.certRefs.push(l.data.certRef),o.value.certs.push(l.data.cert)})}})},ie=function(){let t=O.vServerId;typeof t!="number"&&typeof t!="string"&&(t=0),m.popup("/servers/certs/uploadBatchPopup?serverId="+t,{callback:function(l){l.data.cert!=null&&(o.value.certRefs.push(l.data.certRef),o.value.certs.push(l.data.cert)),l.data.certs!=null&&(o.value.certRefs.$pushAll(l.data.certRefs),o.value.certs.$pushAll(l.data.certs))}})},ae=function(){let t=[];o.value!=null&&o.value.certs.length>0&&o.value.certs.forEach(function(l){t.$pushAll(l.dnsNames)}),m.popup("/servers/server/settings/https/requestCertPopup?serverId="+O.vServerId+"&excludeServerNames="+t.join(","),{callback:function(){o.value.certRefs.push(resp.data.certRef),o.value.certs.push(resp.data.cert)}})},ue=function(){P.value=!P.value},K=function(t){return new Date(t*1e3).format("Y-m-d")},J=function(t){return t.replace(/(AES|3DES)/,'<var style="font-weight: bold">$1</var>')},re=function(t){o.value.cipherSuites.$contains(t)||o.value.cipherSuites.push(t),E.value.$removeValue(t)},de=function(t){m.confirm("确定要删除此套件吗？",function(){o.value.cipherSuites.$removeValue(t),E.value=window.SSL_ALL_CIPHER_SUITES.$findAll(function(l,s){return!o.value.cipherSuites.$contains(s)})})},ce=function(){m.confirm("确定要清除所有已选套件吗？",function(){o.value.cipherSuites=[],E.value=window.SSL_ALL_CIPHER_SUITES.$copy()})},j=function(t){m.confirm("确定要批量添加套件？",function(){t.$each(function(l,s){o.value.cipherSuites.$contains(s)||o.value.cipherSuites.push(s)})})},pe=function(){Ve.create(z.value,{draggable:".sort-label",handle:".sort-handle",onUpdate:function(t){m.moveElement(o.value.cipherSuites,t.oldDraggableIndex,t.newDraggableIndex)}})},ve=function(){R.value=!R.value},fe=function(){S.value=!S.value,S.value&&U()},U=function(){var t=parseInt(D.value);if(isNaN(t)||t<0){a.value.maxAge=0,a.value.days="-";return}a.value.maxAge=t,a.value.days=t/86400,a.value.days==0&&(a.value.days="-")},N=function(t){D.value=t.toString(),U()},me=function(){L.value=!0,I.value=-1,setTimeout(function(){x.value.focus()},100)},he=function(t){I.value=t,_.value=a.value.domains[t],L.value=!0,setTimeout(function(){x.value.focus()},100)},q=function(){_.value=_.value.trim(),_.value.length!=0&&(I.value>-1?a.value.domains[I.value]=_.value:a.value.domains.push(_.value),M())},M=function(){L.value=!1,_.value="",I.value=-1},_e=function(t){M(),a.value.domains.$remove(t)},Se=function(){m.popup("/servers/certs/selectPopup?isCA=1",{width:"50em",height:"40em",callback:function(t){t.data.cert!=null&&t.data.certRef!=null&&(o.value.clientCARefs.push(t.data.certRef),o.value.clientCACerts.push(t.data.cert)),t.data.certs!=null&&t.data.certRefs!=null&&(o.value.clientCARefs.$pushAll(t.data.certRefs),o.value.clientCACerts.$pushAll(t.data.certs))}})},Ce=function(){m.popup("/servers/certs/uploadPopup?isCA=1",{callback:function(t){m.success("上传成功",function(){o.value.clientCARefs.push(t.data.certRef),o.value.clientCACerts.push(t.data.cert)})}})},ge=function(t){m.confirm("确定删除此证书吗？证书数据仍然保留，只是当前网站不再使用此证书。",function(){o.value.clientCARefs.$remove(t),o.value.clientCACerts.$remove(t)})};return be(a.value,function(){o.value.hsts=a.value}),Ae(function(){setTimeout(function(){pe()},200)}),(t,l)=>(u(),d("div",null,[Oe,e("input",{type:"hidden",name:"sslPolicyJSON",value:JSON.stringify(n(o))},null,8,De),r(we,null,{default:p(()=>[e("tbody",null,[C(e("tr",null,[Ee,e("td",null,[r(T,{value:"1",modelValue:n(o).http2Enabled,"onUpdate:modelValue":l[0]||(l[0]=s=>n(o).http2Enabled=s)},null,8,["modelValue"])])],512),[[g,t.vProtocol=="https"]]),C(e("tr",null,[He,e("td",null,[r(T,{value:"1",modelValue:n(o).http3Enabled,"onUpdate:modelValue":l[1]||(l[1]=s=>n(o).http3Enabled=s)},null,8,["modelValue"])])],512),[[g,t.vProtocol=="https"&&t.vSupportHttp3]]),e("tr",null,[Le,e("td",null,[n(o).certs!=null&&n(o).certs.length>0?(u(),d("div",xe,[(u(!0),d(b,null,A(n(o).certs,(s,y)=>(u(),k(H,{outlined:""},{default:p(()=>[i(h(s.name)+" / "+h(s.dnsNames)+" / 有效至"+h(K(s.timeEndAt))+"   ",1),e("a",{href:"",title:"删除",onClick:c(B=>se(y),["prevent"])},Ne,8,Pe)]),_:2},1024))),256)),r(w)])):(u(),d("div",Me,[e("span",Be,[i("选择或上传证书后"),t.vProtocol=="https"?(u(),d("span",ze,"HTTPS")):f("",!0),t.vProtocol=="tls"?(u(),d("span",Ke,"TLS")):f("",!0),i("服务才能生效。")]),r(w)])),e("div",Je,[r(V,{secondary:"",size:"small",type:"button",onClick:l[2]||(l[2]=c(s=>ne(),["prevent"]))},{default:p(()=>[i("选择已有证书")]),_:1}),i("   "),je,i("   "),r(V,{secondary:"",size:"small",type:"button",onClick:l[3]||(l[3]=c(s=>oe(),["prevent"]))},{default:p(()=>[i("上传新证书")]),_:1}),i("   "),r(V,{secondary:"",size:"small",type:"button",onClick:l[4]||(l[4]=c(s=>ie(),["prevent"]))},{default:p(()=>[i("批量上传证书")]),_:1}),i("   "),t.vServerId!=null&&t.vServerId>0?(u(),d("span",qe,"|")):f("",!0),i("   "),t.vServerId!=null&&t.vServerId>0?(u(),k(V,{key:1,secondary:"",size:"small",type:"button",onClick:l[5]||(l[5]=c(s=>ae(),["prevent"]))},{default:p(()=>[i("申请免费证书")]),_:1})):f("",!0)])])]),e("tr",null,[Fe,e("td",null,[r(Y,{modelValue:n(o).minVersion,"onUpdate:modelValue":l[6]||(l[6]=s=>n(o).minVersion=s)},{default:p(()=>[(u(!0),d(b,null,A(n(Z),s=>(u(),k(Q,{value:s},{default:p(()=>[i(h(s),1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"])])])]),r(ke,{onChange:ue}),C(e("tbody",null,[e("tr",null,[Ge,e("td",null,[r(T,{value:"1",modelValue:n(o).cipherSuitesIsOn,"onUpdate:modelValue":l[7]||(l[7]=s=>n(o).cipherSuitesIsOn=s)},{default:p(()=>[i("使用自定义")]),_:1},8,["modelValue"]),C(e("div",null,[r(w),e("div",Ye,[i(" 已添加套件("+h(n(o).cipherSuites.length)+")： ",1),e("div",{class:"label-group mt-4",ref_key:"cipherSuitesBoxRef",ref:z},[(u(!0),d(b,null,A(n(o).cipherSuites,s=>(u(),k(H,{outlined:"",class:"sort-label",key:s},{default:p(()=>[e("input",{type:"hidden",name:"cipherSuites",value:s},null,8,Qe),e("span",{innerHTML:J(s)},null,8,We),i("   "),e("a",{href:"",title:"删除套件",onClick:c(y=>de(s),["prevent"])},et,8,Xe),i("  "),tt]),_:2},1024))),128))],512)]),e("div",null,[r(w),n(o).cipherSuites.length>0?(u(),d("span",lt,[e("a",{href:"",onClick:l[8]||(l[8]=c(s=>ce(),["prevent"]))},"[清除所有已选套件]"),i("   ")])):f("",!0),e("a",{href:"",onClick:l[9]||(l[9]=c(s=>j(n(ee)),["prevent"]))},"[添加推荐套件]"),i("   "),e("a",{href:"",onClick:l[10]||(l[10]=c(s=>j(n(te)),["prevent"]))},"[添加兼容套件]"),r(w)]),e("div",st,[e("a",{href:"",onClick:l[11]||(l[11]=c(s=>ve(),["prevent"]))},[n(o).cipherSuites.length==0?(u(),d("span",nt,"所有")):f("",!0),i("可选套件("+h(n(E).length)+") ",1),e("i",{class:$(["pi",{"pi-angle-down":!n(R),"pi-angle-up":n(R)}])},null,2)]),n(R)?(u(),d("div",ot,[(u(!0),d(b,null,A(n(E),s=>(u(),d("a",{href:"",title:"点击添加到自定义套件中",onClick:c(y=>re(s),["prevent"])},[r(H,{outlined:""},{default:p(()=>[e("span",{innerHTML:J(s)},null,8,at)]),_:2},1024)],8,it))),256))])):f("",!0)]),n(R)?(u(),d("p",ut,"点击可选套件添加。")):f("",!0)],512),[[g,n(o).cipherSuitesIsOn]])])]),C(e("tr",null,[e("td",{class:$({"color-border":n(a).isOn})},"开启HSTS",2),e("td",null,[r(T,{name:"hstsOn",modelValue:n(a).isOn,"onUpdate:modelValue":l[12]||(l[12]=s=>n(a).isOn=s),value:"1"},null,8,["modelValue"]),e("p",rt,[i(" 开启后，会自动在响应Header中加入 "),r($e,null,{default:p(()=>[i("Strict-Transport-Security: "),n(a).isOn?f("",!0):(u(),d("var",dt,"...")),n(a).isOn?(u(),d("var",ct,[pt,i(h(n(a).maxAge),1)])):f("",!0),n(a).isOn&&n(a).includeSubDomains?(u(),d("var",vt,"; includeSubDomains")):f("",!0),n(a).isOn&&n(a).preload?(u(),d("var",ft,"; preload")):f("",!0)]),_:1}),n(a).isOn?(u(),d("span",mt,[e("a",{href:"",onClick:l[13]||(l[13]=c(s=>fe(),["prevent"]))},[i("修改"),e("i",{class:$(["pi",{"pi-angle-down":!n(S),"pi-angle-up":n(S)}])},null,2)])])):f("",!0)])])],512),[[g,t.vProtocol=="https"]]),C(e("tr",null,[ht,e("td",null,[e("div",_t,[e("div",St,[r(Ie,null,{default:p(()=>[r(W,{type:"text",name:"hstsMaxAge",modelValue:n(D),"onUpdate:modelValue":l[14]||(l[14]=s=>F(D)?D.value=s:null),maxlength:"10",size:"10",onInput:l[15]||(l[15]=s=>U()),style:{width:"8em"}},null,8,["modelValue"]),r(Re,null,{default:p(()=>[i("秒")]),_:1})]),_:1})]),e("div",Ct,"相当于 "+h(n(a).days)+"天",1)]),e("p",gt,[e("a",{href:"",onClick:l[16]||(l[16]=c(s=>N(31536e3),["prevent"])),class:$({active:n(a).maxAge==31536e3})},"[1年/365天]",2),i("     "),e("a",{href:"",onClick:l[17]||(l[17]=c(s=>N(15768e3),["prevent"])),class:$({active:n(a).maxAge==15768e3})},"[6个月/182.5天]",2),i("     "),e("a",{href:"",onClick:l[18]||(l[18]=c(s=>N(2592e3),["prevent"])),class:$({active:n(a).maxAge==2592e3})},"[1个月/30天]",2)])])],512),[[g,n(a).isOn&&n(S)]]),C(e("tr",null,[yt,e("td",null,[r(T,{name:"hstsIncludeSubDomains",value:"1",modelValue:n(a).includeSubDomains,"onUpdate:modelValue":l[19]||(l[19]=s=>n(a).includeSubDomains=s)},null,8,["modelValue"])])],512),[[g,n(a).isOn&&n(S)]]),C(e("tr",null,[bt,e("td",null,[r(T,{name:"hstsPreload",value:"1",modelValue:n(a).preload,"onUpdate:modelValue":l[20]||(l[20]=s=>n(a).preload=s)},null,8,["modelValue"])])],512),[[g,n(a).isOn&&n(S)]]),C(e("tr",null,[At,e("td",kt,[e("div",$t,[(u(!0),d(b,null,A(n(a).domains,(s,y)=>(u(),k(H,{outlined:"",class:$({blue:n(I)==y})},{default:p(()=>[i(h(s)+" ",1),e("input",{type:"hidden",name:"hstsDomains",value:s},null,8,Vt),i("   "),e("a",{href:"",onClick:c(B=>he(y),["prevent"]),title:"修改"},Rt,8,Tt),i("  "),e("a",{href:"",onClick:c(B=>_e(y),["prevent"]),title:"删除"},Dt,8,wt)]),_:2},1032,["class"]))),256))]),n(L)?(u(),d("div",Et,[e("div",Ht,[r(W,{type:"text",name:"addingHstsDomain",ref_key:"addingHstsDomainRef",ref:x,style:{width:"16em"},maxlength:"100",placeholder:"域名，比如example.com",onKeyup:l[21]||(l[21]=G(s=>q(),["enter"])),onKeypress:G(c(s=>1,["prevent"]),["enter"]),modelValue:n(_),"onUpdate:modelValue":l[22]||(l[22]=s=>F(_)?_.value=s:null),class:"w-full"},null,8,["onKeypress","modelValue"])]),e("div",Lt,[r(V,{secondary:"",size:"small",type:"button",onClick:l[23]||(l[23]=s=>q())},{default:p(()=>[i("确定")]),_:1}),i("   "),e("a",{href:"",onClick:l[24]||(l[24]=c(s=>M(),["prevent"]))},Pt)])])):f("",!0),e("div",Ut,[r(Te,{size:"small",type:"button",onClick:l[25]||(l[25]=s=>me())})]),Nt])],512),[[g,n(a).isOn&&n(S)]]),e("tr",null,[Mt,e("td",null,[r(T,{name:"ocspIsOn",modelValue:n(o).ocspIsOn,"onUpdate:modelValue":l[26]||(l[26]=s=>n(o).ocspIsOn=s)},null,8,["modelValue"]),Bt])]),e("tr",null,[zt,e("td",null,[r(Y,{name:"clientAuthType",modelValue:n(o).clientAuthType,"onUpdate:modelValue":l[27]||(l[27]=s=>n(o).clientAuthType=s)},{default:p(()=>[(u(!0),d(b,null,A(n(le),s=>(u(),k(Q,{value:s.type},{default:p(()=>[i(h(s.name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"])])]),e("tr",null,[Kt,e("td",null,[n(o).clientCACerts!=null&&n(o).clientCACerts.length>0?(u(),d("div",Jt,[(u(!0),d(b,null,A(n(o).clientCACerts,(s,y)=>(u(),k(H,{outlined:" "},{default:p(()=>[i(h(s.name)+" / "+h(s.dnsNames)+" / 有效至"+h(K(s.timeEndAt))+"   ",1),e("a",{href:"",title:"删除",onClick:l[28]||(l[28]=c(B=>ge(),["prevent"]))},qt)]),_:2},1024))),256)),r(w)])):f("",!0),r(V,{secondary:"",size:"small",type:"button",onClick:l[29]||(l[29]=c(s=>Se(),["prevent"]))},{default:p(()=>[i("选择已有证书")]),_:1}),i("   "),r(V,{secondary:"",size:"small",type:"button",onClick:l[30]||(l[30]=c(s=>Ce(),["prevent"]))},{default:p(()=>[i("上传新证书")]),_:1}),Ft])])],512),[[g,n(P)]])]),_:1}),Gt]))}};export{rl as _};
