import{i as O,c as E}from"./app-DISTCiac.js";import{_ as L}from"./app-BAIc7wsg.js";import{_ as U}from"./app-C7gR9zYq.js";import{_ as H}from"./app-_N2IGwgj.js";import{aa as G,r as x,o as e,g as s,a as p,u as _,b as i,w as n,i as b,h as o,d as J,e as V,f as u,t as l,c as f,F as S,D as T}from"./app-BYx064nO.js";import{_ as j}from"./app-CmboutmR.js";import{L as F}from"./app-Vf6It1y-.js";import{_ as m}from"./app-DU3b6xa5.js";import{N as w}from"./app-Ncl-Sitd.js";import{N as M}from"./app-CxqGeHsb.js";import{_ as v}from"./app-CfEaOsVA.js";import"./app-BXvxi6wb.js";import"./app-C9w-bzHc.js";import"./app-DyIe33QU.js";import"./app-5V9SnxW6.js";import"./app-DOaxShSm.js";import"./app-DQhYsbJs.js";import"./app-BXiLqtxA.js";import"./app-CqvvE0jO.js";import"./app-CK9Tk_hc.js";import"./app-CAeEyuA3.js";import"./app-DoRtcMJm.js";import"./app-DPMEyUYH.js";import"./app-BZMTWmMM.js";import"./app-51hQc1Cd.js";import"./app-CqAVEB_b.js";import"./app-Cqxz9tud.js";import"./app-aIb4ksxL.js";import"./app-DYkSpHuE.js";import"./app-CiA1rHoH.js";import"./app-RbQF51V8.js";import"./app-tUtHmy3n.js";import"./app-DGM5HqRo.js";import"./app-DG0hMi2p.js";import"./app-CBq6-G9z.js";import"./app-DNadG4GC.js";import"./app-DoTJvLi7.js";import"./app-Dj8c2KwC.js";import"./app-cRxw2ZDj.js";function q(){const{utils:g}=O(this);this.change=function(d){this.$post("$").params({webId:this.webId,hostRedirectsJSON:JSON.stringify(d)}).success(function(){g.successToast("保存成功",null,function(){g.reload()})})}}const z=["value"],K={key:0,class:"comment"},Q={key:0},W={class:"label-group mt-1"},X=p("strong",null,"URL跳转",-1),Y={key:1},Z={key:0},tt={key:1},et={key:0},ot={key:1},st={class:"label-group mt-1"},nt=p("strong",null,"域名跳转",-1),at={key:2},it={key:0},lt={key:1},rt={key:0},ut={key:1},ct={class:"label-group mt-1"},mt=p("strong",null,"端口跳转",-1),pt={key:3,style:{"margin-top":"0.5em"}},_t={key:0},dt={key:1},ht={key:2},ft={key:0},yt={key:1,class:"disabled"},vt=["onClick"],gt=["onClick"],kt={key:0,class:"comment items items-center"},xt=p("i",{class:"icon bars"},null,-1),bt={__name:"HTTPHostRedirectBox",props:["v-redirects"],emits:["change"],setup(g,{emit:d}){const y=G("$utils"),R=g,$=d,{redirects:c,statusOptions:Pt,id:B}=function(){let a=R.vRedirects;a==null&&(a=[]);let r=0;return a.forEach(function(t){r++,t.id=r}),{redirects:x(a),statusOptions:x([{code:301,text:"Moved Permanently"},{code:308,text:"Permanent Redirect"},{code:302,text:"Found"},{code:303,text:"See Other"},{code:307,text:"Temporary Redirect"}]),id:x(r)}}(),C=function(){window.UPDATING_REDIRECT=null,y.popup("/servers/server/settings/redirects/createPopup",{width:"50em",height:y.POPUP_HEIGHT_LG,callback:function(a){B.value++,a.data.redirect.id=B.value,c.value.push(a.data.redirect),k()}})},P=function(a){let r=-1;return c.value.forEach((t,h)=>{t===a&&(r=h)}),r},A=function(a){const r=P(a);window.UPDATING_REDIRECT=y.clone(a),y.popup("/servers/server/settings/redirects/createPopup",{width:"50em",height:y.POPUP_HEIGHT_LG,callback:function(t){t.data.redirect.id=a.id,c.value[r]=t.data.redirect,k()}})},N=function(a){const r=P(a);y.confirm("确定要删除这条跳转规则吗？",function(){c.value.$remove(r),k()})},k=function(){setTimeout(function(){$("change",c.value)},100)},D=function(a){c.value=a,k()},I=function(a){let r=[];a.forEach(function(t){c.value.forEach(function(h){h.id==t&&r.push(h)})}),D(r)};return(a,r)=>(e(),s("div",null,[p("input",{type:"hidden",name:"hostRedirectsJSON",value:JSON.stringify(_(c))},null,8,z),i(M,{secondary:""},{tabs:n(()=>[i(w,{href:"",name:"所有跳转规则",active:""}),i(w,{separator:""}),i(w,{onClick:b(C,["prevent"]),name:"创建跳转规则","action-create":""})]),_:1}),_(c).length==0?(e(),s("p",K,"暂时还没有URL跳转规则。")):o("",!0),J(p("div",null,[i(F,{items:_(c),onSort:I},{default:n(()=>[i(v,{rowReorder:"",headerStyle:"width: 3em"}),i(v,{header:"跳转前"},{body:n(({data:t})=>[t.type==""||t.type=="url"?(e(),s("div",Q,[u(l(t.beforeURL)+" ",1),p("div",W,[i(m,null,{default:n(()=>[X]),_:1}),t.matchPrefix?(e(),f(m,{key:0},{default:n(()=>[u("匹配前缀")]),_:1})):o("",!0),t.matchRegexp?(e(),f(m,{key:1},{default:n(()=>[u("正则匹配")]),_:1})):o("",!0),!t.matchPrefix&&!t.matchRegexp?(e(),f(m,{key:2},{default:n(()=>[u("精准匹配")]),_:1})):o("",!0),t.exceptDomains!=null&&t.exceptDomains.length>0?(e(!0),s(S,{key:3},T(t.exceptDomains,h=>(e(),f(m,null,{default:n(()=>[u("排除:"+l(h),1)]),_:2},1024))),256)):o("",!0),t.onlyDomains!=null&&t.onlyDomains.length>0?(e(!0),s(S,{key:4},T(t.onlyDomains,h=>(e(),f(m,null,{default:n(()=>[u("仅限:"+l(h),1)]),_:2},1024))),256)):o("",!0)])])):o("",!0),t.type=="domain"?(e(),s("div",Y,[t.domainsAll?(e(),s("span",Z,"所有域名")):o("",!0),!t.domainsAll&&t.domainsBefore!=null?(e(),s("span",tt,[t.domainsBefore.length==1?(e(),s("span",et,l(t.domainsBefore[0]),1)):o("",!0),t.domainsBefore.length>1?(e(),s("span",ot,l(t.domainsBefore[0])+"等"+l(t.domainsBefore.length)+"个域名",1)):o("",!0)])):o("",!0),p("div",st,[i(m,null,{default:n(()=>[nt]),_:1}),t.domainAfterScheme!=null&&t.domainAfterScheme.length>0?(e(),f(m,{key:0},{default:n(()=>[u(l(t.domainAfterScheme),1)]),_:2},1024)):o("",!0),t.domainBeforeIgnorePorts?(e(),f(m,{key:1},{default:n(()=>[u("忽略端口")]),_:1})):o("",!0)])])):o("",!0),t.type=="port"?(e(),s("div",at,[t.portsAll?(e(),s("span",it,"所有端口")):o("",!0),!t.portsAll&&t.portsBefore!=null?(e(),s("span",lt,[t.portsBefore.length<=5?(e(),s("span",rt,l(t.portsBefore.join(", ")),1)):o("",!0),t.portsBefore.length>5?(e(),s("span",ut,l(t.portsBefore.slice(0,5).join(", "))+"等"+l(t.portsBefore.length)+"个端口",1)):o("",!0)])):o("",!0),p("div",ct,[i(m,null,{default:n(()=>[mt]),_:1}),t.portAfterScheme!=null&&t.portAfterScheme.length>0?(e(),f(m,{key:0},{default:n(()=>[u(l(t.portAfterScheme),1)]),_:2},1024)):o("",!0)])])):o("",!0),t.conds!=null&&t.conds.groups!=null&&t.conds.groups.length>0?(e(),s("div",pt,[i(m,null,{default:n(()=>[u("匹配条件")]),_:1})])):o("",!0)]),_:1}),i(v,{bodyClass:"whitespace-nowrap"},{body:n(()=>[u(" -> ")]),_:1}),i(v,{header:"跳转后"},{body:n(({data:t})=>[t.type==""||t.type=="url"?(e(),s("span",_t,l(t.afterURL),1)):o("",!0),t.type=="domain"?(e(),s("span",dt,l(t.domainAfter),1)):o("",!0),t.type=="port"?(e(),s("span",ht,l(t.portAfter),1)):o("",!0)]),_:1}),i(v,{header:"HTTP状态码"},{body:n(({data:t})=>[t.status>0?(e(),s("span",ft,l(t.status),1)):(e(),s("span",yt,"默认"))]),_:1}),i(v,{header:"状态",headerClass:"two wide"},{body:n(({data:t})=>[i(j,{"v-is-on":t.isOn},null,8,["v-is-on"])]),_:1}),i(v,{header:"操作",headerClass:"two op"},{body:n(({data:t})=>[p("a",{href:"",onClick:b(h=>A(t),["prevent"])},"修改",8,vt),u("   "),p("a",{href:"",onClick:b(h=>N(t),["prevent"])},"删除",8,gt)]),_:1})]),_:1},8,["items"]),_(c).length>1?(e(),s("p",kt,[u("所有规则匹配顺序为从上到下，可以拖动左侧的"),xt,u("排序。 ")])):o("",!0)],512),[[V,_(c).length>0]])]))}},wt={key:0},Rt=["value"],Bt={key:1},pe={__name:"index",setup(g){const d=E(new q);return(y,R)=>(e(),f(L,{ctx:_(d)},{default:n(()=>[_(d).featureIsOn?(e(),s("div",wt,[i(H,{action:"$",onSuccess:_(d).success},{default:n(()=>[p("input",{type:"hidden",name:"webId",value:_(d).webId},null,8,Rt),i(bt,{"v-redirects":_(d).redirects,onChange:_(d).change},null,8,["v-redirects","onChange"])]),_:1},8,["onSuccess"])])):o("",!0),_(d).featureIsOn?o("",!0):(e(),s("div",Bt,[i(U)]))]),_:1},8,["ctx"]))}};export{pe as default};
